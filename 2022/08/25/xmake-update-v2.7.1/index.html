<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.7.1 Released, Better C++ Modules Support</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build utility based on Lua.It is very lightweight and has no dependencies because it has a built-in Lua runtime.It uses...">

    
    <meta name="keywords" content="xmake,lua,C/C++,remote,ccache,C++20,Modules,headerunits,fs-watcher,tboox" /> 

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />
	
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2022/08/25/xmake-update-v2.7.1/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){    
        var userAgentInfo = navigator.userAgent;  
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");    
        var flag = true;    
        for (var v = 0; v < Agents.length; v++) {    
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }    
        }    
        return flag;    
    }
    </script>

<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.7.1 Released, Better C++ Modules Support</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2022-08-25
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>&nbsp;
    
        <!--a href="/tag/#remote" title="Tag: remote" rel="tag">remote</a-->
        <a href="/tag/#remote" title="Tag: remote" rel="tag">remote</a>&nbsp;
    
        <!--a href="/tag/#ccache" title="Tag: ccache" rel="tag">ccache</a-->
        <a href="/tag/#ccache" title="Tag: ccache" rel="tag">ccache</a>&nbsp;
    
        <!--a href="/tag/#C%2B%2B20" title="Tag: C++20" rel="tag">C++20</a-->
        <a href="/tag/#C++20" title="Tag: C++20" rel="tag">C++20</a>&nbsp;
    
        <!--a href="/tag/#Modules" title="Tag: Modules" rel="tag">Modules</a-->
        <a href="/tag/#Modules" title="Tag: Modules" rel="tag">Modules</a>&nbsp;
    
        <!--a href="/tag/#headerunits" title="Tag: headerunits" rel="tag">headerunits</a-->
        <a href="/tag/#headerunits" title="Tag: headerunits" rel="tag">headerunits</a>&nbsp;
    
        <!--a href="/tag/#fs-watcher" title="Tag: fs-watcher" rel="tag">fs-watcher</a-->
        <a href="/tag/#fs-watcher" title="Tag: fs-watcher" rel="tag">fs-watcher</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build utility based on Lua.</p>

<p>It is very lightweight and has no dependencies because it has a built-in Lua runtime.</p>

<p>It uses xmake.lua to maintain project builds and its configuration syntax is very simple and readable.</p>

<p>We can use it to build project directly like Make/Ninja, or generate project files like CMake/Meson, and it also has a built-in package management system to help users solve the integrated use of C/C++ dependent libraries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>Although not very precise, we can still understand Xmake in the following way:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ~= Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<h2 id="introduction-of-new-features">Introduction of new features</h2>

<p>In this release, we have refactored and improved the C++20 Modules implementation, improved the dependency graph parsing of module files, added support for STL and User HeaderUnits, and made the CMakelists/compile_commands generator support C++ Modules.</p>

<p>In addition, we’ve added an <code class="highlighter-rouge">xmake watch</code> plugin that can monitor current project file updates in real time, automatically trigger incremental builds, or run some custom commands.</p>

<p><img src="/static/img/xmake/xmake-watch.gif" width="60%" /></p>

<h3 id="c-modules-improvements">C++ Modules Improvements</h3>

<p>Xmake has long supported C++ Modules build support, and can automatically analyze dependencies between modules to maximize parallel compilation.
In addition, Xmake uses <code class="highlighter-rouge">.mpp</code> as the default module extension, but also supports <code class="highlighter-rouge">.ixxx</code>, <code class="highlighter-rouge">.cppm</code>, <code class="highlighter-rouge">.mxx</code> and so on.</p>

<p>For example</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_languages</span><span class="p">(</span><span class="s2">"c++20"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"class"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">,</span> <span class="s2">"src/*.mpp"</span><span class="p">)</span>
</code></pre>
</div>

<p>For more examples see: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/c%2B%2B/modules">C++ Modules</a></p>

<p>However, the previous implementation has many shortcomings.</p>

<ol>
  <li>no support for HeaderUnits, so you can’t use modules like stl</li>
  <li>the module dependency graph parsing is done by scanning the source code itself, and does not support the dependency scanning provided by the compiler, so it is not fully reliable</li>
  <li>do not support CMakelists generation</li>
  <li>compile_commands.json generation is not supported</li>
</ol>

<p>In the new version, we have refactored and upgraded the implementation of C++20 module, and we support all the points mentioned above, and added support for Headerunits, so we can introduce STL and user header modules in the module.</p>

<p>Also, since higher versions of msvc and gcc have built-in scan analysis of module dependency graphs, Xmake prioritizes module dependency graph analysis with the compiler, and if the compiler does not support it (clang), then Xmake will degrade to its own source code scan implementation.</p>

<p>A related patch is available at <a href="https://github.com/xmake-io/xmake/pull/2641">#2641</a>, with many thanks to <a href="https://github.com/Arthapz">@Arthapz</a> for their contribution.</p>

<p>Here is an example of a module that uses STL HeaderUnits, e.g.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">stl_headerunit$ </span>xmake
<span class="o">[</span> 0%]: generating.cxx.module.deps src/main.cpp
<span class="o">[</span> 0%]: generating.cxx.module.deps src/hello.mpp
<span class="o">[</span> 20%]: generating.cxx.headerunit.bmi iostream
<span class="o">[</span> 60%]: generating.cxx.module.bmi hello
<span class="o">[</span> 70%]: cache compiling.release src/main.cpp
<span class="o">[</span> 80%]: linking.release stl_headerunit
<span class="o">[</span>100%]: build ok!
</code></pre>
</div>

<p>For the first compilation, we scan the module code for dependencies and then precompile stl libraries like iostream as headerunit.</p>

<p>Any subsequent recompilation will directly reuse them for compilation acceleration.</p>

<p>Note: Usually we need to add at least one <code class="highlighter-rouge">.mpp</code> file to enable C++20 modules compilation, if there is only a cpp file, module compilation will not be enabled by default.</p>

<p>However, if we just want to use the module’s Headerunits feature in the cpp file, for example, by introducing some STL Headerunits in the cpp, then we can also set the <code class="highlighter-rouge">.mpp</code> to <code class="highlighter-rouge">.mpp</code>.
then we can also force C++ Modules compilation by setting <code class="highlighter-rouge">set_policy("build.c++.modules", true)</code>, e.g.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
    <span class="n">set_languages</span><span class="p">(</span><span class="s2">"c++20"</span><span class="p">)</span>
    <span class="n">set_policy</span><span class="p">(</span><span class="s2">"build.c++.modules"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="project-file-monitoring-and-auto-build">Project file monitoring and auto-build</h3>

<p>In this release, we have added the <code class="highlighter-rouge">xmake watch</code> plugin command to automatically monitor project files for updates and then trigger automatic builds or run some custom commands.</p>

<p>This is often used for personal development to enable fast real-time incremental builds without the need to manually execute the build command each time, improving development efficiency.</p>

<h4 id="auto-build-after-project-update">Auto-build after project update</h4>

<p>The default behavior is to monitor the entire project root, and any file changes will trigger an incremental build of the project.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch
watching /private/tmp/test/src/<span class="k">**</span> .
watching /private/tmp/test/<span class="k">*</span> ...
/private/tmp/test/src/main.cpp modified
<span class="o">[</span> 25%]: ccache compiling.release src/main.cpp
<span class="o">[</span> 50%]: linking.release <span class="nb">test</span>
<span class="o">[</span> 100%]: build ok!
</code></pre>
</div>

<h4 id="monitoring-a-specific-directory">Monitoring a specific directory</h4>

<p>We can also monitor specific code directories to narrow down the scope of monitoring and improve performance.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -d src
<span class="gp">$ </span>xmake watch -d <span class="s2">"src;tests/*"</span>
</code></pre>
</div>

<p>The above command will recursively watch all subdirectories. If you want to only watch the files in the current directory without recursive monitoring, you can use the following command.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -p src
<span class="gp">$ </span>xmake watch -p <span class="s2">"src;tests/*"</span>
</code></pre>
</div>

<h4 id="watch-and-run-the-specified-command">Watch and run the specified command</h4>

<p>If you want to run the build automatically even after the automatic build, we can use a custom command set.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -c <span class="s2">"xmake; xmake run"</span>
</code></pre>
</div>

<p>The above command list is passed as a string, which is not flexible enough for complex command arguments that require escaping to be more cumbersome, so we can use the following for arbitrary commands.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -- <span class="nb">echo </span>hello xmake!
<span class="gp">$ </span>xmake watch -- xmake run --help
</code></pre>
</div>

<h4 id="watching-and-running-the-target-program">Watching and running the target program</h4>

<p>Although we can automate the running of the target program with custom commands, we also provide more convenient arguments to achieve this behavior.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -r
<span class="gp">$ </span>xmake watch --run
<span class="o">[</span>100%]: build ok!
hello world!
</code></pre>
</div>

<p><img src="/static/img/xmake/xmake-watch.gif" width="60%" /></p>

<h4 id="watching-and-running-lua-scripts">Watching and running lua scripts</h4>

<p>We can also watch for file updates and run the specified lua script for more flexible and complex command customization.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake watch -s /tmp/test.lua
</code></pre>
</div>

<p>We can also get a list of all updated file paths and events in the script again.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="nf">main</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
    <span class="c1">-- TODO handle events</span>
<span class="k">end</span>
</code></pre>
</div>

<h3 id="mac-catalyst-support">Mac Catalyst Support</h3>

<p>MAc Catalyst is Apple’s new solution for bringing iPad apps to the Mac. Mac apps built with Mac Catalyst share code with your iPad apps, and you can add more features to your Mac separately.</p>

<p>With this new version, we’ve added support for building Mac Catalyst targets, and on macOS platforms, we just need to add the <code class="highlighter-rouge">-appledev=catalyst</code> configuration option to support compiling existing iOS code and getting it up and running on macOS without making any changes.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f --appledev<span class="o">=</span>catalyst
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>We can experience the Mac in the test project <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/objc/iosapp_with_framework">iosapp_with_framework</a> Catalyst program compile and run.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake
<span class="o">[</span> 36%]: processing.xcode.release src/framework/Info.plist
<span class="o">[</span> 40%]: cache compiling.release src/framework/test.m
<span class="o">[</span> 44%]: linking.release <span class="nb">test</span>
<span class="o">[</span> 48%]: generating.xcode.release test.framework
<span class="o">[</span> 56%]: compiling.xcode.release src/app/Assets.xcassets
<span class="o">[</span> 56%]: processing.xcode.release src/app/Info.plist
<span class="o">[</span> 60%]: cache compiling.release src/app/ViewController.m
<span class="o">[</span> 60%]: cache compiling.release src/app/SceneDelegate.m
<span class="o">[</span> 60%]: cache compiling.release src/app/main.m
<span class="o">[</span> 60%]: cache compiling.release src/app/AppDelegate.m
<span class="o">[</span> 60%]: compiling.xcode.release src/app/Base.lproj/LaunchScreen.storyboard
<span class="o">[</span> 60%]: compiling.xcode.release src/app/Base.lproj/Main.storyboard
<span class="o">[</span> 88%]: linking.release demo
<span class="o">[</span> 92%]: generating.xcode.release demo.app
<span class="o">[</span>100%]: build ok!
<span class="gp">$ </span>xmake run
2022-08-26 15:11:03.581 demo[86248:9087199] add<span class="o">(</span>1, 2<span class="o">)</span>: 3
2022-08-26 15:11:03.581 demo[86248:9087199] hello xmake!
</code></pre>
</div>

<p><img src="/static/img/xmake/mac-catalyst.png" width="60%" /></p>

<h3 id="improving-remote-builds">Improving remote builds</h3>

<h4 id="pulling-remote-build-files">Pulling remote build files</h4>

<p>For remote builds, we have added a new pull remote file command, which can usually be used to download remote target build files, library files locally after the remote build is complete.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake service --pull <span class="s1">'build/**'</span> outputdir
</code></pre>
</div>

<p>We can match the files to be downloaded with the <code class="highlighter-rouge">-pull 'build/**'</code> pattern, either build files or other files.</p>

<p>Note: Files are segregated by project, only files under the current project can be specified for download, and will not let users download files from other directories on the server to avoid some security risks.</p>

<h4 id="real-time-echo-output">Real-time echo output</h4>

<p>In the previous version, when using remote compilation, the client could not output the compilation information of the server in real time, because the cache existed, the compilation progress information seen locally was refreshed piece by piece, which was not a good experience.</p>

<p>Therefore, we added line buffer refresh support to improve the real-time output display and make the user experience closer to the local compilation when compiling remotely.</p>

<h3 id="improve-distributed-compile-scheduling-algorithm">Improve distributed compile scheduling algorithm</h3>

<p>We have also further improved the server node scheduling for xmake’s distributed compilation by adding weight to cpu load and memory resources, rather than just assigning tasks by the number of cpu cores.</p>

<p>Thus, if some nodes are overloaded, we will prioritize the compilation tasks to the nodes that are quite free and take advantage of all compilation resources.</p>

<h3 id="more-flexible-cmake-package-lookup">More flexible cmake package lookup</h3>

<h4 id="specify-links">Specify links</h4>

<p>For cmake packages, we have added the <code class="highlighter-rouge">link_libraries</code> configuration option to allow users to customize the configuration of package dependencies and even support for target links when searching for packages to use with cmake.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::xxx"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">link_libraries</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"abc::lib1"</span><span class="p">,</span> <span class="s2">"abc::lib2"</span><span class="p">}}})</span>
</code></pre>
</div>

<p>xmake automatically appends the following configuration when looking for cmake packages, improving the extraction of links libraries.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">target_link_libraries</span><span class="p">(</span>test PRIVATE ABC::lib1 ABC::lib2<span class="p">)</span>
</code></pre>
</div>

<h4 id="specify-the-search-mode">Specify the search mode</h4>

<p>In addition, we add the following search mode configuration.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::xxx"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">search_mode</span> <span class="o">=</span> <span class="s2">"config"</span><span class="p">}})</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::xxx"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">search_mode</span> <span class="o">=</span> <span class="s2">"module"</span><span class="p">}})</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::xxx"</span><span class="p">)</span> <span class="c1">-- both</span>
</code></pre>
</div>

<p>Specify config search mode, for example, to tell cmake to look for packages from <code class="highlighter-rouge">XXXConfig.cmake</code>.</p>

<p>xmake will automatically append the following configuration internally when it looks for cmake packages.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">find_package</span><span class="p">(</span>ABC CONFIG REQUIRED<span class="p">)</span>
</code></pre>
</div>

<h3 id="armccarmclangrc-incremental-compilation-support">armcc/armclang/rc incremental compilation support</h3>

<p>In the new version, we also perform header dependency analysis for keil’s armcc/armclang compiler to support incremental compilation.</p>

<p>In addition, msvc’s rc.exe resource compiler itself cannot provide header dependency analysis, but cl.exe’s preprocessor can handle resource files.
Therefore, we can use <code class="highlighter-rouge">cl.exe /E test.rc</code> to preprocess resource files and extract dependency information from them to achieve incremental compilation support for resource files.</p>

<p>So far, it works pretty well, and we also have support for internal ICON/BITMAP resource reference dependencies.</p>

<h3 id="other-issue-fixes">Other issue fixes</h3>

<p>We’ve also made a number of fixes to the build cache, which will be more stable than the previous version. We have also streamlined the generation of CMakelists.</p>

<p>More detailed improvements can be found in the following changelog.</p>

<h2 id="changelog">Changelog</h2>

<h3 id="new-features">New features</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/2555">#2555</a>: Add fwatcher module and <code class="highlighter-rouge">xmake watch</code> plugin command</li>
  <li>Add <code class="highlighter-rouge">xmake service --pull 'build/**' outputdir</code> to pull the given files in remote server</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/2641">#2641</a>: Improve C++20 modules, support headerunits and project generators</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2679">#2679</a>: Support Mac Catalyst</li>
</ul>

<h3 id="changes">Changes</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/2576">#2576</a>: More flexible package fetching from cmake</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2577">#2577</a>: Improve add_headerfiles(), add <code class="highlighter-rouge"><span class="p">{</span><span class="err">install</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">false</span><span class="p">}</span></code> support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2603">#2603</a>: Disable <code class="highlighter-rouge">-fdirectives-only</code> for ccache by default</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2580">#2580</a>: Set stdout to line buffering</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2571">#2571</a>: Improve task scheduling for parallel and distributed compilation based on memory/cpu usage</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2410">#2410</a>: Improve cmakelists generator</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2690">#2690</a>: Improve to pass toolchains to packages</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2686">#2686</a>: Support for incremental compilation and parse header file deps for keil/armcc/armclang</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2562">#2562</a>: Improve include deps for rc.exe</li>
  <li>Improve the default parallel building jobs number</li>
</ul>

<h3 id="bugs-fixed">Bugs fixed</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/2614">#2614</a>: Fix building submodules2 tests for msvc</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2620">#2620</a>: Fix build cache for incremental compilation</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2177">#2177</a>: Fix python.library segmentation fault for macosx</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2708">#2708</a>: Fix link error for mode.coverage rule</li>
  <li>Fix rpath for macos/iphoneos frameworks and application</li>
</ul>

        </article>
        <hr>

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2022/08/25/xmake-update-v2.7.1/">Xmake v2.7.1 发布，更好的 C++ Modules 支持
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
            
            
            
        
            
        
            
            
            
            
        
            
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2022/11/08/xmake-update-v2.7.3/">Xmake v2.7.3 Released, Package Components and C++ Modules Incremental Build Support
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2022/10/09/xmake-update-v2.7.2/">Xmake v2.7.2 released, build third-party libraries more intelligently
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2022/05/24/xmake-update-v2.6.6/">Xmake v2.6.6 Released, Support Distributed Compilation and Build Cache
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2022/05/24/xmake-update-v2.6.6/">Xmake v2.6.6 Released, Support Distributed Compilation and Build Cache</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        
        
        <p><strong>Next Post</strong> <a href="/2022/10/09/xmake-update-v2.7.2/">Xmake v2.7.2 released, build third-party libraries more intelligently</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">


            <!-- codefund ads -->
            

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div> 

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
