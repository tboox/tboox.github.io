<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake and C/C++ Package Management</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build tool based on Lua.We have done a detailed introduction to Xmake and build system in previous articles. Introducti...">

    
    <meta name="keywords" content="xmake,lua,C/C++,Package,Manager,tboox" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2022/03/12/xmake-and-package-management/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/404.html/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake and C/C++ Package Management</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2022-03-12
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>&nbsp;
    
        <!--a href="/tag/#Package" title="Tag: Package" rel="tag">Package</a-->
        <a href="/tag/#Package" title="Tag: Package" rel="tag">Package</a>&nbsp;
    
        <!--a href="/tag/#Manager" title="Tag: Manager" rel="tag">Manager</a-->
        <a href="/tag/#Manager" title="Tag: Manager" rel="tag">Manager</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build tool based on Lua.
We have done a detailed introduction to Xmake and build system in previous articles. Introduction: <a href="https://github.com/xmake-io/xmake/wiki/C-and-Cplusplus-build-system,-I-use-xmake">C/C++ build system, I use xmake</a>.</p>

<p>If you already have a general understanding of Xmake, you will know that it is not only a build tool,
but also has built-in support for C/C++ package management. We can also understand Xmake as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager
</code></pre>
</div>

<p>After several years of continuous iteration, Xmake’s support for C/C++ package management has been continuously improved,
and many useful package management features have been added. Therefore, in this article, we will make some summaries on it, hoping to help everyone.</p>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<h3 id="build-system-and-package-management">Build system and package management</h3>

<p>The ecology of C++ is very complex, and there are certain historical reasons for this.
In any case, the official does not provide native package management support.
For our developers, it is somewhat inconvenient to use third-party C++ dependent libraries.</p>

<p>In fact, there are already many powerful C/C++ package managers, the most well-known and most used are: vcpkg, conan, conda, etc.
Although they are very powerful, they have a common problem: The build system doesn’t have built-in support for them.</p>

<p>Since CMake does not provide built-in support for them, it is very cumbersome to use them in CMake to integrate dependencies,
and the way of integration and use is inconsistent.</p>

<h4 id="using-conan-with-cmake">Using Conan with CMake</h4>

<p>To use conan to integrate C/C++ packages in CMake, we need to provide additional CMake Wrapper scripts and
inject them into our own projects in a similar way as plug-ins.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.5<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>FormatOutput CXX<span class="p">)</span>

<span class="nb">list</span><span class="p">(</span>APPEND CMAKE_MODULE_PATH <span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span>APPEND CMAKE_PREFIX_PATH <span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="p">)</span>

<span class="nb">add_definitions</span><span class="p">(</span><span class="s2">"-std=c++11"</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="s2">/conan.cmake"</span><span class="p">)</span>
  <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"Downloading conan.cmake from https://github.com/conan-io/cmake-conan"</span><span class="p">)</span>
  <span class="nb">file</span><span class="p">(</span>DOWNLOAD <span class="s2">"https://raw.githubusercontent.com/conan-io/cmake-conan/v0.16.1/conan.cmake"</span>
                <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="s2">/conan.cmake"</span>
                EXPECTED_HASH SHA256=396e16d0f5eabdc6a14afddbcfff62a54a7ee75c6da23f32f7a31bc85db23484
                TLS_VERIFY ON<span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span>/conan.cmake<span class="p">)</span>

<span class="nf">conan_cmake_configure</span><span class="p">(</span>REQUIRES fmt/6.1.2
                      GENERATORS cmake_find_package<span class="p">)</span>

<span class="nf">conan_cmake_autodetect</span><span class="p">(</span>settings<span class="p">)</span>

<span class="nf">conan_cmake_install</span><span class="p">(</span>PATH_OR_REFERENCE .
                    BUILD missing
                    REMOTE conancenter
                    SETTINGS <span class="si">${</span><span class="nv">settings</span><span class="si">}</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span>fmt<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>main main.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>main fmt::fmt<span class="p">)</span>
</code></pre>
</div>

<p>In order to integrate a package, a lot of additional scripts need to be configured.</p>

<h4 id="using-vcpkg-with-cmake">Using Vcpkg with CMake</h4>

<p>To use the vcpkg integration package in CMake, we also need to inject an additional toolchain script file.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>cmake -B <span class="o">[</span>build directory] -S . -DCMAKE_TOOLCHAIN_FILE<span class="o">=[</span>path to vcpkg]/scripts/buildsystems/vcpkg.cmake
cmake --build <span class="o">[</span>build directory]
</code></pre>
</div>

<p>In addition, there is another problem, that is, we need to additionally call the <code class="highlighter-rouge">vcpkg install [packages]</code> command to install this package.</p>

<p>Each of these links requires an additional exploration process for users, and it is impossible to achieve real one-click compilation.</p>

<p>When we download a cmake project that integrates the vcpkg package, and if we want to compile it,
what additional things need to be done in addition to the project configuration:</p>

<ol>
  <li>Install vcpkg</li>
  <li>Execute <code class="highlighter-rouge">vcpkg install xxx</code> to install the required packages</li>
  <li>Execute cmake to pass the vcpkg.cmake script to cmake for project configuration</li>
</ol>

<h4 id="using-fetchcontent-in-cmake">Using FetchContent in CMake</h4>

<p>CMake can also provide <code class="highlighter-rouge">FetchContent</code> to manage dependencies, but it seems to need download source code,
and all dependencies must be maintained and built based on CMake.</p>

<p>In addition, we need to configure various package information such as url, version, etc. for each dependency.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.14<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>fetchContent_example CXX<span class="p">)</span>

<span class="nb">include</span><span class="p">(</span>FetchContent<span class="p">)</span>

<span class="nf">FetchContent_Declare</span><span class="p">(</span>
        DocTest
        GIT_REPOSITORY <span class="s2">"https://github.com/onqtam/doctest"</span>
        GIT_TAG <span class="s2">"932a2ca50666138256dae56fbb16db3b1cae133a"</span>
<span class="p">)</span>
<span class="nf">FetchContent_Declare</span><span class="p">(</span>
        Range-v3
        GIT_REPOSITORY <span class="s2">"https://github.com/ericniebler/range-v3"</span>
        GIT_TAG <span class="s2">"4d6a463bca51bc316f9b565edd94e82388206093"</span>
<span class="p">)</span>

<span class="nf">FetchContent_MakeAvailable</span><span class="p">(</span>DocTest Range-v3<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> src/main.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> doctest range-v3<span class="p">)</span>
</code></pre>
</div>

<h4 id="using-dependencies-in-meson">Using dependencies in Meson</h4>

<p>Meson is very powerful and also provides its own package management support,
but it is also cumbersome to use other package managers in Meson, such as vcpkg/conan, etc., and does not provide builtin support.</p>

<h4 id="using-dependencies-in-xmake">Using dependencies in Xmake</h4>

<p>Xmake not only provides a built-in <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a> package management repository,
which can be directly integrated and used, but also supports the same integration method to quickly integrate third-party dependencies such as vcpkg/conan.</p>

<p>we need only a few lines of configuration to integrate a built-in dependency package:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib 1.2.11"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
</code></pre>
</div>

<p>To integrate a vcpkg package, we only need to add the corresponding package manager namespace. like this:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"vcpkg::zlib 1.2.11"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"vcpkg::zlib"</span><span class="p">)</span>
</code></pre>
</div>

<p>To integrate a conan package, or a third-party package such as conda, homebrew, pacman, apt, clib, etc., we only need to change it to <code class="highlighter-rouge">conan::zlib</code>, and users can switch package sources at will.</p>

<p>In addition, Xmake will automatically call the <code class="highlighter-rouge">vcpkg/conan install</code> installation command for you to install the dependent packages, and then integrate them, without requiring the user to do anything else, just execute <code class="highlighter-rouge">xmake</code> one-click compilation.</p>

<p><img src="https://xmake.io/assets/img/index/package_manage.png" width="650px" /></p>

<h3 id="too-few-cc-packages">Too few C/C++ packages?</h3>

<p>Do you think there are too few packages in the built-in package repository of Xmake?
It doesn’t matter at all. In theory, you can use 90% of the common dependencies in the entire C/C++ ecosystem through Xmake,
because Xmake can quickly integrate packages from various other package managers to use.</p>

<p>The package sources currently supported by Xmake are as follows:</p>

<ul>
  <li>Official package repository <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a> (tbox &gt;1.6.1)</li>
  <li>Official package manager <a href="https://github.com/xmake-io/xrepo">Xrepo</a></li>
  <li><a href="https://xmake.io/#/package/remote_package?id=using-self-built-private-package-repository">User-built repositories</a></li>
  <li>Conan (conan::openssl/1.1.1g)</li>
  <li>Conda (conda::libpng 1.3.67)</li>
  <li>Vcpkg (vcpkg:ffmpeg)</li>
  <li>Homebrew/Linuxbrew (brew::pcre2/libpcre2-8)</li>
  <li>Pacman on archlinux/msys2 (pacman::libcurl)</li>
  <li>Apt on ubuntu/debian (apt::zlib1g-dev)</li>
  <li>Clib (clib::clibs/bytes@0.0.4)</li>
  <li>Dub (dub::log 0.4.3)</li>
  <li>Portage on Gentoo/Linux (portage::libhandy)</li>
  <li>Nimble for nimlang (nimble::zip &gt;1.3)</li>
  <li>Cargo for rust (cargo::base64 0.13.0)</li>
</ul>

<p>Basically, these repositories have basically covered all the packages that C/C++ users need on a daily basis.</p>

<p>We counted the number of packages in the vcpkg/conan/xmake-repo repositories:</p>

<ul>
  <li>vcpkg: 1859</li>
  <li>conan: 1218</li>
  <li>xmake-repo: 651</li>
</ul>

<p>It can be seen that the current number of packages in Xmake’s built-in repository is approaching vcpkg/conan, and there are quite a few, and we are constantly including new packages.</p>

<p>But that doesn’t matter at all because we can use packages from any package repository.</p>

<p>If we use vcpkg in CMake, we can only use 1859 packages.
If we use conan in CMake, we can only use 1218 packages.</p>

<p>And if using packages in Xmake, we can use packages in 651 (xmake-repo) + vcpkg/conan (1k+) + more (conda, homebrew, pacman, apt, clib …).</p>

<p>Even if C/C++ packages are not enough, packages from other languages can also be used. For example, Xmake also supports pulling packages from Dlang/Rust package managers such as dub/cargo for use in C/C++ projects.</p>

<h3 id="xmake-built-in-package-management-integration">Xmake built-in package management integration</h3>

<p>In addition to accessing third-party package management, we also recommend using the packages provided in the integrated xmake-repo built-in repository first, and Xmake will provide more feature support.</p>

<p>Therefore, if the package you need has not been included, you can try to submit it to <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a> first.</p>

<p>Next, we systematically introduce some features of the integrated built-in package.</p>

<h4 id="semantic-versioning-settings">Semantic Versioning Settings</h4>

<p>Xmake’s dependency package management fully supports semantic version selection, for example: “~1.6.1”, for the specific description of semantic version, see: <a href="https://semver.org/">https://semver.org/</a></p>

<p>For example, some semantic versions are written as follows:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox 1.6.*"</span><span class="p">,</span> <span class="s2">"pcre 1.3.x"</span><span class="p">,</span> <span class="s2">"libpng ^1.18"</span><span class="p">)</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"libpng ~1.16"</span><span class="p">,</span> <span class="s2">"zlib 1.1.2 || &gt;=1.2.11 &lt;1.3.0"</span><span class="p">)</span>
</code></pre>
</div>

<p>Of course, if we have no special requirements for the version of the current dependency package, we can write it directly like this:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox"</span><span class="p">,</span> <span class="s2">"libpng"</span><span class="p">,</span> <span class="s2">"zlib"</span><span class="p">)</span>
</code></pre>
</div>

<p>This will use the latest known version of the package, or a package compiled from the source code of the master branch. If the current package has a git repo address, we can also specify a specific branch version:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox master"</span><span class="p">)</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox dev"</span><span class="p">)</span>
</code></pre>
</div>

<p>Xmake’s semantic versioning support has been well supported for a few years, and vcpkg has barely supported it through manifest mode in the last year.</p>

<p>Even now, vcpkg’s support for version semantics is very limited, it can only support several version modes such as <code class="highlighter-rouge">&gt;=1.0</code>, <code class="highlighter-rouge">1.0</code>, and you want to select any version of the package, such as <code class="highlighter-rouge">&gt;=1.0 &lt;1.5</code> and other complex Version-conditional packages, vcpkg still cannot support.</p>

<h4 id="optional-package-settings">Optional package settings</h4>

<p>If the specified dependency package is not supported by the current platform, or the compilation and installation fails, Xmake will compile and report an error, which is reasonable for some projects that must depend on certain packages to work.
But if some packages are optional dependencies, they can be compiled and used normally even if they are not available, they can be set as optional packages:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox"</span><span class="p">,</span> <span class="p">{</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="using-system-libraries">Using system libraries</h4>

<p>By default, Xmake will firstly detect whether the system library exists (if no version requirement is set). If the user does not want to use the system library and the library provided by the third-party package management, you can set:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">false</span><span class="p">})</span>
</code></pre>
</div>

<p>And if configured as:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>It just finds and uses the system library, and does not download and install it remotely.
This is similar to CMake’s find_package, but the integration method is simpler and more consistent.</p>

<h4 id="use-debug-builds-of-packages">Use debug builds of packages</h4>

<p>If we want to debug the dependency package at the same time, we can set it to use the debug version of the package (of course, the premise is that this package supports debug compilation):</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"tbox"</span><span class="p">,</span> <span class="p">{</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="enable-optional-features-of-the-package">Enable optional features of the package</h4>

<p>We can also install packages with specific features, such as installing the ffmpeg package with zlib and libx265 enabled.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"ffmpeg"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">zlib</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">libx265</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}})</span>
</code></pre>
</div>

<h4 id="pass-additional-compile-options">Pass additional compile options</h4>

<p>We can also pass additional compile options to the package:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"spdlog"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">cxflags</span> <span class="o">=</span> <span class="s2">"-Dxxx"</span><span class="p">}})</span>
</code></pre>
</div>

<h3 id="standalone-package-management-commands-xrepo">Standalone package management commands Xrepo</h3>

<p>Xrepo is a cross-platform C/C++ package manager based on <a href="https://github.com/xmake-io/xmake">Xmake</a>.</p>

<p>It is a command program independent of Xmake, which is used to assist users to manage dependency packages, similar to vcpkg/conan, but compared with them, it has some additional practical features, we will briefly introduce some.</p>

<p><img src="https://xrepo.xmake.io/assets/img/xrepo.gif" alt="" /></p>

<h4 id="multiple-repository-management">Multiple repository management</h4>

<p>In addition to retrieving the installation package directly from the official repository: <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a>,
We can also add any number of self-built repositories, and even completely isolate the external network, and only maintain the installation and integration of private packages on the company’s internal network.</p>

<p>Just add your own repository url with the following command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo add-repo myrepo https://github.com/mygroup/myrepo
</code></pre>
</div>

<h4 id="basic-usage">Basic usage</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install zlib tbox
</code></pre>
</div>

<h4 id="install-the-specified-version-package">Install the specified version package</h4>

<p>Full support for Semantic Versioning.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install <span class="s2">"zlib 1.2.x"</span>
<span class="gp">$ </span>xrepo install <span class="s2">"zlib &gt;=1.2.0"</span>
</code></pre>
</div>

<h4 id="install-the-specified-platform-package">Install the specified platform package</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install -p iphoneos -a arm64 zlib
<span class="gp">$ </span>xrepo install -p android <span class="o">[</span>--ndk<span class="o">=</span>/xxx] zlib
<span class="gp">$ </span>xrepo install -p mingw <span class="o">[</span>--mingw<span class="o">=</span>/xxx] zlib
<span class="gp">$ </span>xrepo install -p cross --sdk<span class="o">=</span>/xxx/arm-linux-musleabi-cross zlib
</code></pre>
</div>

<h4 id="install-debug-version-package">Install debug version package</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install -m debug zlib
</code></pre>
</div>

<h4 id="install-dynamic-library-version-package">Install dynamic library version package</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install -k shared zlib
</code></pre>
</div>

<h4 id="install-the-specified-configuration-package">Install the specified configuration package</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install -f <span class="s2">"vs_runtime=MD"</span> zlib
<span class="gp">$ </span>xrepo install -f <span class="s2">"regex=true,thread=true"</span> boost
</code></pre>
</div>

<h4 id="install-packages-from-third-party-package-managers">Install packages from third-party package managers</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install brew::zlib
<span class="gp">$ </span>xrepo install vcpkg::zlib
<span class="gp">$ </span>xrepo install conan::zlib/1.2.11
</code></pre>
</div>

<h4 id="view-the-library-usage-information-of-the-package">View the library usage information of the package</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo fetch pcre2
<span class="o">{</span>
  <span class="o">{</span>
    linkdirs <span class="o">=</span> <span class="o">{</span>
      <span class="s2">"/usr/local/Cellar/pcre2/10.33/lib"</span>
    <span class="o">}</span>,
    links <span class="o">=</span> <span class="o">{</span>
      <span class="s2">"pcre2-8"</span>
    <span class="o">}</span>,
    defines <span class="o">=</span> <span class="o">{</span>
      <span class="s2">"PCRE2_CODE_UNIT_WIDTH=8"</span>
    <span class="o">}</span>,
    includedirs <span class="o">=</span> <span class="s2">"/usr/local/Cellar/pcre2/10.33/include"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo fetch --ldflags openssl
-L/Users/ruki/.xmake/packages/o/openssl/1.1.1/d639b7d6e3244216b403b39df5101abf/lib -lcrypto -lssl
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo fetch --cflags openssl
-I/Users/ruki/.xmake/packages/o/openssl/1.1.1/d639b7d6e3244216b403b39df5101abf/include
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo fetch -p <span class="o">[</span>iphoneos|android] --cflags <span class="s2">"zlib 1.2.x"</span>
-I/Users/ruki/.xmake/packages/z/zlib/1.2.11/df72d410e7e14391b1a4375d868a240c/include
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo fetch --cflags --ldflags conan::zlib/1.2.11
-I/Users/ruki/.conan/data/zlib/1.2.11/_/_/package/f74366f76f700cc6e991285892ad7a23c30e6d47/include -L/Users/ruki/.conan/data/zlib/1.2.11/_/_/package /f74366f76f700cc6e991285892ad7a23c30e6d47/lib -lz
</code></pre>
</div>

<h4 id="import-and-export-installed-packages">Import and export installed packages</h4>

<p>xrepo can quickly export installed packages, including corresponding library files, header files, etc.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo <span class="nb">export</span> -o /tmp/output zlib
</code></pre>
</div>

<p>You can also import the previously exported installation package on other machines to implement package migration.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo import -i /xxx/packagedir zlib
</code></pre>
</div>

<h4 id="search-for-supported-packages">Search for supported packages</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo search zlib <span class="s2">"pcr*"</span>
    zlib:
      -&gt; zlib: A Massively Spiffy Yet Delicately Unobtrusive Compression Library <span class="o">(</span><span class="k">in </span>xmake-repo<span class="o">)</span>
    pcr<span class="k">*</span>:
      -&gt; pcre2: A Perl Compatible Regular Expressions Library <span class="o">(</span><span class="k">in </span>xmake-repo<span class="o">)</span>
      -&gt; pcre: A Perl Compatible Regular Expressions Library <span class="o">(</span><span class="k">in </span>xmake-repo<span class="o">)</span>
</code></pre>
</div>

<p>In addition, you can now search for their packages from third-party package managers such as vcpkg, conan, conda and apt, just add the corresponding package namespace, for example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo search vcpkg::pcre
The package names:
    vcpkg::pcre:
      -&gt; vcpkg::pcre-8.44#8: Perl Compatible Regular Expressions
      -&gt; vcpkg::pcre2-10.35#2: PCRE2 is a re-working of the original Perl Compatible Regular Expressions library
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo search conan::openssl
The package names:
    conan::openssl:
      -&gt; conan::openssl/1.1.1g:
      -&gt; conan::openssl/1.1.1h:
</code></pre>
</div>

<h4 id="package-virtual-environment-management">Package virtual environment management</h4>

<p>We can customize some package configurations by adding the xmake.lua file in the current directory, and then enter a specific package shell environment.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib 1.2.11"</span><span class="p">)</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"python 3.x"</span><span class="p">,</span> <span class="s2">"luajit"</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo env shell
<span class="gp">&gt; </span>python --version
<span class="gp">&gt; </span>luajit --version
</code></pre>
</div>

<h3 id="integrate-third-party-build-systems-in-xmake">Integrate third-party build systems in Xmake</h3>

<h4 id="integrate-cmake-projects-in-xmake">Integrate Cmake projects in Xmake</h4>

<p>Xmake does not intend to split the C/C++ ecosystem. It can be well and compatible with existing projects maintained by cmake/autoconf/meson. For example, some other code libraries maintained by CMake can be directly integrated locally and participate in mixed compilation.</p>

<p>In other words, Xmake will not force users to re-port all projects to xmake.lua, and existing CMake projects can be quickly integrated into Xmake projects.</p>

<p>For example, we have the following project structure:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>├── foo
│ ├── CMakeLists.txt
│ └── src
│ ├── foo.c
│ └── foo.h
├── src
│ └── main.c
├── test.lua
└── xmake.lua
</code></pre>
</div>

<p>The foo directory is a static library maintained by CMake, and the root directory is maintained by Xmake. We can describe how to build the foo code base by defining the <code class="highlighter-rouge">package("foo")</code> package in xmake.lua.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">package</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">add_deps</span><span class="p">(</span><span class="s2">"cmake"</span><span class="p">)</span>
    <span class="n">set_sourcedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">scriptdir</span><span class="p">(),</span> <span class="s2">"foo"</span><span class="p">))</span>
    <span class="n">on_install</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="kd">local</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="s2">"-DCMAKE_BUILD_TYPE="</span> <span class="o">..</span> <span class="p">(</span><span class="n">package</span><span class="p">:</span><span class="n">debug</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">"Debug"</span> <span class="ow">or</span> <span class="s2">"Release"</span><span class="p">))</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="s2">"-DBUILD_SHARED_LIBS="</span> <span class="o">..</span> <span class="p">(</span><span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"ON"</span> <span class="ow">or</span> <span class="s2">"OFF"</span><span class="p">))</span>
        <span class="n">import</span><span class="p">(</span><span class="s2">"package.tools.cmake"</span><span class="p">).</span><span class="n">install</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
    <span class="n">on_test</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="nb">assert</span><span class="p">(</span><span class="n">package</span><span class="p">:</span><span class="n">has_cfuncs</span><span class="p">(</span><span class="s2">"add"</span><span class="p">,</span> <span class="p">{</span><span class="n">includes</span> <span class="o">=</span> <span class="s2">"foo.h"</span><span class="p">}))</span>
    <span class="k">end</span><span class="p">)</span>
<span class="n">package_end</span><span class="p">()</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"demo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/main.c"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
</code></pre>
</div>

<p>Among them, we use <code class="highlighter-rouge">set_sourcedir()</code> to set the code directory location of the foo package, and then import the <code class="highlighter-rouge">package.tools.cmake</code> auxiliary module to call cmake to build the code, xmake will automatically obtain the generated libfoo.a and the corresponding header document.</p>

<p>!&gt; For local source integration only, we don’t need to set additional <code class="highlighter-rouge">add_urls</code> and <code class="highlighter-rouge">add_versions</code>.</p>

<p>Once the package is defined, we can use it through <code class="highlighter-rouge">add_requires("foo")</code> and <code class="highlighter-rouge">add_packages("foo")</code>, just like integrating a remote package.</p>

<p>Also, <code class="highlighter-rouge">on_test</code> is optional, if you want strictTo check whether the compilation and installation of the package is successful, you can do some tests in it.</p>

<p>For a complete example, see: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/c/library_with_cmakelists">Library with CMakeLists</a></p>

<h4 id="integrate-the-meson-project-in-xmake">Integrate the Meson project in Xmake</h4>

<p>Xmake supports the integration of more third-party source code libraries maintained by other build systems, such as Meson, just need to import and use the <code class="highlighter-rouge">package.tools.meson</code> auxiliary building module to call meson to build them.</p>

<p>For example, let’s pick a package built with meson from the xmake-repo repository as an example:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"harfbuzz"</span><span class="p">)</span>
    <span class="n">set_sourcedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">scriptdir</span><span class="p">(),</span> <span class="s2">"3rd/harfbuzz"</span><span class="p">))</span>
    <span class="n">add_deps</span><span class="p">(</span><span class="s2">"meson"</span><span class="p">)</span>
    <span class="n">on_install</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="kd">local</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"-Dtests=disabled"</span><span class="p">,</span> <span class="s2">"-Ddocs=disabled"</span><span class="p">,</span> <span class="s2">"-Dbenchmark=disabled"</span><span class="p">,</span> <span class="s2">"-Dcairo=disabled"</span><span class="p">,</span> <span class="s2">"-Dfontconfig=disabled"</span><span class="p">,</span> <span class="s2">"-Dglib=disabled"</span><span class="p">,</span> <span class="s2">"-Dgobject= disabled"</span><span class="p">}</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="s2">"-Ddefault_library="</span> <span class="o">..</span> <span class="p">(</span><span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"shared"</span> <span class="ow">or</span> <span class="s2">"static"</span><span class="p">))</span>
        <span class="n">import</span><span class="p">(</span><span class="s2">"package.tools.meson"</span><span class="p">).</span><span class="n">install</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="integrate-autoconf-project-in-xmake">Integrate Autoconf project in Xmake</h4>

<p>We can also use <code class="highlighter-rouge">package.tools.autoconf</code> to natively integrate third-party codebases with autoconf maintenance.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"libev"</span><span class="p">)</span>
    <span class="n">set_sourcedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">scriptdir</span><span class="p">(),</span> <span class="s2">"3rd/libev"</span><span class="p">))</span>
    <span class="n">on_install</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">import</span><span class="p">(</span><span class="s2">"package.tools.autoconf"</span><span class="p">).</span><span class="n">install</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>Both <code class="highlighter-rouge">package.tools.autoconf</code> and <code class="highlighter-rouge">package.tools.cmake</code> modules can support cross-compilation platforms and toolchains such as mingw/cross/iphoneos/android, xmake will automatically pass the corresponding toolchain into it, users do not need to do any other thing.</p>

<h4 id="integrate-gn-project-in-xmake">Integrate Gn project in Xmake</h4>

<p>We can also use <code class="highlighter-rouge">package.tools.gn</code> to natively integrate third-party codebases maintained by GN.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"skia"</span><span class="p">)</span>
    <span class="n">set_sourcedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">scriptdir</span><span class="p">(),</span> <span class="s2">"3rd/skia"</span><span class="p">))</span>
    <span class="n">add_deps</span><span class="p">(</span><span class="s2">"gn"</span><span class="p">,</span> <span class="s2">"ninja"</span><span class="p">)</span>
    <span class="n">on_install</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">import</span><span class="p">(</span><span class="s2">"package.tools.gn"</span><span class="p">).</span><span class="n">install</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>Here is the complete script example: <a href="https://github.com/xmake-io/xmake-repo/blob/master/packages/s/skia/xmake.lua">Skia with GN</a></p>

<h3 id="find-packages-using-cmakec-in-xmake">Find packages using CMake/C++ in Xmake</h3>

<p>Now CMake is the de facto standard, so the find_package provided by CMake can already find a large number of system libraries and modules. We can also fully reuse this part of the ecology of CMake to expand xmake’s integration of packages.</p>

<p>Just change the package namespace to <code class="highlighter-rouge">cmake::</code> like integrating the vcpkg/conan package.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::ZLIB"</span><span class="p">,</span> <span class="p">{</span><span class="n">alias</span> <span class="o">=</span> <span class="s2">"zlib"</span><span class="p">,</span> <span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
</code></pre>
</div>

<p>We specify <code class="highlighter-rouge">system = true</code> to tell xmake to force cmake to find the package from the system. If it can’t find it, it will not follow the installation logic, because cmake does not provide the installation function of package managers such as vcpkg/conan, but only provides package search. characteristic.</p>

<h4 id="specify-the-version">Specify the version</h4>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::OpenCV 4.1.1"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="specify-components">Specify components</h4>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::Boost"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"regex"</span><span class="p">,</span> <span class="s2">"system"</span><span class="p">}})}</span>
</code></pre>
</div>

<h4 id="preset-switch">Preset switch</h4>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::Boost"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"regex"</span><span class="p">,</span> <span class="s2">"system"</span><span class="p">},</span>
                                             <span class="n">presets</span><span class="o">=</span><span class="p">{</span><span class="n">Boost_USE_STATIC_LIB</span><span class="o">=</span><span class="kc">true</span><span class="p">}}})</span>
</code></pre>
</div>

<p>It is equivalent to pre-define some configurations in CMakeLists.txt before calling find_package to find packages internally to control the search strategy and status of find_package.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>set(Boost_USE_STATIC_LIB ON) -- will be used in FindBoost.cmake
find_package(Boost REQUIRED COMPONENTS regex system)
</code></pre>
</div>

<h4 id="setting-environment-variables">Setting environment variables</h4>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::OpenCV"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">envs</span> <span class="o">=</span> <span class="p">{</span><span class="n">CMAKE_PREFIX_PATH</span> <span class="o">=</span> <span class="s2">"xxx"</span><span class="p">}}})</span>
</code></pre>
</div>

<h4 id="specify-custom-findfoocmake-module-script-directory">Specify custom FindFoo.cmake module script directory</h4>

<p>mydir/cmake_modules/FindFoo.cmake</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"cmake::Foo"</span><span class="p">,</span> <span class="p">{</span><span class="n">system</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">moduledirs</span> <span class="o">=</span> <span class="s2">"mydir/cmake_modules"</span><span class="p">}})</span>
</code></pre>
</div>

<h3 id="integrate-xrepo-dependencies-in-cmake">Integrate Xrepo dependencies in Cmake</h3>

<p>In addition to integrating CMake projects in Xmake, we can also directly integrate the packages provided by Xmake/Xrepo in CMake, just use <a href="https://github.com/xmake-io/xrepo-cmake">xrepo-cmake</a> to provide CMake Wrapper.</p>

<p>E.g:</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.13.0<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>foo<span class="p">)</span>

<span class="c1"># Download xrepo.cmake if not exists in build directory.</span>
<span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="s2">/xrepo.cmake"</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"Downloading xrepo.cmake from https://github.com/xmake-io/xrepo-cmake/"</span><span class="p">)</span>
    <span class="c1"># mirror https://cdn.jsdelivr.net/gh/xmake-io/xrepo-cmake@main/xrepo.cmake</span>
    <span class="nb">file</span><span class="p">(</span>DOWNLOAD <span class="s2">"https://raw.githubusercontent.com/xmake-io/xrepo-cmake/main/xrepo.cmake"</span>
                  <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span><span class="s2">/xrepo.cmake"</span>
                  TLS_VERIFY ON<span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Include xrepo.cmake so we can use xrepo_package function.</span>
<span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span>/xrepo.cmake<span class="p">)</span>

<span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>example-bin <span class="s2">""</span><span class="p">)</span>
<span class="nf">target_sources</span><span class="p">(</span>example-bin PRIVATE
    src/main.cpp
<span class="p">)</span>
<span class="nf">xrepo_target_packages</span><span class="p">(</span>example-bin zlib<span class="p">)</span>
</code></pre>
</div>

<h4 id="add-package-with-configuration">Add package with configuration</h4>

<p>We, too, can customize the optional features of packages, as in Xmake.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"gflags 2.2.2"</span> CONFIGS <span class="s2">"shared=true,mt=true"</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>example-bin <span class="s2">""</span><span class="p">)</span>
<span class="nf">target_sources</span><span class="p">(</span>example-bin PRIVATE
    src/main.cpp
<span class="p">)</span>
<span class="nf">xrepo_target_packages</span><span class="p">(</span>example-bin gflags<span class="p">)</span>
</code></pre>
</div>

<h4 id="using-packages-from-third-repository">Using packages from third repository</h4>

<p>In addition to installing packages from repositories officially maintained by Xmake, we can also use it directly in CMake to install packages from third-party repositories, just by adding the repository name as a namespace.</p>

<p>For example: <code class="highlighter-rouge">vcpkg::zlib</code>, <code class="highlighter-rouge">conan::pcre2</code>.</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"conan::gflags/2.2.2"</span><span class="p">)</span>
<span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"conda::gflags 2.2.2"</span><span class="p">)</span>
<span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"vcpkg::gflags"</span><span class="p">)</span>
<span class="nf">xrepo_package</span><span class="p">(</span><span class="s2">"brew::gflags"</span><span class="p">)</span>
</code></pre>
</div>

<p>In this way, we unify the way we integrate and use vcpkg/conan packages in CMake, and additionally provide automatic package installation features, as well as support for other package repositories such as homebrew/conda.</p>

        </article>
        <hr>

        <!-- wwads -->
        
        <div class="wwads-cn wwads-horizontal" data-id="243" style="max-width:100%"></div>
        

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2022/03/12/xmake-and-package-management/">Xmake 和 C/C++ 包管理
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2023/07/11/xmake-update-v2.8.1/">Xmake v2.8.1 Released, Lots of Detailed Feature Improvements
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2023/04/04/xmake-update-v2.7.8/">Xmake v2.7.8 released, Improve package virtual environment and build speed
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
            
        
            
        
            
            
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2022/11/08/xmake-update-v2.7.3/">Xmake v2.7.3 Released, Package Components and C++ Modules Incremental Build Support
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2022/03/07/xmake-update-v2.6.4/">Xmake v2.6.4 released, Improve a lot of package management features</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        
        
        <p><strong>Next Post</strong> <a href="/2022/04/24/xmake-update-v2.6.5/">Xmake v2.6.5 released, Support remote compilation</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
