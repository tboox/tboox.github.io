<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>TBOOX开源工程</title>
    <meta name="description" content="专注于跨平台c开发解决方案">

    
    <meta name="keywords" content="tbox,xmake,gbox,c,lua,跨平台,构建工具,编译工具,makefile,make,编译器,图形库,linux,编程,开发" /> 

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" sizes="139x139" href="/static/img/logo1.jpg" />
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="http://www.tboox.org/cn/page5/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="http://www.tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="http://www.tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="http://www.tboox.org/cn/" />


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?162f1cd478898a0686b0b5d5115e2af2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/cn" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>English
                    </a>
                </li>

                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>项目
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/archive/">
                            
                        
                            <i class="fa fa-archive"></i>归档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/category/">
                            
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/tag/">
                            
                        
                            <i class="fa fa-tags"></i>标记
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/forum">
                            
                        
                            <i class="fa fa-forumbee"></i>社区
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/donation/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/about/">
                            
                        
                            <i class="fa fa-user"></i>关于
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index="">
    <div class="left">
        <h1>TBOOX开源工程</h1>
        <small>专注于跨平台c开发解决方案</small>
        <hr />
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/08/03/high-precision-timer/">高精度定时器的使用</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-08-03
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/cn/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/cn/tag/#定时器" title="Tag: 定时器" rel="tag">定时器</a>&nbsp;
    
        <a href="/cn/tag/#最小堆" title="Tag: 最小堆" rel="tag">最小堆</a>&nbsp;
    
        <a href="/cn/tag/#时间轮算法" title="Tag: 时间轮算法" rel="tag">时间轮算法</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>tbox内部提供了两种定时器实现：timer和ltimer</p>

<ul>
  <li>timer: 高精度版本，采用最小堆实现，复杂度是：O(log(n))</li>
  <li>ltimer: 低精度版本，采用linux内核中的timing-wheel算法，复杂度是：O(1)</li>
</ul>

<p>这里主要讲解下，如何使用timer实现高精度的定时器任务，精确到ms级别，对于低精度的ltimer，可以参考：<a href="/cn/2016/08/03/low-precision-timer/">低精度定时器的使用</a></p>

<p>下面先给个简单的例子来说明：</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cm">/* 定义一个定时器任务处理函数
 *
 * @param killed 表示当前任务是否被tb_timer_task_kill强行kill掉的
 * @param priv   投递任务时传入的用户自定义数据指针
 */</span>
<span class="k">static</span> <span class="n">tb_void_t</span> <span class="nf">tb_demo_timer_task_func</span><span class="p">(</span><span class="n">tb_bool_t</span> <span class="n">killed</span><span class="p">,</span> <span class="n">tb_cpointer_t</span> <span class="n">priv</span><span class="p">)</span>
<span class="p">{</span>
    
<span class="p">}</span>

<span class="cm">/* 投递一个定时器任务到全局timer中，间隔1000ms，会重复执行
 *
 * 其中tb_true表示是否会重复执行，如果设为tb_false，那么只会执行一次
 * tb_null参数，就是传入给任务函数的用户自定义数据指针
 */</span>
<span class="n">tb_timer_task_post</span><span class="p">(</span><span class="n">tb_timer</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">tb_true</span><span class="p">,</span> <span class="n">tb_demo_timer_task_func</span><span class="p">,</span> <span class="n">tb_null</span><span class="p">);</span>
</code></pre>
</div>


                </div>
                <div class="read-all">
 
                    
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    

                    <a href="/cn/2016/08/03/high-precision-timer/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/08/02/plugin-doxygen/">xmake插件使用之doxygen文档生成</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-08-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/cn/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <a href="/cn/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <a href="/cn/tag/#doxygen" title="Tag: doxygen" rel="tag">doxygen</a>&nbsp;
    
        <a href="/cn/tag/#插件" title="Tag: 插件" rel="tag">插件</a>&nbsp;
    
        <a href="/cn/tag/#文档生成" title="Tag: 文档生成" rel="tag">文档生成</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>这个doxygen插件比较简单，说白了就是一键生成工程文档，只需要执行下面这行命令就行了</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>xmake doxygen
</code></pre>
</div>

<p>当然你也可以指定输出目录，可以工程源码目录：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>xmake doxygen -o /tmp/output project/src
</code></pre>
</div>


                </div>
                <div class="read-all">
 
                    
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    

                    <a href="/cn/2016/08/02/plugin-doxygen/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/08/02/binding-option/">xmake高级特性之选项绑定</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-08-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/cn/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <a href="/cn/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <a href="/cn/tag/#选项绑定" title="Tag: 选项绑定" rel="tag">选项绑定</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>什么是选项的绑定呢？</p>

<p>例如我想在命令行中配置一个smallest的参数：<code class="highlighter-rouge">xmake f --smallest=y</code></p>

<p>这个时候，需要同时禁用多个其他的选项开关，来禁止编译多个模块，就是这个需求，相当于一个选项 与其他 多个选项之间 是有联动效应的。。</p>

<p>那如何实现呢，可以通过下面两个api来实现：</p>

<ul>
  <li>add_bindings: 添加正向绑定</li>
  <li>add_rbindings: 添加反向绑定</li>
</ul>


                </div>
                <div class="read-all">
 
                    
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    

                    <a href="/cn/2016/08/02/binding-option/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/08/02/regex-match-replace/">利用正则实现匹配和替换</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-08-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tbox" title="Category: tbox" rel="category">tbox</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/cn/tag/#tbox" title="Tag: tbox" rel="tag">tbox</a>&nbsp;
    
        <a href="/cn/tag/#正则表达式" title="Tag: 正则表达式" rel="tag">正则表达式</a>&nbsp;
    
        <a href="/cn/tag/#替换" title="Tag: 替换" rel="tag">替换</a>&nbsp;
    
        <a href="/cn/tag/#匹配" title="Tag: 匹配" rel="tag">匹配</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <p>tbox里面针对三个正则库（pcre/pcre2/posix）进行了封装，实现接口统一和跨平台处理，只要xmake在编译配置的时候自动检测到其中一种库，就可以使用了，一般会优先使用pcre2。</p>

<p>如果你不想过多的依赖第三方库，可以切换到posix的正则，调用 <code class="highlighter-rouge">xmake f --pcre=false --pcre2=false</code> 把pcre的库禁用了就行了。</p>

<p>首先给个最简单的匹配单个子串的例子：</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code>    <span class="c1">// 执行简单匹配，第二个参数是匹配模式，默认传0就行了
</span>    <span class="n">tb_vector_ref_t</span> <span class="n">results</span> <span class="o">=</span> <span class="n">tb_regex_match_done_simple</span><span class="p">(</span><span class="s">"(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\\</span><span class="s">s+?(</span><span class="se">\\</span><span class="s">w+)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"hello world"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 遍历匹配到的结果
</span>        <span class="n">tb_for_all_if</span> <span class="p">(</span><span class="n">tb_regex_match_ref_t</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 打印匹配到的子串的起始偏移、长度、和内容
</span>            <span class="n">tb_trace_i</span><span class="p">(</span><span class="s">"[%lu, %lu]: %s"</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">cstr</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// 销毁匹配到的结果数据
</span>        <span class="n">tb_vector_exit</span><span class="p">(</span><span class="n">results</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>输出结果如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[0, 11]: hello world 
[0, 5]: hello
[6, 5]: world
</code></pre>
</div>


                </div>
                <div class="read-all">
 
                    
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    

                    <a href="/cn/2016/08/02/regex-match-replace/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/cn/2016/08/01/hnr-correct-slope/">手写数字识别系统之倾斜矫正</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-08-01
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#hnr" title="Category: hnr" rel="category">hnr</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/cn/tag/#手写数字识别" title="Tag: 手写数字识别" rel="tag">手写数字识别</a>&nbsp;
    
        <a href="/cn/tag/#神经网络" title="Tag: 神经网络" rel="tag">神经网络</a>&nbsp;
    
        <a href="/cn/tag/#倾斜矫正" title="Tag: 倾斜矫正" rel="tag">倾斜矫正</a>&nbsp;
    
        <a href="/cn/tag/#图像处理" title="Tag: 图像处理" rel="tag">图像处理</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <h2 id="section">简介</h2>

<p>倾斜校正主要有两种，一种是整体倾斜校正，另一种是局部倾斜校正。</p>

<p>由于本文主要研究具有不规则分布的多数字识别，因此只需要关注经过提取后的数字校正问题，也就是图像的局部校正。</p>

<h2 id="section-1">矫正算法</h2>

<p>目前的校正算法有很多，比如说：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>对于整体倾斜校正可以采用统计图像左右两边的平均像素高度，通过计算整体倾斜度来进行校正。
</code></pre>
</div>

<p>这种方法对于像素较多的图像的处理效果明显，而且实现简单快速，但是对于那些已经经过提取得单一数字图像并不适用，因为此时的图像一般较小，且笔画较细，由于所需信息太少统计后的结果并不正确。</p>

<p>其实校正的核心就是使图像的倾斜度的接近为0，因此可以把它看作是一个最优化问题：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>即寻找需要调整多少角度，才能使图像的倾斜度最小，可见倾斜度决定了最终图像的好坏，考虑的数字的特征，都是具有狭长的特点，我们可以考虑将图像的高宽比最为图像倾斜度的依据。
</code></pre>
</div>
<p>而到底需要调整多少才合适呢，本文所采用的方法，并不估算图像的倾斜度，而是通过<code class="highlighter-rouge">二分搜索</code>的思想，在倾斜45度的范围内进行二分查找，寻找最佳调整点，使其结果近似最优，其具体步骤如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. 设置最大调整角度，一般倾斜度不会超过45度，如果超过调整也就没有意义了。
2. 计算图像高宽比，也就是倾斜度，如果倾斜度比上次的有所减小，则调整角度减半，继续搜索，如果倾斜度趋于稳定，则退出查找，并使用此时的调整角度进行调整。
3. 对于实际的调整过程，一般会选择进行旋转变换操作，比较简单，但是考虑到实际人们书写数字时的倾斜往往并不是旋转造成的，而是可能姿势不正而引起的侧斜，因此仅仅通过旋转并不能达到较好的效果，因此可以通过水平侧向校正来实现，即保持像素点的高度不变，仅仅通过调整水平位置，进行适当的调整。
</code></pre>
</div>


                </div>
                <div class="read-all">
 
                    
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                        
                            
                        
                    
                        
                    

                    <a href="/cn/2016/08/01/hnr-correct-slope/"><i class="fa fa-newspaper-o"></i>阅读全文</a>
                </div>
                <hr />
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/cn/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/cn/page4" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">5/16</span>
          
            <a href="/cn/page6" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/cn/page16" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    最近文章
                </div>
                <ul class="content-ul" recent="">
                    
                    
                    
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/29/update-v2.0.4/">xmake v2.0.4发布！</a></li>
                            
                        
                    
                    
                    
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/29/generate-vs2015-project/">xmake支持vs2002-vs2015工程文件生成</a></li>
                            
                        
                    
                    
                    
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/29/update-v1.5.3/">tbox v1.5.3发布！</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/27/stream-architecture/">tbox stream流的架构介绍</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/25/stream-rw/">tbox stream流的使用</a></li>
                            
                        
                    
                    
                    
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/24/forum-opened/">TBOOX开源社区论坛开通</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/12/generate-vs2008-project/">xmake支持vs2008生成</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/12/bits-operation/">tbox数据位操作接口的使用</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/08/variables-usage/">xmake内建变量和外置变量的使用</a></li>
                            
                        
                    
                    
                    
                        
                            <li><a href="/cn/2016/08/08/list-and-list-entry/">tbox链表list和list_entry的使用</a></li>
                            
                        
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    分类
                </div>
                <ul class="content-ul" cate="">
                    
                    <li>
                        <a href="/cn/category/#tboox" class="categories-list-item" cate="tboox">
                            <span class="name">
                                tboox
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#tbox" class="categories-list-item" cate="tbox">
                            <span class="name">
                                tbox
                            </span>
                            <span class="badge">29</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#xmake" class="categories-list-item" cate="xmake">
                            <span class="name">
                                xmake
                            </span>
                            <span class="badge">63</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#gbox" class="categories-list-item" cate="gbox">
                            <span class="name">
                                gbox
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#itrace" class="categories-list-item" cate="itrace">
                            <span class="name">
                                itrace
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#vm86" class="categories-list-item" cate="vm86">
                            <span class="name">
                                vm86
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/cn/category/#hnr" class="categories-list-item" cate="hnr">
                            <span class="name">
                                hnr
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    标记
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                     
                     
                     
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#站点" style="font-size: 9pt; color: #999;">站点</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#算法" style="font-size: 9.5pt; color: #888;">算法</a>
                    
                    
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#容器" style="font-size: 9.5pt; color: #999;">容器</a>
                    
                    
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#内存池" style="font-size: 9pt; color: #999;">内存池</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#跨平台" style="font-size: 9.5pt; color: #999;">跨平台</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#windows" style="font-size: 10.5pt; color: #888;">windows</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#编译" style="font-size: 10pt; color: #888;">编译</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#配置" style="font-size: 9pt; color: #999;">配置</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#stream" style="font-size: 9.5pt; color: #888;">stream</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#流" style="font-size: 9pt; color: #999;">流</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#静态库" style="font-size: 9pt; color: #999;">静态库</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#版本更新" style="font-size: 9.5pt; color: #888;">版本更新</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#插件" style="font-size: 10.5pt; color: #777;">插件</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#类库" style="font-size: 9pt; color: #999;">类库</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#自定义脚本" style="font-size: 9.5pt; color: #999;">自定义脚本</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#打包" style="font-size: 9pt; color: #999;">打包</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#doxygen" style="font-size: 9.5pt; color: #999;">doxygen</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#宏脚本" style="font-size: 9.5pt; color: #999;">宏脚本</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#xmake.lua" style="font-size: 9pt; color: #999;">xmake.lua</a>
                    
                    
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#交叉编译" style="font-size: 9.5pt; color: #999;">交叉编译</a>
                    
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#调试符号" style="font-size: 9pt; color: #999;">调试符号</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#自动检测" style="font-size: 9pt; color: #999;">自动检测</a>
                    
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#符号文件" style="font-size: 9pt; color: #999;">符号文件</a>
                    
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#手写数字识别" style="font-size: 9.5pt; color: #999;">手写数字识别</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#神经网络" style="font-size: 9.5pt; color: #999;">神经网络</a>
                    
                    
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#人工智能" style="font-size: 9pt; color: #999;">人工智能</a>
                    
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#图像处理" style="font-size: 9pt; color: #999;">图像处理</a>
                    
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#定时器" style="font-size: 9pt; color: #999;">定时器</a>
                    
                    
                    
                     
                    
                     
                     
                     
                      
                      
                      
                      
                      
                      <a href="/cn/tag/#时间轮算法" style="font-size: 9pt; color: #999;">时间轮算法</a>
                    
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                     
                     
                    
                    
                     
                     
                     
                    
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                     
                    
                </div>
            </div>

            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    链接
                </div>
                <ul class="content-ul" links="">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                  <li><a href="http://suppore.cn">懒人的小窝</a></li>
                  <li><a href="http://crackerme.github.io/">愛尚丨輕博客</a></li>
                  <li><a href="https://blog.6ag.cn">六阿哥博客</a></li>
                  <li><a href="http://www.acgxt.com">七空幻音</a></li>
                  <li><a href="http://blog.a0z.me">Ghosty Core</a></li>
                  <li><a href="http://www.0xsky.com">xSky实验室</a></li>
                </ul>
            </div> 

            <!-- weixin -->
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    微信公众号
                </div>
                <img src="/static/img/weixin_public.jpg" alt="weixin" width="256" height="256" />
            </div> 

            

            <!-- baidu ads -->
            
            <script type="text/javascript">
                var cpro_id = "u2755106";
            </script>
            <script type="text/javascript" src="http://cpro.baidustatic.com/cpro/ui/c.js"></script>
            

        </div>
    </div>
</div>


    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016 tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
            <span>
                <a href="http://www.miitbeian.gov.cn/">沪ICP备16031914号</a>.
                <a href="http://www.beian.gov.cn/">沪公网安备31011702000303号</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
