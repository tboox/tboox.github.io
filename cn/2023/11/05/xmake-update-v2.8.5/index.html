<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.8.5 发布，支持链接排序和单元测试</title>
    <meta name="description" content="Xmake 是一个基于 Lua 的轻量级跨平台构建工具。它非常的轻量，没有任何依赖，因为它内置了 Lua 运行时。它使用 xmake.lua 维护项目构建，相比 makefile/CMakeLists.txt，配置语法更加简洁直观，对新手非常友好，短时间内就能快速入门，能够让用户把更多的精力集中在实际的项目开发上...">

    
    <meta name="keywords" content="xmake,lua,C/C++,tboox" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/cn/2023/11/05/xmake-update-v2.8.5/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />

    <!-- css -->
    <link href="/css/reward.css" rel="stylesheet" type="text/css">




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/cn" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/?lang=0">
                    
                        <i class="fa fa-home"></i>English
                    </a>
                </li>

                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>项目
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/archive/">
                            
                        
                            <i class="fa fa-archive"></i>归档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/category/">
                            
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/tag/">
                            
                        
                            <i class="fa fa-tags"></i>标记
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/docs/">
                            
                        
                            <i class="fa fa-book"></i>文档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="https://xmake.io/#/zh-cn/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>社区
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/donation/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/about/">
                            
                        
                            <i class="fa fa-user"></i>关于
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.8.5 发布，支持链接排序和单元测试</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2023-11-05
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/cn/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/cn/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/cn/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> 是一个基于 Lua 的轻量级跨平台构建工具。</p>

<p>它非常的轻量，没有任何依赖，因为它内置了 Lua 运行时。</p>

<p>它使用 xmake.lua 维护项目构建，相比 makefile/CMakeLists.txt，配置语法更加简洁直观，对新手非常友好，短时间内就能快速入门，能够让用户把更多的精力集中在实际的项目开发上。</p>

<p>我们能够使用它像 Make/Ninja 那样可以直接编译项目，也可以像 CMake/Meson 那样生成工程文件，另外它还有内置的包管理系统来帮助用户解决 C/C++ 依赖库的集成使用问题。</p>

<p>目前，Xmake 主要用于 C/C++ 项目的构建，但是同时也支持其他 native 语言的构建，可以实现跟 C/C++ 进行混合编译，同时编译速度也是非常的快，可以跟 Ninja 持平。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>尽管不是很准确，但我们还是可以把 Xmake 按下面的方式来理解：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ≈ Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">项目源码</a></li>
  <li><a href="https://xmake.io/#/zh-cn/">官方文档</a></li>
  <li><a href="https://xmake.io/#/zh-cn/about/course">入门课程</a></li>
</ul>

<p><img src="https://github.com/xmake-io/xmake-docs/raw/master/assets/img/index/package.gif" width="650px" /></p>

<h2 id="新特性介绍">新特性介绍</h2>

<p>在介绍新特性之前，我们有一个好消息要告诉大家，Xmake 最近进入了 Debian 的官方仓库：<a href="https://packages.debian.org/sid/xmake">https://packages.debian.org/sid/xmake</a>，
等到明年4月份 Ubuntu 24.04 发布，我们应该就能直接通过 <code class="highlighter-rouge">apt install xmake</code> 命令去快速安装 Xmake 了。</p>

<p>同时也感谢 @Lance Lin 的帮助，他全程帮助我们维护并上传 Xmake 包到 Debian 仓库，真的非常感谢！</p>

<p>接下来，我们来介绍下 2.8.5 版本引入的一些改动，这个版本带来了很多的新特性，尤其是对链接排序，链接组的支持，还有对 <code class="highlighter-rouge">xmake test</code> 内置单元测试的支持。
另外，我们还新增了 Apple XROS 平台的构建支持，可以用于构建苹果新的 VisionOS 上的程序，还有我们还提供了更加灵活通用的 <code class="highlighter-rouge">check_sizeof</code> 检测接口，用于快速检测类型的大小。</p>

<h3 id="链接重排序支持">链接重排序支持</h3>

<p>这是一个存在了两年多的需求，主要用于调整 target 内部的链接顺序。</p>

<p>由于 xmake 提供了 <code class="highlighter-rouge">add_links</code>, <code class="highlighter-rouge">add_deps</code>, <code class="highlighter-rouge">add_packages</code>, <code class="highlighter-rouge">add_options</code> 接口，可以配置目标、依赖，包和选项中的链接，尽管 <code class="highlighter-rouge">add_links</code> 本身的链接顺序可以根据添加顺序来调整。</p>

<p>但是 links，deps 和 packages 之间的链接顺序，只能按固定顺序生成，无法灵活调整，这对于一些复杂的项目，就有点显得力不从心了。</p>

<p>而我们在这个版本，彻底解决了这个问题，新增了 <code class="highlighter-rouge">add_linkorders</code> 接口，可用于配置目标、依赖、包、选项、链接组引入的各种链接顺序。</p>

<p>更多详情和背景，请见：<a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a></p>

<h4 id="排序链接">排序链接</h4>

<p>为了更加灵活的调整 target 内部的各种链接顺序，我们可以通过 <code class="highlighter-rouge">add_linkorders</code> 这个新接口来实现，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="c1">-- e -&gt; b -&gt; a</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="c1">-- e -&gt; d</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">)</span>
</code></pre>
</div>

<p>add_links 是配置的初始链接顺序，然后我们通过 add_linkorders 配置了两个局部链接依赖 <code class="highlighter-rouge">e -&gt; b -&gt; a</code> 和 <code class="highlighter-rouge">e -&gt; d</code> 后。</p>

<p>xmake 内部就会根据这些配置，生成 DAG 图，通过拓扑排序的方式，生成最终的链接顺序，提供给链接器。</p>

<p>当然，如果存在循环依赖，产生了环，它也会提供警告信息。</p>

<h4 id="排序链接和链接组">排序链接和链接组</h4>

<p>另外，对于循环依赖，我们也可以通过 <code class="highlighter-rouge">add_linkgroups</code> 配置链接组的方式也解决。</p>

<p>并且 <code class="highlighter-rouge">add_linkorders</code> 也能够对链接组进行排序。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"linkgroup::foo"</span><span class="p">)</span>
</code></pre>
</div>

<p>如果要排序链接组，我们需要对每个链接组取个名，<code class="highlighter-rouge"><span class="p">{</span><span class="err">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="nt">"foo"</span><span class="err">}</span></code> ，然后就能在 <code class="highlighter-rouge">add_linkorders</code> 里面通过 <code class="highlighter-rouge">linkgroup::foo</code> 去引用配置了。</p>

<h4 id="排序链接和frameworks">排序链接和frameworks</h4>

<p>我们也可以排序链接和 macOS/iPhoneOS 的 frameworks。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="n">add_frameworks</span><span class="p">(</span><span class="s2">"Foundation"</span><span class="p">,</span> <span class="s2">"CoreFoundation"</span><span class="p">)</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"framework::CoreFoundation"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="完整例子">完整例子</h4>

<p>相关的完整例子，我们可以看下：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"libpng"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
    <span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"m"</span><span class="p">,</span> <span class="s2">"pthread"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"static"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"libpng"</span><span class="p">,</span> <span class="p">{</span><span class="n">public</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"demo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_deps</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/main.cpp"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"linux"</span><span class="p">,</span> <span class="s2">"macosx"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">add_syslinks</span><span class="p">(</span><span class="s2">"pthread"</span><span class="p">,</span> <span class="s2">"m"</span><span class="p">,</span> <span class="s2">"dl"</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"macosx"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">add_frameworks</span><span class="p">(</span><span class="s2">"Foundation"</span><span class="p">,</span> <span class="s2">"CoreFoundation"</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"framework::Foundation"</span><span class="p">,</span> <span class="s2">"png16"</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"dl"</span><span class="p">,</span> <span class="s2">"linkgroup::syslib"</span><span class="p">)</span>
    <span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"m"</span><span class="p">,</span> <span class="s2">"pthread"</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"syslib"</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>完整工程在：<a href="https://github.com/xmake-io/xmake/blob/master/tests/projects/c%2B%2B/linkorders/xmake.lua">linkorders example</a></p>

<h3 id="链接组支持">链接组支持</h3>

<p>另外，这个版本，我们还新增了链接组的原生支持，它目前主要用于 linux 平台的编译，仅支持 gcc/clang 编译器。</p>

<p>需要注意的是 gcc/clang 里面的链接组概念主要特指：<code class="highlighter-rouge">-Wl,--start-group</code></p>

<p>而 Xmake 对齐进行了封装，做了进一步抽象，并且不仅仅用于处理 <code class="highlighter-rouge">-Wl,--start-group</code>，还可以处理 <code class="highlighter-rouge">-Wl,--whole-archive</code> 和 <code class="highlighter-rouge">-Wl,-Bstatic</code>。</p>

<p>下面我们会一一对其进行讲解。</p>

<p>更多详情见：<a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a></p>

<h4 id="start-group-支持">–start-group 支持</h4>

<p><code class="highlighter-rouge">-Wl,--start-group</code> 和 <code class="highlighter-rouge">-Wl,--end-group</code> 是用于处理复杂库依赖关系的链接器选项，确保链接器可以解决符号依赖并成功连接多个库。</p>

<p>在 xmake 中，我们可以通过下面的方式实现：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>它会对应生成 <code class="highlighter-rouge">-Wl,--start-group -la -lb -Wl,--end-group</code> 链接选项。</p>

<p>如果 a 和 b 库之间有符号的循环依赖，也不会报链接错误，能够正常链接成功。</p>

<p>对于不支持的平台和编译，会退化成 <code class="highlighter-rouge">-la -lb</code></p>

<h4 id="whole-archive-支持">–whole-archive 支持</h4>

<p><code class="highlighter-rouge">--whole-archive</code> 是一个链接器选项，通常用于处理静态库。
它的作用是告诉链接器将指定的静态库中的所有目标文件都包含到最终可执行文件中，而不仅仅是满足当前符号依赖的目标文件。
这可以用于确保某些库的所有代码都被链接，即使它们在当前的符号依赖关系中没有直接引用。</p>

<p>更多信息，可以参考 gcc/clang 的文档。</p>

<p>在 xmake 中，我们可以通过下面的方式实现：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>它会对应生成 <code class="highlighter-rouge">-Wl,--whole-archive -la -lb -Wl,--no-whole-archive</code> 链接选项。</p>

<p>对于不支持的平台和编译，会退化成 <code class="highlighter-rouge">-la -lb</code></p>

<p>另外，我们可以同时配置 group/whole：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="-bstatic-支持">-Bstatic 支持</h4>

<p><code class="highlighter-rouge">-Bstatic</code> 也是用于编译器（如gcc）的选项，用于指示编译器在链接时只使用静态库而不使用共享库。</p>

<p>更多信息，可以参考 gcc/clang 的文档。</p>

<p>在 xmake 中，我们可以通过下面的方式实现：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">static</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>它会对应生成 <code class="highlighter-rouge">-Wl,-Bstatic -la -lb -Wl,-Bdynamic</code> 链接选项。</p>

<h3 id="单元测试支持">单元测试支持</h3>

<p>新版本中，我们还增加了一个内置的测试命令：<code class="highlighter-rouge">xmake test</code>，我们只需要在需要测试的 target 上通过 add_tests 配置一些测试用例，就可以自动执行测试。</p>

<p>即使当前 target 被设置成了 <code class="highlighter-rouge">set_default(false)</code>，在执行测试的时候，xmake 也还是会先自动编译它们，然后自动运行所有的测试。</p>

<p>我们可以先看个整体的例子，大概知道下它是怎么样子的。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">file</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"src/test_*.cpp"</span><span class="p">))</span> <span class="k">do</span>
    <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">target</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
        <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
        <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/"</span> <span class="o">..</span> <span class="n">name</span> <span class="o">..</span> <span class="s2">".cpp"</span><span class="p">)</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="s2">"default"</span><span class="p">)</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="s2">"args"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">}})</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="s2">"pass_output"</span><span class="p">,</span> <span class="p">{</span><span class="n">trim_output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">runargs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello foo"</span><span class="p">})</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="s2">"fail_output"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello2 .*"</span><span class="p">,</span> <span class="s2">"hello xmake"</span><span class="p">}})</span>
<span class="k">end</span>
</code></pre>
</div>

<p>这个例子，自动扫描源码目录下的 <code class="highlighter-rouge">test_*.cpp</code> 源文件，然后每个文件自动创建一个测试目标，它被设置成了 <code class="highlighter-rouge">set_default(false)</code>，也就是正常情况下，默认不会编译它们。</p>

<p>但是，如果执行 <code class="highlighter-rouge">xmake test</code> 进行测试，它们就会被自动编译，然后测试运行，运行效果如下：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ruki-2:test ruki<span class="nv">$ </span>xmake <span class="nb">test
</span>running tests ...
<span class="o">[</span>  2%]: test_1/args        .................................... passed 7.000s
<span class="o">[</span>  5%]: test_1/default     .................................... passed 5.000s
<span class="o">[</span>  8%]: test_1/fail_output .................................... passed 5.000s
<span class="o">[</span> 11%]: test_1/pass_output .................................... passed 6.000s
<span class="o">[</span> 13%]: test_2/args        .................................... passed 7.000s
<span class="o">[</span> 16%]: test_2/default     .................................... passed 6.000s
<span class="o">[</span> 19%]: test_2/fail_output .................................... passed 6.000s
<span class="o">[</span> 22%]: test_2/pass_output .................................... passed 6.000s
<span class="o">[</span> 25%]: test_3/args        .................................... passed 7.000s
<span class="o">[</span> 27%]: test_3/default     .................................... passed 7.000s
<span class="o">[</span> 30%]: test_3/fail_output .................................... passed 6.000s
<span class="o">[</span> 33%]: test_3/pass_output .................................... passed 6.000s
<span class="o">[</span> 36%]: test_4/args        .................................... passed 6.000s
<span class="o">[</span> 38%]: test_4/default     .................................... passed 6.000s
<span class="o">[</span> 41%]: test_4/fail_output .................................... passed 5.000s
<span class="o">[</span> 44%]: test_4/pass_output .................................... passed 6.000s
<span class="o">[</span> 47%]: test_5/args        .................................... passed 5.000s
<span class="o">[</span> 50%]: test_5/default     .................................... passed 6.000s
<span class="o">[</span> 52%]: test_5/fail_output .................................... failed 6.000s
<span class="o">[</span> 55%]: test_5/pass_output .................................... failed 5.000s
<span class="o">[</span> 58%]: test_6/args        .................................... passed 7.000s
<span class="o">[</span> 61%]: test_6/default     .................................... passed 6.000s
<span class="o">[</span> 63%]: test_6/fail_output .................................... passed 6.000s
<span class="o">[</span> 66%]: test_6/pass_output .................................... passed 6.000s
<span class="o">[</span> 69%]: test_7/args        .................................... failed 6.000s
<span class="o">[</span> 72%]: test_7/default     .................................... failed 7.000s
<span class="o">[</span> 75%]: test_7/fail_output .................................... failed 6.000s
<span class="o">[</span> 77%]: test_7/pass_output .................................... failed 5.000s
<span class="o">[</span> 80%]: test_8/args        .................................... passed 7.000s
<span class="o">[</span> 83%]: test_8/default     .................................... passed 6.000s
<span class="o">[</span> 86%]: test_8/fail_output .................................... passed 6.000s
<span class="o">[</span> 88%]: test_8/pass_output .................................... failed 5.000s
<span class="o">[</span> 91%]: test_9/args        .................................... passed 6.000s
<span class="o">[</span> 94%]: test_9/default     .................................... passed 6.000s
<span class="o">[</span> 97%]: test_9/fail_output .................................... passed 6.000s
<span class="o">[</span>100%]: test_9/pass_output .................................... passed 6.000s

<span class="gp">80% </span>tests passed, 7 tests failed out of 36, spent 0.242s
</code></pre>
</div>

<p><img src="/assets/img/manual/xmake-test1.png" alt="" /></p>

<p>我们也可以执行 <code class="highlighter-rouge">xmake test -vD</code> 查看详细的测试失败的错误信息：</p>

<p><img src="/assets/img/manual/xmake-test2.png" alt="" /></p>

<h4 id="运行指定测试目标">运行指定测试目标</h4>

<p>我们也可以指定运行指定 target 的某个测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test </span>targetname/testname
</code></pre>
</div>

<p>或者按模式匹配的方式，运行一个 target 的所有测试，或者一批测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test </span>targetname/<span class="k">*</span>
<span class="gp">$ </span>xmake <span class="nb">test </span>targetname/foo<span class="k">*</span>
</code></pre>
</div>

<p>也可以运行所有 target 的同名测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> <span class="k">*</span>/testname
</code></pre>
</div>

<h4 id="并行化运行测试">并行化运行测试</h4>

<p>其实，默认就是并行化运行的，但是我们可以通过 <code class="highlighter-rouge">-jN</code> 调整运行的并行度。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -jN
</code></pre>
</div>

<h4 id="分组运行测试">分组运行测试</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo"</span>
<span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo*"</span>
</code></pre>
</div>

<h4 id="添加测试到目标无参数">添加测试到目标（无参数）</h4>

<p>如果没有配置任何参数，仅仅配置了测试名到 <code class="highlighter-rouge">add_tests</code>，那么仅仅测试这个目标程序的是否会运行失败，根据退出代码来判断是否通过测试。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>target("test")
    add_tests("testname")
</code></pre>
</div>

<h4 id="配置运行参数">配置运行参数</h4>

<p>我们也可以通过 <code class="highlighter-rouge"><span class="p">{</span><span class="err">runargs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">{</span><span class="nt">"arg1"</span><span class="err">,</span><span class="w"> </span><span class="nt">"arg2"</span><span class="err">}}</span></code> 的方式，给 <code class="highlighter-rouge">add_tests</code> 配置指定测试需要运行的参数。</p>

<p>另外，一个 target 可以同时配置多个测试用例，每个测试用例可独立运行，互不冲突。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="s2">"arg1"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"arg1"</span><span class="p">,</span> <span class="s2">"arg2"</span><span class="p">}})</span>
</code></pre>
</div>

<p>如果我们没有配置 runargs 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">set_runargs</code> 设置的运行参数。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_runargs</span><span class="p">(</span><span class="s2">"arg1"</span><span class="p">,</span> <span class="s2">"arg2"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="配置运行目录">配置运行目录</h4>

<p>我们也可以通过 rundir 设置测试运行的当前工作目录，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">rundir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">projectdir</span><span class="p">()})</span>
</code></pre>
</div>

<p>如果我们没有配置 rundir 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">set_rundir</code> 设置的运行目录。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_rundir</span><span class="p">(</span><span class="s2">"$(projectdir)"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="配置运行环境">配置运行环境</h4>

<p>我们也可以通过 runenvs 设置一些运行时候的环境变量，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runenvs</span> <span class="o">=</span> <span class="p">{</span><span class="n">LD_LIBRARY_PATH</span> <span class="o">=</span> <span class="s2">"/lib"</span><span class="p">}})</span>
</code></pre>
</div>

<p>如果我们没有配置 runenvs 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">add_runenvs</code> 设置的运行环境。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">add_runenvs</span><span class="p">(</span><span class="s2">"LD_LIBRARY_PATH"</span><span class="p">,</span> <span class="s2">"/lib"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="匹配输出结果">匹配输出结果</h4>

<p>默认情况下，<code class="highlighter-rouge">xmake test</code> 会根据测试运行的退出代码是否为 0，来判断是否测试通过。</p>

<p>当然，我们也可以通过配置测试运行的输出结果是否满足我们的指定的匹配模式，来判断是否测试通过。</p>

<p>主要通过这两个参数控制：</p>

<table>
  <thead>
    <tr>
      <th>参数</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pass_outputs</td>
      <td>如果输出匹配，则测试通过</td>
    </tr>
    <tr>
      <td>fail_outputs</td>
      <td>如果输出匹配，则测试失败</td>
    </tr>
  </tbody>
</table>

<p>传入 <code class="highlighter-rouge">pass_outputs</code> 和 <code class="highlighter-rouge">fail_outputs</code> 的是一个 lua 匹配模式的列表，但模式稍微做了一些简化，比如对 <code class="highlighter-rouge">*</code> 的处理。</p>

<p>如果要匹配成功，则测试通过，可以这么配置：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello *"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"hello *"</span><span class="p">}})</span>
</code></pre>
</div>

<p>如果要匹配成功，则测试失败，可以这么配置：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello *"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"hello *"</span><span class="p">}})</span>
</code></pre>
</div>

<p>我们也可以同时配置它们：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<p>由于一些测试输出的结果，尾部会有一些换行什么的空白字符，干扰匹配模式，我们可以再配置 <code class="highlighter-rouge">trim_output = true</code>，先截断空白字符后，再做匹配。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">trim_output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<p>我们还可以配置 <code class="highlighter-rouge"><span class="p">{</span><span class="err">plain</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true</span><span class="p">}</span></code> 是禁用 lua 模式匹配，仅仅做最基础的平坦文本匹配。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">plain</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="配置测试组">配置测试组</h4>

<p>我们也可以通过 <code class="highlighter-rouge">group = "foo"</code> 来配置一个测试组，进行分组测试：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"bar"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname4"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"bae"</span><span class="p">})</span>
</code></pre>
</div>

<p>其中 testname1/testname2 是一个组 foo，另外两个是在另外一个组。</p>

<p>然后，我们就可以使用 <code class="highlighter-rouge">xmake test -g groupname</code> 来进行分组测试了。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo"</span>
<span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo*"</span>
</code></pre>
</div>

<p>!&gt; 运行分组，也是支持模式匹配的。</p>

<p>另外，如果没有设置 <code class="highlighter-rouge">group</code> 参数给 <code class="highlighter-rouge">add_tests</code>，我们也可以默认获取绑定到 target 的组名。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_group</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="自定义测试脚本">自定义测试脚本</h4>

<p>我们还新增了 <code class="highlighter-rouge">before_test</code>, <code class="highlighter-rouge">on_test</code> 和 <code class="highlighter-rouge">after_test</code> 配置脚本，用户可以在 rule 和 target 域，自定义配置它们实现定制化的测试执行。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">on_test</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">runenvs</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">runargs</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">pass_outputs</span><span class="p">)</span>

        <span class="c1">-- do test</span>
        <span class="c1">-- ...</span>

        <span class="c1">-- passed</span>
        <span class="k">return</span> <span class="kc">true</span>

        <span class="c1">-- failied</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="n">errors</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>其中，opt 里面可以获取到所有传入 <code class="highlighter-rouge">add_tests</code> 的参数，我们在 on_test 里面自定义测试逻辑，然后返回 true 就是测试通过，返回 false 就是测试失败，然后继续返回测试失败的错误信息。</p>

<h4 id="自动化构建">自动化构建</h4>

<p>由于测试目标在正常开发构建阶段，通常是不需要被构建的，因此我们会设置 <code class="highlighter-rouge">set_default(false)</code>。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</code></pre>
</div>

<p>但是运行 <code class="highlighter-rouge">xmake test</code> 进行测试时候，这些测试对应的 target 还是会被自动构建，确保能够被运行。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span>
<span class="o">[</span> 25%]: cache compiling.release src/main.cpp
<span class="o">[</span> 50%]: linking.release <span class="nb">test
</span>running tests ...
<span class="o">[</span>100%]: <span class="nb">test</span>/testname .................................... passed 6.000s

<span class="gp">100% </span>tests passed, 0 tests failed out of 1, spent 0.006s
</code></pre>
</div>

<h4 id="首次测试失败就终止">首次测试失败就终止</h4>

<p>默认情况下，<code class="highlighter-rouge">xmake test</code> 会等到所有测试都运行完，不管里面有多少是没通过的。</p>

<p>而有时候，我们想在第一个测试没通过，就直接中断测试，那么我们可以通过下面的配置启用：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"test.return_zero_on_failure"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="测试失败返回0">测试失败返回0</h4>

<p>默认情况下，只要有一个测试没通过，等到 <code class="highlighter-rouge">xmake test</code> 运行完成，它都会返回非0退出代码，这对于一些 CI 环境非常有用，可以中断 CI 的其他脚本继续运行。</p>

<p>然后触发信号告诉 CI，我们需要生成测试报告和告警了。</p>

<p>然后，如果我们想要压制这种行为，可以强制将 <code class="highlighter-rouge">xmake test</code> 的退出代码总是设置成 0。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"test.return_zero_on_failure"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="仅仅测试编译">仅仅测试编译</h4>

<p>有时候，我们仅仅想要测试代码是否通过编译，或者没有通过编译，不需要运行它们，那么可以通过配置 <code class="highlighter-rouge">build_should_pass</code> 和 <code class="highlighter-rouge">build_should_fail</code> 来实现。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test_10"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/compile.cpp"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"compile_fail"</span><span class="p">,</span> <span class="p">{</span><span class="n">build_should_fail</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_11"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/compile.cpp"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"compile_pass"</span><span class="p">,</span> <span class="p">{</span><span class="n">build_should_pass</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>这通常用于一些测试代码中带有 <code class="highlighter-rouge">static_assert</code> 的场景，例如：</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">foo</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"int!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"float!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="s">"unsupported type"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">foo</span><span class="p">(</span><span class="s">"BAD"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="配置额外的代码编译">配置额外的代码编译</h4>

<p>我们还可以在配置测试用例的时候，对每个测试配置额外需要编译的代码，以及一些宏定义，实现内联测试。</p>

<p>xmake 会为每个测试单独编译一个独立的可执行程序去运行它，但这并不会影响到 target 在生产环境的编译结果。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test_13"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_1.cpp"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_1"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_1.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_1"</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_14"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_2.cpp"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_2"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_2.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_2"</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_15"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_1.cpp"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_n"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_n*.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_N"</span><span class="p">})</span>
</code></pre>
</div>

<p>以 doctest 为例，我们可以在不修改任何 main.cpp 的情况下，外置单元测试：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"doctest"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"doctest"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">testfile</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"tests/*.cpp"</span><span class="p">))</span> <span class="k">do</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">testfile</span><span class="p">),</span> <span class="p">{</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">testfile</span><span class="p">,</span>
            <span class="n">remove_files</span> <span class="o">=</span> <span class="s2">"src/main.cpp"</span><span class="p">,</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">,</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="s2">"doctest"</span><span class="p">,</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="s2">"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN"</span><span class="p">})</span>
    <span class="k">end</span>
</code></pre>
</div>

<p>定义 DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN 会引入额外的 main 入口函数，因此我们需要配置 remove_files 去移除已有的 main.cpp 文件。</p>

<p>运行效果如下：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ruki-2:doctest ruki<span class="nv">$ </span>xmake <span class="nb">test
</span>running tests ...
<span class="o">[</span> 50%]: doctest/test_1 .................................... failed 0.009s
<span class="o">[</span>100%]: doctest/test_2 .................................... passed 0.009s

<span class="gp">50% </span>tests passed, 1 tests failed out of 2, spent 0.019s
ruki-2:doctest ruki<span class="nv">$ </span>xmake <span class="nb">test</span> -v
running tests ...
<span class="o">[</span> 50%]: doctest/test_1 .................................... failed 0.026s
<span class="o">[</span>doctest] doctest version is <span class="s2">"2.4.11"</span>
<span class="o">[</span>doctest] run with <span class="s2">"--help"</span> <span class="k">for </span>options
<span class="o">===============================================================================</span>
tests/test_1.cpp:7:
TEST CASE:  testing the factorial <span class="k">function

</span>tests/test_1.cpp:8: ERROR: CHECK<span class="o">(</span> factorial<span class="o">(</span>1<span class="o">)</span> <span class="o">==</span> 10 <span class="o">)</span> is NOT correct!
  values: CHECK<span class="o">(</span> 1 <span class="o">==</span> 10 <span class="o">)</span>

<span class="o">===============================================================================</span>
<span class="o">[</span>doctest] <span class="nb">test </span>cases: 1 | 0 passed | 1 failed | 0 skipped
<span class="o">[</span>doctest] assertions: 4 | 3 passed | 1 failed |
<span class="o">[</span>doctest] Status: FAILURE!

run failed, <span class="nb">exit </span>code: 1
<span class="o">[</span>100%]: doctest/test_2 .................................... passed 0.010s

<span class="gp">50% </span>tests passed, 1 tests failed out of 2, spent 0.038s
</code></pre>
</div>

<h4 id="测试动态库">测试动态库</h4>

<p>通常，<code class="highlighter-rouge">add_tests</code> 仅用于对可执行程序进行运行测试，运行动态库需要有一个额外的 main 主入口，因此我们需要额外配置一个可执行程序去加载它，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>
<span class="n">target</span><span class="p">(</span><span class="s2">"doctest_shared"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">testfile</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"tests/*.cpp"</span><span class="p">))</span> <span class="k">do</span>
        <span class="n">add_tests</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">testfile</span><span class="p">),</span> <span class="p">{</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">testfile</span><span class="p">,</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">,</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="s2">"doctest"</span><span class="p">,</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="s2">"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN"</span><span class="p">})</span>
    <span class="k">end</span>
</code></pre>
</div>

<p>通过 <code class="highlighter-rouge">kind = "binary"</code> 可以将每个单元测试改为 binary 可执行程序，并通过 <code class="highlighter-rouge">DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN</code> 引入 main 入口函数。</p>

<p>这样就能实现动态库目标中外置可运行的单元测试。</p>

<h3 id="新增类型大小检测">新增类型大小检测</h3>

<p>在先前的版本中，我们可以通过 <code class="highlighter-rouge">check_csnippets</code> 和 <code class="highlighter-rouge">output = true</code> 的方式，来实现类型检测。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">check_csnippets</span><span class="p">(</span><span class="s2">"INT_SIZE"</span><span class="p">,</span> <span class="s1">'printf("%d", sizeof(int)); return 0;'</span><span class="p">,</span> <span class="p">{</span><span class="n">output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>但是这种方式，是通过尝试运行测试代码，然后获取运行输出结果，提取类型大小信息。</p>

<p>这对于交叉编译，就不适用了。</p>

<p>在 2.8.5 版本中，我们新增了 <code class="highlighter-rouge">check_sizeof</code> 辅助接口，可以通过直接解析测试程序的二进制文件，提取类型大小信息。</p>

<p>由于不需要运行测试，这种方式不仅可以支持交叉编译，而且对检测效率也有极大的提升，使用也更加的简单。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">includes</span><span class="p">(</span><span class="s2">"@builtin/check"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"static"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"*.cpp"</span><span class="p">)</span>
    <span class="n">check_sizeof</span><span class="p">(</span><span class="s2">"LONG_SIZE"</span><span class="p">,</span> <span class="s2">"long"</span><span class="p">)</span>
    <span class="n">check_sizeof</span><span class="p">(</span><span class="s2">"STRING_SIZE"</span><span class="p">,</span> <span class="s2">"std::string"</span><span class="p">,</span> <span class="p">{</span><span class="n">includes</span> <span class="o">=</span> <span class="s2">"string"</span><span class="p">})</span>
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f -c
checking <span class="k">for </span>LONG_SIZE ... 8
checking <span class="k">for </span>STRING_SIZE ... 24
</code></pre>
</div>

<p>另外，我也可以通过 <code class="highlighter-rouge">target:check_sizeof</code> 在脚本域进行检测。</p>

<h3 id="新增-apple-xros-平台">新增 Apple XROS 平台</h3>

<p>苹果在 Xcode15 中新增了 visionOS 设备的构建支持，因此我们也在第一时间对其进行了支持，只需要执行：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f -p applexros
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>就可以完成 visionOS/XROS 平台的构建。</p>

<h3 id="支持代码合并">支持代码合并</h3>

<p>最后，我们还提供了一个小工具模块，它可以用于快速合并指定 target 里面的所有 c/c++ 和 头文件源码到单个源文件。</p>

<p>会生成类似 sqlite3.c 的这种单源码文件，用户可以根据自己的实际需求来决定是否使用这个功能。</p>

<p>而在做合并的时候，Xmake 会将内部 includes 头文件全部展开，并生成 DAG，通过拓扑排序引入。</p>

<p>默认它会处理所有 target 的合并，例如：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>我们也可以指定合并需要的目标：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate tbox
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>也可以在合并每个源文件时候，指定一个自定义的 unique ID 的宏定义，来处理符号冲突问题。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate -u MY_UNIQUEU_ID
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>如果多个源文件内部有重名符号，就可以判断这个 <code class="highlighter-rouge">MY_UNIQUEU_ID</code> 宏是否被定义，如果定义了，说明是在单文件中，就自己在源码中处理下重名符号。</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#ifdef MY_UNIQUEU_ID
</span>    <span class="c1">// do some thing
</span><span class="cp">#endif
</span></code></pre>
</div>

<p>我们也可以指定输出位置：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate -o /xxx
/xxx/tbox.c generated!
/xxx/tbox.h generated!
</code></pre>
</div>

<h3 id="新增-windowsmanifestuac-策略">新增 windows.manifest.uac 策略</h3>

<p>通过这个策略，我们可以快速方便的设置并启用 Windows UAC。</p>

<p>它支持以下几个 Level：</p>

<ul>
  <li>invoker: asInvoker</li>
  <li>admin: requireAdministrator</li>
  <li>highest: highestAvailable</li>
</ul>

<p>例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"windows.manifest.uac"</span><span class="p">,</span> <span class="s2">"admin"</span><span class="p">)</span>
</code></pre>
</div>

<p>它等价于设置</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"windows"</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">add_ldflags</span><span class="p">(</span><span class="s2">"/manifest:embed"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"/manifestuac:level='requireAdministrator' uiAccess='false'"</span><span class="p">},</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="kc">false</span><span class="p">})</span>
<span class="k">end</span>
</code></pre>
</div>

<p>但是更加方便简洁，并且不需要判断平台，其他平台自动忽略。</p>

<p>我们也可以通过 <code class="highlighter-rouge">windows.manifest.uac.ui</code> 策略，设置 Windows UAC 的 uiAccess，如果没有设置它，默认是 false。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"windows.manifest.uac.ui"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="更新日志">更新日志</h2>

<h3 id="新特性">新特性</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a>: 支持链接顺序调整，链接组</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/1438">#1438</a>: 支持代码 amalgamation</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3381">#3381</a>: 添加 <code class="highlighter-rouge">xmake test</code> 支持</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/4276">#4276</a>: 支持自定义域 API</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/4286">#4286</a>: 添加 Apple XROS 支持</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/4345">#4345</a>: 支持检测类型大小 sizeof</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/4369">#4369</a>: 添加 windows.manifest.uac 策略</li>
</ul>

<h3 id="改进">改进</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/4284">#4284</a>: 改进内置 includes 模块</li>
</ul>

<h3 id="bugs-修复">Bugs 修复</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/4256">#4256</a>: 为 vsxmake 生成器修复 c++ modules intellisense</li>
</ul>

        </article>
        <hr>

        <!-- wwads -->
        
        <div class="wwads-cn wwads-horizontal" data-id="243" style="max-width:100%"></div>
        

        <!-- baidu ads -->
        

        <!-- reward -->
        <div style="text-align: center;">
            <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
              <span>赏</span>
            </button>
            <div id="QR" style="display: none;">
                <div id="wechat" style="display: inline-block">
                  <img id="wechat_qr" src="/static/img/weixin.png" alt="WeChat Pay"/>
                  <p>微信打赏</p>
                </div>
                <div id="alipay" style="display: inline-block">
                  <img id="alipay_qr" src="/static/img/alipay.png" alt="Alipay"/>
                  <p>支付宝打赏</p>
                </div>
            </div>
        </div>

        
        
            
            
                
                    
                    <h2 id="english">English</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/2023/11/05/xmake-update-v2.8.5/">Xmake v2.8.5 released, Support for link sorting and unit testing
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
        
            </ul>
        

        
        
            
        
            
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">相关文章</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/cn/2023/09/26/xmake-update-v2.8.3/">Xmake v2.8.3 发布，改进 Wasm 并支持 Xmake 源码调试
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2023/08/22/xmake-update-v2.8.2/">Xmake v2.8.2 发布，官方包仓库数量突破 1k
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2023/07/11/xmake-update-v2.8.1/">Xmake v2.8.1 发布，大量细节特性改进
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2023/04/04/xmake-update-v2.7.8/">Xmake v2.7.8 发布，改进包虚拟环境和构建速度
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
            
        
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>上一篇</strong> <a href="/cn/2023/09/26/xmake-update-v2.8.3/">Xmake v2.8.3 发布，改进 Wasm 并支持 Xmake 源码调试</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        
    </div>
</div>


        <h2 id="comments">评论</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    内容
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#english">English</a></li>
                    <li><a href="#similar_posts">相关文章</a></li>
                    <li><a href="#comments">评论</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    链接
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- xmake courses -->
            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    xmake 入门课程
                </div>
                <a href="https://xmake.io/#/zh-cn/about/course" target="_blank">
                <img src="/static/img/xmake-course.png" alt="course" width="256" height="193">
                </a>
            </div>

            <!-- qqgroup -->
            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    技术交流群（QQ）
                </div>
                <img src="/static/img/qqgroup.png" alt="qqgroup" width="256" height="284">
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
