<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.7.3 发布，包组件和 C++ 模块增量构建支持</title>
    <meta name="description" content="Xmake 是一个基于 Lua 的轻量级跨平台构建工具。它非常的轻量，没有任何依赖，因为它内置了 Lua 运行时。它使用 xmake.lua 维护项目构建，相比 makefile/CMakeLists.txt，配置语法更加简洁直观，对新手非常友好，短时间内就能快速入门，能够让用户把更多的精力集中在实际的项目开发上...">

    
    <meta name="keywords" content="xmake,lua,C/C++,package,components,tboox" /> 

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />
	
    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/cn/2022/11/08/xmake-update-v2.7.3/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />

    <!-- css -->
    <link href="/css/reward.css" rel="stylesheet" type="text/css"> 




    <script type="text/javascript">
    function isPC(){    
        var userAgentInfo = navigator.userAgent;  
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");    
        var flag = true;    
        for (var v = 0; v < Agents.length; v++) {    
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }    
        }    
        return flag;    
    }
    </script>

<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/cn" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/?lang=0">
                    
                        <i class="fa fa-home"></i>English
                    </a>
                </li>

                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>项目
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/archive/">
                            
                        
                            <i class="fa fa-archive"></i>归档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/category/">
                            
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/tag/">
                            
                        
                            <i class="fa fa-tags"></i>标记
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/docs/">
                            
                        
                            <i class="fa fa-book"></i>文档
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="https://xmake.io/#/zh-cn/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>社区
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/donation/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                    
                    <li>
                        
                            
                            <a href="/cn/about/">
                            
                        
                            <i class="fa fa-user"></i>关于
                        </a>
                    </li>
                    
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.7.3 发布，包组件和 C++ 模块增量构建支持</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2022-11-08
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/cn/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/cn/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/cn/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>&nbsp;
    
        <!--a href="/tag/#package" title="Tag: package" rel="tag">package</a-->
        <a href="/cn/tag/#package" title="Tag: package" rel="tag">package</a>&nbsp;
    
        <!--a href="/tag/#components" title="Tag: components" rel="tag">components</a-->
        <a href="/cn/tag/#components" title="Tag: components" rel="tag">components</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> 是一个基于 Lua 的轻量级跨平台构建工具。</p>

<p>它非常的轻量，没有任何依赖，因为它内置了 Lua 运行时。</p>

<p>它使用 xmake.lua 维护项目构建，相比 makefile/CMakeLists.txt，配置语法更加简洁直观，对新手非常友好，短时间内就能快速入门，能够让用户把更多的精力集中在实际的项目开发上。</p>

<p>我们能够使用它像 Make/Ninja 那样可以直接编译项目，也可以像 CMake/Meson 那样生成工程文件，另外它还有内置的包管理系统来帮助用户解决 C/C++ 依赖库的集成使用问题。</p>

<p>目前，Xmake 主要用于 C/C++ 项目的构建，但是同时也支持其他 native 语言的构建，可以实现跟 C/C++ 进行混合编译，同时编译速度也是非常的快，可以跟 Ninja 持平。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>尽管不是很准确，但我们还是可以把 Xmake 按下面的方式来理解：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ~= Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">项目源码</a></li>
  <li><a href="https://xmake.io/#/zh-cn/">官方文档</a></li>
  <li><a href="https://xmake.io/#/zh-cn/about/course">入门课程</a></li>
</ul>

<h2 id="新特性介绍">新特性介绍</h2>

<h3 id="包组件支持">包组件支持</h3>

<h4 id="背景简介">背景简介</h4>

<p>这个新特性主要用于实现从一个 C/C++ 包中集成特定的子库，一般用于一些比较大的包中的库组件集成。</p>

<p>因为这种包里面提供了很多的子库，但不是每个子库用户都需要，全部链接反而有可能会出问题。</p>

<p>尽管，之前的版本也能够支持子库选择的特性，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"sfml~foo"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">graphics</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}})</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"sfml~bar"</span><span class="p">,</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml~foo"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml~bar"</span><span class="p">)</span>
</code></pre>
</div>

<p>这是通过每个包的自定义配置来实现的，但这种方式会存在一些问题：</p>

<ol>
  <li><code class="highlighter-rouge">sfml~foo</code> 和 <code class="highlighter-rouge">sfml~bar</code> 会作为两个独立的包，重复安装，占用双倍的磁盘空间</li>
  <li>也会重复编译一些共用代码，影响安装效率</li>
  <li>如果一个目标同时依赖了 <code class="highlighter-rouge">sfml~foo</code> 和 <code class="highlighter-rouge">sfml~bar</code>，会存在链接冲突</li>
</ol>

<p>如果是对于 boost 这种超大包的集成，重复编译和磁盘占用的影响会非常大，如果在子库组合非常多的情况下，甚至会导致超过 N 倍的磁盘占用。</p>

<p>为了解决这个问题，Xmake 新增了包组件模式，它提供了以下一些好处：</p>

<ol>
  <li>仅仅一次编译安装，任意多个组件快速集成，极大提升安装效率，减少磁盘占用</li>
  <li>组件抽象化，跨编译器和平台，用户不需要关心如何配置每个子库之间链接顺序依赖</li>
  <li>使用更加方便</li>
</ol>

<p>更多背景详情见：<a href="https://github.com/xmake-io/xmake/issues/2636">#2636</a></p>

<h4 id="使用包组件">使用包组件</h4>

<p>对于用户，使用包组件是非常方便的，因为用户是不需要维护包的，只要使用的包，它配置了相关的组件集，我们就可以快速集成和使用它，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">,</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="s2">"graphics"</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">,</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="s2">"network"</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="查看包组件">查看包组件</h4>

<p>那么，如何知道指定的包提供了哪些组件呢？我们可以通过执行下面的命令查看：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo info sfml
The package info of project:
    require<span class="o">(</span>sfml<span class="o">)</span>:
      -&gt; description: Simple and Fast Multimedia Library
      -&gt; version: 2.5.1
      ...
      -&gt; components:
         -&gt; system:
         -&gt; graphics: system, window
         -&gt; window: system
         -&gt; audio: system
         -&gt; network: system
</code></pre>
</div>

<h4 id="包组件配置">包组件配置</h4>

<p>如果你是包的维护者，想要将一个包增加组件支持，那么需要通过下面两个接口来完成包组件的配置：</p>

<ul>
  <li>add_components: 添加包组件列表</li>
  <li>on_component: 配置每个包组件</li>
</ul>

<h5 id="包组件的链接配置">包组件的链接配置</h5>

<p>大多数情况下，包组件只需要配置它自己的一些子链接信息，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"audio"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"window"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"system"</span><span class="p">)</span>

    <span class="n">on_component</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="kd">local</span> <span class="n">e</span> <span class="o">=</span> <span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">""</span> <span class="ow">or</span> <span class="s2">"-s"</span>
        <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"links"</span><span class="p">,</span> <span class="s2">"sfml-graphics"</span> <span class="o">..</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">package</span><span class="p">:</span><span class="n">is_plat</span><span class="p">(</span><span class="s2">"windows"</span><span class="p">,</span> <span class="s2">"mingw"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"links"</span><span class="p">,</span> <span class="s2">"freetype"</span><span class="p">)</span>
            <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"syslinks"</span><span class="p">,</span> <span class="s2">"opengl32"</span><span class="p">,</span> <span class="s2">"gdi32"</span><span class="p">,</span> <span class="s2">"user32"</span><span class="p">,</span> <span class="s2">"advapi32"</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span><span class="p">)</span>

    <span class="n">on_component</span><span class="p">(</span><span class="s2">"window"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="kd">local</span> <span class="n">e</span> <span class="o">=</span> <span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">""</span> <span class="ow">or</span> <span class="s2">"-s"</span>
        <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"links"</span><span class="p">,</span> <span class="s2">"sfml-window"</span> <span class="o">..</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">package</span><span class="p">:</span><span class="n">is_plat</span><span class="p">(</span><span class="s2">"windows"</span><span class="p">,</span> <span class="s2">"mingw"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">package</span><span class="p">:</span><span class="n">config</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"syslinks"</span><span class="p">,</span> <span class="s2">"opengl32"</span><span class="p">,</span> <span class="s2">"gdi32"</span><span class="p">,</span> <span class="s2">"user32"</span><span class="p">,</span> <span class="s2">"advapi32"</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span><span class="p">)</span>

    <span class="o">...</span>
</code></pre>
</div>

<p>上面是一个不完整的包配置，我仅仅摘取一部分跟包组件相关的配置。</p>

<p>一个关于包组件的配置和使用的完整例子见：<a href="https://github.com/xmake-io/xmake/blob/master/tests/projects/package/components/xmake.lua">components example</a></p>

<h5 id="配置组件的编译信息">配置组件的编译信息</h5>

<p>我们不仅可以配置每个组件的链接信息，还有 includedirs, defines 等等编译信息，我们也可以对每个组件单独配置。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>
    <span class="n">on_component</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="n">package</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"TEST"</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h5 id="配置组件依赖">配置组件依赖</h5>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"audio"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"window"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"system"</span><span class="p">)</span>

    <span class="n">on_component</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
          <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"deps"</span><span class="p">,</span> <span class="s2">"window"</span><span class="p">,</span> <span class="s2">"system"</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>上面的配置，告诉包，我们的 graphics 组件还会额外依赖 <code class="highlighter-rouge">window</code> 和 <code class="highlighter-rouge">system</code> 两个组件。</p>

<p>因此，在用户端，我们对 graphics 的组件使用，可以从</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">,</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="s2">"window"</span><span class="p">,</span> <span class="s2">"system"</span><span class="p">})</span>
</code></pre>
</div>

<p>简化为：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">,</span> <span class="p">{</span><span class="n">components</span> <span class="o">=</span> <span class="s2">"graphics"</span><span class="p">)</span>
</code></pre>
</div>

<p>因为，只要我们开启了 graphics 组件，它也会自动启用依赖的 window 和 system 组件，并且自动保证链接顺序正确。</p>

<p>另外，我们也可以通过 <code class="highlighter-rouge">add_components("graphics", {deps = {"window", "system"}})</code> 来配置组件依赖关系。</p>

<h5 id="从系统库中查找组件">从系统库中查找组件</h5>

<p>我们知道，在包配置中，配置 <code class="highlighter-rouge">add_extsources</code> 可以改进包在系统中的查找，比如从 apt/pacman 等系统包管理器中找库。</p>

<p>当然，我们也可以让每个组件也能通过 <code class="highlighter-rouge">extsources</code> 配置，去优先从系统库中找到它们。</p>

<p>例如，sfml 包，它在 homebrew 中其实也是组件化的，我们完全可以让包从系统库中，找到对应的每个组件，而不需要每次源码安装它们。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls -l /usr/local/opt/sfml/lib/pkgconfig
-r--r--r--  1 ruki  admin  317 10 19 17:52 sfml-all.pc
-r--r--r--  1 ruki  admin  534 10 19 17:52 sfml-audio.pc
-r--r--r--  1 ruki  admin  609 10 19 17:52 sfml-graphics.pc
-r--r--r--  1 ruki  admin  327 10 19 17:52 sfml-network.pc
-r--r--r--  1 ruki  admin  302 10 19 17:52 sfml-system.pc
-r--r--r--  1 ruki  admin  562 10 19 17:52 sfml-window.pc
</code></pre>
</div>

<p>我们只需要，对每个组件配置它的 extsources：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"macosx"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">add_extsources</span><span class="p">(</span><span class="s2">"brew::sfml/sfml-all"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">on_component</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="c1">-- ...</span>
        <span class="n">component</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"extsources"</span><span class="p">,</span> <span class="s2">"brew::sfml/sfml-graphics"</span><span class="p">)</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h5 id="默认的全局组件配置">默认的全局组件配置</h5>

<p>除了通过指定组件名的方式，配置特定组件，如果我们没有指定组件名，默认就是全局配置所有组件。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>
    <span class="n">on_component</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="c1">-- configure all components</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>当然，我们也可以通过下面的方式，指定配置 graphics 组件，剩下的组件通过默认的全局配置接口进行配置：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"sfml"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"audio"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"window"</span><span class="p">)</span>
    <span class="n">add_components</span><span class="p">(</span><span class="s2">"system"</span><span class="p">)</span>

    <span class="n">on_component</span><span class="p">(</span><span class="s2">"graphics"</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="c1">-- configure graphics</span>
    <span class="k">end</span><span class="p">)</span>

    <span class="n">on_component</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="c1">-- component audio, network, window, system</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="c-模块构建改进">C++ 模块构建改进</h3>

<h4 id="增量构建支持">增量构建支持</h4>

<p>原本以为 Xmake 对 C++ 模块已经支持的比较完善了，后来才发现，它的增量编译还无法正常工作。</p>

<p>因此，这个版本 Xmake 对 C++ 模块的增量编译也做了很好的支持，尽管支持过程还是花了很多精力的。</p>

<p>我分析了下，各家的编译器对生成带模块的 include 依赖信息格式（<code class="highlighter-rouge">*.d</code>），差异还是非常大的。</p>

<p>gcc 的格式最复杂，不过我还是将它支持上了。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nl">build/.objs/dependence/linux/x86_64/release/src/foo.mpp.o</span><span class="o">:</span> <span class="nf">src/foo.mpp</span>\
<span class="nf">build/.objs/dependence/linux/x86_64/release/src/foo.mpp.o  gcm.cache/foo.gcm: bar.c++m cat.c++m</span>\
<span class="nf">foo.c++m: gcm.cache/foo.gcm</span>\
<span class="nf">.PHONY: foo.c++m</span>\
<span class="nf">gcm.cache/foo.gcm:|  build/.objs/dependence/linux/x86_64/release/src/foo.mpp.o</span>\
<span class="nf">CXX_IMPORTS += bar.c++m cat.c++m</span>\
</code></pre>
</div>

<p>clang 的格式兼容性最好，没有做任何特殊改动就支持了。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>build//hello.pcm:   /usr/lib/llvm-15/lib/clang/15.0.2/include/module.modulemap   src/hello.mpp\
</code></pre>
</div>

<p>msvc 的格式扩展性比较好，解析和支持起来比较方便：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"Data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"Source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c:\users\ruki\desktop\user_headerunit\src\main.cpp"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ProvidedModule"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"Includes"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nt">"ImportedModules"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"BMI"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c:\users\ruki\desktop\user_headerunit\src\hello.ifc"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"ImportedHeaderUnits"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"Header"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c:\users\ruki\desktop\user_headerunit\src\header.hpp"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"BMI"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c:\users\ruki\desktop\user_headerunit\src\header.hpp.ifc"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="循环依赖检测支持">循环依赖检测支持</h4>

<p>由于模块之间是存在依赖关系的，因此如果有几个模块之间存在循环依赖引用，那么是无法编译通过的。</p>

<p>但是之前的版本中，Xmake 无法检测到这种情况，遇到循环依赖，编译就会卡死，没有任何提示信息，这对用户非常不友好。</p>

<p>而新版本中，我们对这种情况做了改进，增加了模块的循环依赖检测，编译时候会出现以下错误提示，方便用户定位问题：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake
<span class="o">[</span>  0%]: generating.cxx.module.deps Foo.mpp
<span class="o">[</span>  0%]: generating.cxx.module.deps Foo2.mpp
<span class="o">[</span>  0%]: generating.cxx.module.deps Foo3.mpp
<span class="o">[</span>  0%]: generating.cxx.module.deps main.cpp
error: circular modules dependency<span class="o">(</span>Foo2, Foo, Foo3, Foo2<span class="o">)</span> detected!
  -&gt; module<span class="o">(</span>Foo2<span class="o">)</span> <span class="k">in </span>Foo2.mpp
  -&gt; module<span class="o">(</span>Foo<span class="o">)</span> <span class="k">in </span>Foo.mpp
  -&gt; module<span class="o">(</span>Foo3<span class="o">)</span> <span class="k">in </span>Foo3.mpp
  -&gt; module<span class="o">(</span>Foo2<span class="o">)</span> <span class="k">in </span>Foo2.mpp
</code></pre>
</div>

<h3 id="更加-lsp-友好的语法格式">更加 LSP 友好的语法格式</h3>

<p>我们默认约定的域配置语法，尽管非常简洁，但是对自动格式化缩进和 IDE 不是很友好，如果你格式化配置，缩进就完全错位了。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
</code></pre>
</div>

<p>另外，如果两个 target 之间配置了一些全局的配置，那么它不能自动结束当前 target 作用域，用户需要显式调用 <code class="highlighter-rouge">target_end()</code>。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
<span class="n">target_end</span><span class="p">()</span>

<span class="n">add_defines</span><span class="p">(</span><span class="s2">"ROOT"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
</code></pre>
</div>

<p>虽然，上面我们提到，可以使用 <code class="highlighter-rouge">do end</code> 模式来解决自动缩进问题，但是需要 <code class="highlighter-rouge">target_end()</code> 的问题还是存在。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">target_end</span><span class="p">()</span>

<span class="n">add_defines</span><span class="p">(</span><span class="s2">"ROOT"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>因此，在新版本中，我们提供了一种更好的可选域配置语法，来解决自动缩进，target 域隔离问题，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>

<span class="n">add_defines</span><span class="p">(</span><span class="s2">"ROOT"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>foo 和 bar 两个域是完全隔离的，我们即使在它们中间配置其他设置，也不会影响它们，另外，它还对 LSP 非常友好，即使一键格式化，也不会导致缩进混乱。</p>

<p>注：这仅仅只是一只可选的扩展语法，现有的配置语法还是完全支持的，用户可以根据自己的需求喜好，来选择合适的配置语法。</p>

<h3 id="为特定编译器添加-flags">为特定编译器添加 flags</h3>

<p>使用 <code class="highlighter-rouge">add_cflags</code>, <code class="highlighter-rouge">add_cxxflags</code> 等接口配置的值，通常都是跟编译器相关的，尽管 Xmake 也提供了自动检测和映射机制，
即使设置了当前编译器不支持的 flags，Xmake 也能够自动忽略它，但是还是会有警告提示。</p>

<p>新版本中，我们改进了所有 flags 添加接口，可以仅仅对特定编译器指定 flags，来避免额外的警告，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_cxxflags</span><span class="p">(</span><span class="s2">"clang::-stdlib=libc++"</span><span class="p">)</span>
<span class="n">add_cxxflags</span><span class="p">(</span><span class="s2">"gcc::-stdlib=libc++"</span><span class="p">)</span>
</code></pre>
</div>

<p>或者：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_cxxflags</span><span class="p">(</span><span class="s2">"-stdlib=libc++"</span><span class="p">,</span> <span class="p">{</span><span class="n">tools</span> <span class="o">=</span> <span class="s2">"clang"</span><span class="p">})</span>
<span class="n">add_cxxflags</span><span class="p">(</span><span class="s2">"-stdlib=libc++"</span><span class="p">,</span> <span class="p">{</span><span class="n">tools</span> <span class="o">=</span> <span class="s2">"gcc"</span><span class="p">})</span>
</code></pre>
</div>

<p>注：不仅仅是编译flags，对 add_ldflags 等链接 flags，也是同样生效的。</p>

<h3 id="renderdoc-调试器支持">renderdoc 调试器支持</h3>

<p>感谢 <a href="https://github.com/SirLynix">@SirLynix</a> 贡献了这个很棒的特性，它可以让 Xmake 直接加载 renderdoc 去调试一些图形渲染程序。</p>

<p>使用非常简单，我们先确保安装了 renderdoc，然后配置调试器为 renderdoc，加载调试运行：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f --debugger<span class="o">=</span>renderdoc
<span class="gp">$ </span>xmake run -d
</code></pre>
</div>

<p>具体使用效果如下：</p>

<p><img src="/static/img/xmake/renderdoc.gif" width="650px" /></p>

<h3 id="新增-c-异常接口配置">新增 C++ 异常接口配置</h3>

<p>Xmake 新增了一个 <code class="highlighter-rouge">set_exceptions</code> 抽象化配置接口，我们可以通过这个配置，配置启用和禁用 C++/Objc 的异常。</p>

<p>通常，如果我们通过 add_cxxflags 接口去配置它们，需要根据不同的平台，编译器分别处理它们，非常繁琐。</p>

<p>例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>    <span class="n">on_config</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">target</span><span class="p">:</span><span class="n">has_tool</span><span class="p">(</span><span class="s2">"cxx"</span><span class="p">,</span> <span class="s2">"cl"</span><span class="p">))</span> <span class="k">then</span>
            <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"cxflags"</span><span class="p">,</span> <span class="s2">"/EHsc"</span><span class="p">,</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
            <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"_HAS_EXCEPTIONS=1"</span><span class="p">,</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
        <span class="k">elseif</span><span class="p">(</span><span class="n">target</span><span class="p">:</span><span class="n">has_tool</span><span class="p">(</span><span class="s2">"cxx"</span><span class="p">,</span> <span class="s2">"clang"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">target</span><span class="p">:</span><span class="n">has_tool</span><span class="p">(</span><span class="s2">"cxx"</span><span class="p">,</span> <span class="s2">"clang-cl"</span><span class="p">))</span> <span class="k">then</span>
            <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"cxflags"</span><span class="p">,</span> <span class="s2">"-fexceptions"</span><span class="p">,</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
            <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"cxflags"</span><span class="p">,</span> <span class="s2">"-fcxx-exceptions"</span><span class="p">,</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
        <span class="k">end</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>而通过这个接口，我们就可以抽象化成编译器无关的方式去配置它们。</p>

<p>开启 C++ 异常:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_exceptions</span><span class="p">(</span><span class="s2">"cxx"</span><span class="p">)</span>
</code></pre>
</div>

<p>禁用 C++ 异常:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_exceptions</span><span class="p">(</span><span class="s2">"no-cxx"</span><span class="p">)</span>
</code></pre>
</div>

<p>我们也可以同时配置开启 objc 异常。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_exceptions</span><span class="p">(</span><span class="s2">"cxx"</span><span class="p">,</span> <span class="s2">"objc"</span><span class="p">)</span>
</code></pre>
</div>

<p>或者禁用它们。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_exceptions</span><span class="p">(</span><span class="s2">"no-cxx"</span><span class="p">,</span> <span class="s2">"no-objc"</span><span class="p">)</span>
</code></pre>
</div>

<p>Xmake 会在内部自动根据不同的编译器，去适配对应的 flags。</p>

<h3 id="支持-ispc-编译规则">支持 ispc 编译规则</h3>

<p>Xmake 新增了 ipsc 编译器内置规则支持，非常感谢 <a href="https://github.com/star-hengxing">@star-hengxing</a> 的贡献，具体使用方式如下：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_rules</span><span class="p">(</span><span class="s2">"utils.ispc"</span><span class="p">,</span> <span class="p">{</span><span class="n">header_extension</span> <span class="o">=</span> <span class="s2">"_ispc.h"</span><span class="p">})</span>
    <span class="n">set_values</span><span class="p">(</span><span class="s2">"ispc.flags"</span><span class="p">,</span> <span class="s2">"--target=host"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.ispc"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="支持-msvc-的-armasm-编译器">支持 msvc 的 armasm 编译器</h3>

<p>之前的版本，Xmake 增加了 Windows ARM 的初步支持，但是对 asm 编译还没有很好的支持，因此这个版本，我们继续完善 Windows ARM 的支持。</p>

<p>对 msvc 的 <code class="highlighter-rouge">armasm.exe</code> 和 <code class="highlighter-rouge">armasm64.exe</code> 都支持上了。</p>

<p>另外，我们也改进了包对 Windows ARM 平台的交叉编译支持。</p>

<h3 id="新增-gnu-rm-构建规则">新增 gnu-rm 构建规则</h3>

<p>Xmake 也新增了一个使用 gnu-rm 工具链去构建嵌入式项目的规则和例子工程，非常感谢 <a href="https://github.com/JacobPeng">@JacobPeng</a> 的贡献。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"gnu-rm"</span><span class="p">)</span>
<span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@gnu-rm"</span><span class="p">)</span>
<span class="n">set_plat</span><span class="p">(</span><span class="s2">"cross"</span><span class="p">)</span>
<span class="n">set_arch</span><span class="p">(</span><span class="s2">"armv7"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">add_rules</span><span class="p">(</span><span class="s2">"gnu-rm.static"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo/*.c"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
    <span class="n">add_deps</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">add_rules</span><span class="p">(</span><span class="s2">"gnu-rm.binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">,</span> <span class="s2">"src/*.S"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.ld"</span><span class="p">)</span>
    <span class="n">add_includedirs</span><span class="p">(</span><span class="s2">"src/lib/cmsis"</span><span class="p">)</span>
</code></pre>
</div>

<p>完整工程见：<a href="https://github.com/xmake-io/xmake/blob/master/tests/projects/embed/gnu-rm/hello/xmake.lua">Embed GNU-RM Example</a></p>

<h3 id="新增-openbsd-系统支持">新增 OpenBSD 系统支持</h3>

<p>之前的版本，Xmake 仅仅支持 FreeBSD 系统，而 OpenBSD 跟 FreeBSD 还是有不少差异的，导致 Xmake 无法在它上面正常编译安装。</p>

<p>而新版本已经完全支持在 OpenBSD 上运行 Xmake 了。</p>

<h2 id="更新内容">更新内容</h2>

<h3 id="新特性">新特性</h3>

<ul>
  <li>一种新的可选域配置语法，对 LSP 友好，并且支持域隔离。</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2944">#2944</a>: 为嵌入式工程添加 <code class="highlighter-rouge">gnu-rm.binary</code> 和 <code class="highlighter-rouge">gnu-rm.static</code> 规则和测试工程</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2636">#2636</a>: 支持包组件</li>
  <li>支持 msvc 的 armasm/armasm64</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3023">#3023</a>: 改进 xmake run -d，添加 renderdoc 调试器支持</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3022">#3022</a>: 为特定编译器添加 flags</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3025">#3025</a>: 新增 C++ 异常接口配置</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3017">#3017</a>: 支持 ispc 编译器规则</li>
</ul>

<h3 id="改进">改进</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/2925">#2925</a>: 改进 doxygen 插件</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2948">#2948</a>: 支持 OpenBSD</li>
  <li>添加 <code class="highlighter-rouge">xmake g --insecure-ssl=y</code> 配置选项去禁用 ssl 证书检测</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/2971">#2971</a>: 使 vs/vsxmake 工程生成的结果每次保持一致</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3000">#3000</a>: 改进 C++ 模块构建支持，实现增量编译支持</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3016">#3016</a>: 改进 clang/msvc 去更好地支持 std 模块</li>
</ul>

<h3 id="bugs-修复">Bugs 修复</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/2949">#2949</a>: 修复 vs 分组</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2952">#2952</a>: 修复 armlink 处理长命令失败问题</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2954">#2954</a>: 修复 c++ module partitions 路径无效问题</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3033">#3033</a>: 探测循环模块依赖</li>
</ul>

        </article>
        <hr>

        <!-- baidu ads -->
        

        <!-- reward -->
        <div style="text-align: center;">
            <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
              <span>赏</span>
            </button>
            <div id="QR" style="display: none;">
                <div id="wechat" style="display: inline-block">
                  <img id="wechat_qr" src="/static/img/weixin.png" alt="WeChat Pay"/>
                  <p>微信打赏</p>
                </div>
                <div id="alipay" style="display: inline-block">
                  <img id="alipay_qr" src="/static/img/alipay.png" alt="Alipay"/>
                  <p>支付宝打赏</p>
                </div>
            </div>
        </div>

        
        
            
            
                
                    
                    <h2 id="english">English</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/2022/11/08/xmake-update-v2.7.3/">Xmake v2.7.3 Released, Package Components and C++ Modules Incremental Build Support
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
        
            </ul>
        

        
        
            
        
            
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">相关文章</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/cn/2022/10/09/xmake-update-v2.7.2/">Xmake v2.7.2 发布，更加智能化构建第三方库
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2022/08/25/xmake-update-v2.7.1/">Xmake v2.7.1 发布，更好的 C++ Modules 支持
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2022/05/24/xmake-update-v2.6.6/">Xmake v2.6.6 发布，分布式编译和缓存支持
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2022/05/01/xmake-summer-2022/">Summer2022：暑期来 Xmake 社区做项目吧，还有奖金领取哦
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/cn/2022/04/24/xmake-update-v2.6.5/">xmake v2.6.5 发布，远程编译支持
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>上一篇</strong> <a href="/cn/2022/10/09/xmake-update-v2.7.2/">Xmake v2.7.2 发布，更加智能化构建第三方库</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        

        

        
        
        

        

        

        

        
    </div>
</div>


        <h2 id="comments">评论</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- codefund ads -->
            

            <!-- Content -->
            <div class="side content">
                <div>
                    内容
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#english">English</a></li>
                    <li><a href="#similar_posts">相关文章</a></li>
                    <li><a href="#comments">评论</a></li>
                </ul>
            </div>


            <!-- baidu ads -->
            
            
            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    链接
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div> 

            <!-- xmake courses -->
            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    xmake 入门课程
                </div>
                <a href="https://xmake.io/#/zh-cn/about/course" target="_blank">
                <img src="/static/img/xmake-course.png" alt="course" width="256" height="193">
                </a>
            </div>

            <!-- qqgroup -->
            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    技术交流群（QQ）
                </div>
                <img src="/static/img/qqgroup.png" alt="qqgroup" width="256" height="284">
            </div> 

            <!-- google ads -->
            

            <!-- baidu ads -->
            

        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
