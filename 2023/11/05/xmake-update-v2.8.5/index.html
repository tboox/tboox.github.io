<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.8.5 released, Support for link sorting and unit testing</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build utility based on Lua.It is very lightweight and has no dependencies because it has a built-in Lua runtime.It uses...">

    
    <meta name="keywords" content="xmake,lua,C/C++,package,performance,API,rust,tboox" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2023/11/05/xmake-update-v2.8.5/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/404.html/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.8.5 released, Support for link sorting and unit testing</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2023-11-05
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>&nbsp;
    
        <!--a href="/tag/#package" title="Tag: package" rel="tag">package</a-->
        <a href="/tag/#package" title="Tag: package" rel="tag">package</a>&nbsp;
    
        <!--a href="/tag/#performance" title="Tag: performance" rel="tag">performance</a-->
        <a href="/tag/#performance" title="Tag: performance" rel="tag">performance</a>&nbsp;
    
        <!--a href="/tag/#API" title="Tag: API" rel="tag">API</a-->
        <a href="/tag/#API" title="Tag: API" rel="tag">API</a>&nbsp;
    
        <!--a href="/tag/#rust" title="Tag: rust" rel="tag">rust</a-->
        <a href="/tag/#rust" title="Tag: rust" rel="tag">rust</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build utility based on Lua.</p>

<p>It is very lightweight and has no dependencies because it has a built-in Lua runtime.</p>

<p>It uses xmake.lua to maintain project builds and its configuration syntax is very simple and readable.</p>

<p>We can use it to build project directly like Make/Ninja, or generate project files like CMake/Meson, and it also has a built-in package management system to help users solve the integrated use of C/C++ dependent libraries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>Although not very precise, we can still understand Xmake in the following way:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ≈ Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<p><img src="https://github.com/xmake-io/xmake-docs/raw/master/assets/img/index/package.gif" width="650px" /></p>

<h2 id="introduction-of-new-features">Introduction of new features</h2>

<p>Before introducing new features, we have good news to tell you that Xmake has recently entered Debian’s official repository: <a href="https://packages.debian.org/ sid/xmake">https://packages.debian.org/sid/xmake</a>,
When Ubuntu 24.04 is released in April next year, we should be able to quickly install Xmake directly through the <code class="highlighter-rouge">apt install xmake</code> command.</p>

<p>I would also like to thank @Lance Lin for his help. He helped us maintain and upload the Xmake package to the Debian repository throughout the whole process. Thank you very much!</p>

<p>Next, let’s introduce some changes introduced in version 2.8.5. This version brings many new features, especially support for link sorting, link groups, and support for <code class="highlighter-rouge">xmake test</code> built-in unit tests.
In addition, we have also added build support for the Apple XROS platform, which can be used to build programs on Apple’s new VisionOS. We also provide a more flexible and versatile <code class="highlighter-rouge">check_sizeof</code> detection interface for quickly detecting the size of types.</p>

<h3 id="link-reordering-support">Link reordering support</h3>

<p>This is a requirement that has existed for more than two years and is mainly used to adjust the link order within the target.</p>

<p>Since xmake provides <code class="highlighter-rouge">add_links</code>, <code class="highlighter-rouge">add_deps</code>, <code class="highlighter-rouge">add_packages</code>, <code class="highlighter-rouge">add_options</code> interfaces, you can configure links in targets, dependencies, packages and options, although the link order of <code class="highlighter-rouge">add_links</code> itself can be adjusted according to the order of addition.</p>

<p>However, the link order between links, deps and packages can only be generated in a fixed order and cannot be adjusted flexibly. This is a bit inadequate for some complex projects.</p>

<p>In this version, we have completely solved this problem and added the <code class="highlighter-rouge">add_linkorders</code> interface, which can be used to configure various link orders introduced by targets, dependencies, packages, options, and link groups.</p>

<p>For more details and background, see: <a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a></p>

<h4 id="sort-links">Sort links</h4>

<p>In order to more flexibly adjust the various link orders within the target, we can implement it through the new interface <code class="highlighter-rouge">add_linkorders</code>, for example:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="c1">-- e -&gt; b -&gt; a</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="c1">--e-&gt;d</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">)</span>
</code></pre>
</div>

<p>add_links is the configured initial link order, and then we configure two local link dependencies <code class="highlighter-rouge">e -&gt; b -&gt; a</code> and <code class="highlighter-rouge">e -&gt; d</code> through add_linkorders.</p>

<p>xmake will internally generate a DAG graph based on these configurations, and use topological sorting to generate the final link sequence and provide it to the linker.</p>

<p>Of course, if there is a circular dependency and a cycle is created, it will also provide warning information.</p>

<h4 id="sorting-links-and-link-groups">Sorting links and link groups</h4>

<p>In addition, we can also solve the problem of circular dependencies by configuring link groups through <code class="highlighter-rouge">add_linkgroups</code>.</p>

<p>And <code class="highlighter-rouge">add_linkorders</code> can also sort link groups.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"linkgroup::foo"</span><span class="p">)</span>
</code></pre>
</div>

<p>If we want to sort link groups, we need to give each link group a name, <code class="highlighter-rouge"><span class="p">{</span><span class="err">name</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="nt">"foo"</span><span class="err">}</span></code>, and then we can reference the configuration through <code class="highlighter-rouge">linkgroup::foo</code> in <code class="highlighter-rouge">add_linkorders</code>.</p>

<h4 id="sort-links-and-frameworks">Sort links and frameworks</h4>

<p>We can also sort links and frameworks for macOS/iPhoneOS.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_links</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="n">add_frameworks</span><span class="p">(</span><span class="s2">"Foundation"</span><span class="p">,</span> <span class="s2">"CoreFoundation"</span><span class="p">)</span>
<span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"framework::CoreFoundation"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="complete-example">Complete example</h4>

<p>For a complete example, we can look at:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"libpng"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
     <span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"m"</span><span class="p">,</span> <span class="s2">"pthread"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"static"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
     <span class="n">add_packages</span><span class="p">(</span><span class="s2">"libpng"</span><span class="p">,</span> <span class="p">{</span><span class="n">public</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"demo"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_deps</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/main.cpp"</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"linux"</span><span class="p">,</span> <span class="s2">"macosx"</span><span class="p">)</span> <span class="k">then</span>
         <span class="n">add_syslinks</span><span class="p">(</span><span class="s2">"pthread"</span><span class="p">,</span> <span class="s2">"m"</span><span class="p">,</span> <span class="s2">"dl"</span><span class="p">)</span>
     <span class="k">end</span>
     <span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"macosx"</span><span class="p">)</span> <span class="k">then</span>
         <span class="n">add_frameworks</span><span class="p">(</span><span class="s2">"Foundation"</span><span class="p">,</span> <span class="s2">"CoreFoundation"</span><span class="p">)</span>
     <span class="k">end</span>
     <span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"framework::Foundation"</span><span class="p">,</span> <span class="s2">"png16"</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>
     <span class="n">add_linkorders</span><span class="p">(</span><span class="s2">"dl"</span><span class="p">,</span> <span class="s2">"linkgroup::syslib"</span><span class="p">)</span>
     <span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"m"</span><span class="p">,</span> <span class="s2">"pthread"</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"syslib"</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>The complete project is at: <a href="https://github.com/xmake-io/xmake/blob/master/tests/projects/c%2B%2B/linkorders/xmake.lua">linkorders example</a></p>

<h3 id="link-group-support">Link group support</h3>

<p>In addition, in this version, we have also added native support for the link group, which is currently mainly used for compilation on the Linux platform and only supports the gcc/clang compiler.</p>

<p>It should be noted that the concept of link group in gcc/clang mainly refers to: <code class="highlighter-rouge">-Wl,--start-group</code></p>

<p>Xmake is aligned and encapsulated, further abstracted, and not only used to process <code class="highlighter-rouge">-Wl,--start-group</code>, but also <code class="highlighter-rouge">-Wl,--whole-archive</code> and <code class="highlighter-rouge">-Wl,-Bstatic</code> .</p>

<p>Below we will explain them one by one.</p>

<p>For more details, see: <a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a></p>

<h4 id="start-group-support">–start-group support</h4>

<p><code class="highlighter-rouge">-Wl,--start-group</code> and <code class="highlighter-rouge">-Wl,--end-group</code> are linker options for handling complex library dependencies, ensuring that the linker can resolve symbolic dependencies and successfully connect multiple libraries.</p>

<p>In xmake, we can achieve this in the following way:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>It will generate the corresponding <code class="highlighter-rouge">-Wl,--start-group -la -lb -Wl,--end-group</code> link options.</p>

<p>If there is a symbolic circular dependency between libraries a and b, no link error will be reported and the link can be successful.</p>

<p>For unsupported platforms and compilations, it will fall back to <code class="highlighter-rouge">-la -lb</code></p>

<h4 id="whole-archive-support">–whole-archive support</h4>

<p><code class="highlighter-rouge">--whole-archive</code> is a linker option commonly used when dealing with static libraries.
Its function is to tell the linker to include all object files in the specified static library into the final executable file, not just the object files that satisfy the current symbol dependencies.
This can be used to ensure that all code for certain libraries is linked, even if they are not directly referenced in the current symbol dependencies.</p>

<p>For more information, please refer to the gcc/clang documentation.</p>

<p>In xmake, we can achieve this in the following way:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>It will generate the corresponding <code class="highlighter-rouge">-Wl,--whole-archive -la -lb -Wl,--no-whole-archive</code> link options.</p>

<p>For unsupported platforms and compilations, it will fall back to <code class="highlighter-rouge">-la -lb</code></p>

<p>Additionally, we can configure group/whole at the same time:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">whole</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="-bstatic-support">-Bstatic support</h4>

<p><code class="highlighter-rouge">-Bstatic</code> is also an option for compilers (such as gcc) to instruct the compiler to use only static libraries and not shared libraries when linking.</p>

<p>For more information, please refer to the gcc/clang documentation.</p>

<p>In xmake, we can achieve this in the following way:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_linkgroups</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="p">{</span><span class="n">static</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>It will generate the corresponding <code class="highlighter-rouge">-Wl,-Bstatic -la -lb -Wl,-Bdynamic</code> linkage options.</p>

<h3 id="unit-testing-support">Unit testing support</h3>

<p>In the new version, we have also added a built-in test command: <code class="highlighter-rouge">xmake test</code>. We only need to configure some test cases through add_tests on the target that needs to be tested to automatically execute the test.</p>

<p>Even if the current target is set to <code class="highlighter-rouge">set_default(false)</code>, when executing tests, xmake will still automatically compile them first, and then automatically run all tests.</p>

<p>We can first look at an overall example to get a rough idea of what it looks like.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">file</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"src/test_*.cpp"</span><span class="p">))</span> <span class="k">do</span>
     <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
     <span class="n">target</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
         <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
         <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
         <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/"</span> <span class="o">..</span> <span class="n">name</span> <span class="o">..</span> <span class="s2">".cpp"</span><span class="p">)</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="s2">"default"</span><span class="p">)</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="s2">"args"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">}})</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="s2">"pass_output"</span><span class="p">,</span> <span class="p">{</span><span class="n">trim_output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">runargs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello foo"</span><span class="p">})</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="s2">"fail_output"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello2 .*"</span><span class="p">,</span> <span class="s2">"hello xmake"</span><span class="p">}})</span>
<span class="k">end</span>
</code></pre>
</div>

<p>This example automatically scans the <code class="highlighter-rouge">test_*.cpp</code> source files in the source code directory, and then automatically creates a test target for each file. It is set to <code class="highlighter-rouge">set_default(false)</code>, which means that under normal circumstances, it will not be compiled by default. they.</p>

<p>However, if you execute <code class="highlighter-rouge">xmake test</code> for testing, they will be automatically compiled and then tested. The running effect is as follows:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ruki-2:test ruki<span class="nv">$ </span>xmake <span class="nb">test
</span>running tests...
<span class="o">[</span>2%]: test_1/args .................................. passed 7.000s
<span class="o">[</span>5%]: test_1/default     .................................... passed 5.000s
<span class="o">[</span>  8%]: test_1/fail_output .................................... passed 5.000s
<span class="o">[</span> 11%]: test_1/pass_output .................................... passed 6.000s
<span class="o">[</span> 13%]: test_2/args        .................................... passed 7.000s
<span class="o">[</span> 16%]: test_2/default     .................................... passed 6.000s
<span class="o">[</span> 19%]: test_2/fail_output .................................... passed 6.000s
<span class="o">[</span> 22%]: test_2/pass_output .................................... passed 6.000s
<span class="o">[</span> 25%]: test_3/args        .................................... passed 7.000s
<span class="o">[</span> 27%]: test_3/default     .................................... passed 7.000s
<span class="o">[</span> 30%]: test_3/fail_output .................................... passed 6.000s
<span class="o">[</span> 33%]: test_3/pass_output .................................... passed 6.000s
<span class="o">[</span> 36%]: test_4/args        .................................... passed 6.000s
<span class="o">[</span> 38%]: test_4/default     .................................... passed 6.000s
<span class="o">[</span> 41%]: test_4/fail_output .................................... passed 5.000s
<span class="o">[</span> 44%]: test_4/pass_output .................................... passed 6.000s
<span class="o">[</span> 47%]: test_5/args        .................................... passed 5.000s
<span class="o">[</span> 50%]: test_5/default     .................................... passed 6.000s
<span class="o">[</span> 52%]: test_5/fail_output .................................... failed 6.000s
<span class="o">[</span> 55%]: test_5/pass_output .................................... failed 5.000s
<span class="o">[</span> 58%]: test_6/args        .................................... passed 7.000s
<span class="o">[</span> 61%]: test_6/default     .................................... passed 6.000s
<span class="o">[</span> 63%]: test_6/fail_output .................................... passed 6.000s
<span class="o">[</span> 66%]: test_6/pass_output .................................... passed 6.000s
<span class="o">[</span> 69%]: test_7/args        .................................... failed 6.000s
<span class="o">[</span> 72%]: test_7/default     .................................... failed 7.000s
<span class="o">[</span> 75%]: test_7/fail_output .................................... failed 6.000s
<span class="o">[</span> 77%]: test_7/pass_output .................................... failed 5.000s
<span class="o">[</span> 80%]: test_8/args        .................................... passed 7.000s
<span class="o">[</span> 83%]: test_8/default     .................................... passed 6.000s
<span class="o">[</span> 86%]: test_8/fail_output .................................... passed 6.000s
<span class="o">[</span> 88%]: test_8/pass_output .................................... failed 5.000s
<span class="o">[</span> 91%]: test_9/args        .................................... passed 6.000s
<span class="o">[</span> 94%]: test_9/default     .................................... passed 6.000s
<span class="o">[</span> 97%]: test_9/fail_output .................................... passed 6.000s
<span class="o">[</span>100%]: test_9/pass_output .................................... passed 6.000s

<span class="gp">80% </span>tests passed, 7 tests failed out of 36, spent 0.242s
</code></pre>
</div>

<p><img src="/assets/img/manual/xmake-test1.png" alt="" /></p>

<p>我们也可以执行 <code class="highlighter-rouge">xmake test -vD</code> 查看详细的测试失败的错误信息：</p>

<p><img src="/assets/img/manual/xmake-test2.png" alt="" /></p>

<h4 id="运行指定测试目标">运行指定测试目标</h4>

<p>我们也可以指定运行指定 target 的某个测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test </span>targetname/testname
</code></pre>
</div>

<p>或者按模式匹配的方式，运行一个 target 的所有测试，或者一批测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test </span>targetname/<span class="k">*</span>
<span class="gp">$ </span>xmake <span class="nb">test </span>targetname/foo<span class="k">*</span>
</code></pre>
</div>

<p>也可以运行所有 target 的同名测试：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> <span class="k">*</span>/testname
</code></pre>
</div>

<h4 id="并行化运行测试">并行化运行测试</h4>

<p>其实，默认就是并行化运行的，但是我们可以通过 <code class="highlighter-rouge">-jN</code> 调整运行的并行度。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -jN
</code></pre>
</div>

<h4 id="分组运行测试">分组运行测试</h4>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo"</span>
<span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo*"</span>
</code></pre>
</div>

<h4 id="添加测试到目标无参数">添加测试到目标（无参数）</h4>

<p>如果没有配置任何参数，仅仅配置了测试名到 <code class="highlighter-rouge">add_tests</code>，那么仅仅测试这个目标程序的是否会运行失败，根据退出代码来判断是否通过测试。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>target("test")
    add_tests("testname")
</code></pre>
</div>

<h4 id="配置运行参数">配置运行参数</h4>

<p>我们也可以通过 <code class="highlighter-rouge"><span class="p">{</span><span class="err">runargs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">{</span><span class="nt">"arg1"</span><span class="err">,</span><span class="w"> </span><span class="nt">"arg2"</span><span class="err">}}</span></code> 的方式，给 <code class="highlighter-rouge">add_tests</code> 配置指定测试需要运行的参数。</p>

<p>另外，一个 target 可以同时配置多个测试用例，每个测试用例可独立运行，互不冲突。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="s2">"arg1"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"arg1"</span><span class="p">,</span> <span class="s2">"arg2"</span><span class="p">}})</span>
</code></pre>
</div>

<p>如果我们没有配置 runargs 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">set_runargs</code> 设置的运行参数。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_runargs</span><span class="p">(</span><span class="s2">"arg1"</span><span class="p">,</span> <span class="s2">"arg2"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="配置运行目录">配置运行目录</h4>

<p>我们也可以通过 rundir 设置测试运行的当前工作目录，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">rundir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">projectdir</span><span class="p">()})</span>
</code></pre>
</div>

<p>如果我们没有配置 rundir 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">set_rundir</code> 设置的运行目录。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">set_rundir</span><span class="p">(</span><span class="s2">"$(projectdir)"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="配置运行环境">配置运行环境</h4>

<p>我们也可以通过 runenvs 设置一些运行时候的环境变量，例如：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">runenvs</span> <span class="o">=</span> <span class="p">{</span><span class="n">LD_LIBRARY_PATH</span> <span class="o">=</span> <span class="s2">"/lib"</span><span class="p">}})</span>
</code></pre>
</div>

<p>如果我们没有配置 runenvs 到 <code class="highlighter-rouge">add_tests</code>，那么我们也会尝试从被绑定的 target 中，获取 <code class="highlighter-rouge">add_runenvs</code> 设置的运行环境。</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
    <span class="n">add_runenvs</span><span class="p">(</span><span class="s2">"LD_LIBRARY_PATH"</span><span class="p">,</span> <span class="s2">"/lib"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="匹配输出结果">匹配输出结果</h4>

<p>默认情况下，<code class="highlighter-rouge">xmake test</code> 会根据测试运行的退出代码是否为 0，来判断是否测试通过。</p>

<p>当然，我们也可以通过配置测试运行的输出结果是否满足我们的指定的匹配模式，来判断是否测试通过。</p>

<p>主要通过这两个参数控制：</p>

<table>
  <thead>
    <tr>
      <th>参数</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pass_outputs</td>
      <td>如果输出匹配，则测试通过</td>
    </tr>
    <tr>
      <td>fail_outputs</td>
      <td>如果输出匹配，则测试失败</td>
    </tr>
  </tbody>
</table>

<p>传入 <code class="highlighter-rouge">pass_outputs</code> 和 <code class="highlighter-rouge">fail_outputs</code> 的是一个 lua 匹配模式的列表，但模式稍微做了一些简化，比如对 <code class="highlighter-rouge">*</code> 的处理。</p>

<p>如果要匹配成功，则测试通过，可以这么配置：</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"hello *"</span><span class="p">})</span>
    <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"hello *"</span><span class="p">}})</span>
<span class="err">```</span><span class="n">If</span> <span class="n">the</span> <span class="n">match</span> <span class="n">is</span> <span class="n">successful</span><span class="p">,</span> <span class="n">the</span> <span class="n">test</span> <span class="n">fails</span><span class="p">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">configure</span> <span class="n">it</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>

<span class="err">```</span><span class="n">lua</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello *"</span><span class="p">})</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">fail_outputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"hello *"</span><span class="p">}})</span>
</code></pre>
</div>

<p>We can also configure them simultaneously:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<p>Since some test output results will have some newline or other blank characters at the end, which interferes with the matching mode, we can configure <code class="highlighter-rouge">trim_output = true</code> to truncate the blank characters before matching.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">trim_output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<p>We can also configure <code class="highlighter-rouge"><span class="p">{</span><span class="err">plain</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true</span><span class="p">}</span></code> to disable lua pattern matching and only do the most basic flat text matching.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">,</span> <span class="p">{</span><span class="n">plain</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">pass_outputs</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="n">fail_outputs</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">})</span>
</code></pre>
</div>

<h4 id="configure-test-group">Configure test group</h4>

<p>We can also configure a test group through <code class="highlighter-rouge">group = "foo"</code> for group testing:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname1"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">})</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname2"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">})</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname3"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"bar"</span><span class="p">})</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname4"</span><span class="p">,</span> <span class="p">{</span><span class="n">group</span> <span class="o">=</span> <span class="s2">"bae"</span><span class="p">})</span>
</code></pre>
</div>

<p>Where testname1/testname2 is a group foo, and the other two are in another group.</p>

<p>Then, we can use <code class="highlighter-rouge">xmake test -g groupname</code> to perform group testing.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo"</span>
<span class="gp">$ </span>xmake <span class="nb">test</span> -g <span class="s2">"foo*"</span>
</code></pre>
</div>

<p>!&gt; Running grouping also supports pattern matching.</p>

<p>In addition, if the <code class="highlighter-rouge">group</code> parameter is not set to <code class="highlighter-rouge">add_tests</code>, we can also get the group name bound to the target by default.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
     <span class="n">set_group</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="custom-test-script">Custom test script</h4>

<p>We have also added <code class="highlighter-rouge">before_test</code>, <code class="highlighter-rouge">on_test</code> and <code class="highlighter-rouge">after_test</code> configuration scripts. Users can customize them in the rule and target fields to implement customized test execution.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
      <span class="n">on_test</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">runenvs</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">runargs</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">pass_outputs</span><span class="p">)</span>

         <span class="c1">-- do test</span>
         <span class="c1">--...</span>

         <span class="c1">-- passed</span>
         <span class="k">return</span> <span class="kc">true</span>

         <span class="c1">-- failed</span>
         <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="n">errors</span>
      <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>Among them, all parameters passed into <code class="highlighter-rouge">add_tests</code> can be obtained in opt. We customize the test logic in on_test, and then return true to indicate that the test passed, return false to indicate that the test failed, and then continue to return the error message of test failure.</p>

<h4 id="automated-build">Automated build</h4>

<p>Since the test target usually does not need to be built during the normal development build phase, we will set <code class="highlighter-rouge">set_default(false)</code>.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"testname"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</code></pre>
</div>

<p>However, when running <code class="highlighter-rouge">xmake test</code> for testing, the targets corresponding to these tests will still be automatically built to ensure that they can be run.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake <span class="nb">test</span>
<span class="o">[</span>25%]: cache compiling.release src/main.cpp
<span class="o">[</span>50%]: linking.release <span class="nb">test
</span>running tests...
<span class="o">[</span>100%]: <span class="nb">test</span>/testname ............................. passed 6.000s

<span class="gp">100% </span>tests passed, 0 tests failed out of 1, spent 0.006s
</code></pre>
</div>

<h4 id="terminate-if-the-first-test-fails">Terminate if the first test fails</h4>

<p>By default, <code class="highlighter-rouge">xmake test</code> will wait until all tests have been run, no matter how many of them failed.</p>

<p>Sometimes, we want to interrupt the test directly if the first test fails, then we can enable it through the following configuration:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"test.return_zero_on_failure"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="if-the-test-fails-return-0">If the test fails, return 0</h4>

<p>By default, as long as a test fails, it will return a non-zero exit code when <code class="highlighter-rouge">xmake test</code> is completed. This is very useful for some CI environments and can interrupt other CI scripts to continue running.</p>

<p>Then the trigger signal tells CI that we need to generate test reports and alarms.</p>

<p>Then, if we want to suppress this behavior, we can force the exit code of <code class="highlighter-rouge">xmake test</code> to always be set to 0.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"test.return_zero_on_failure"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="just-test-compilation">Just test compilation</h4>

<p>Sometimes, we just want to test whether the code compiles or fails without running them. This can be achieved by configuring <code class="highlighter-rouge">build_should_pass</code> and <code class="highlighter-rouge">build_should_fail</code>.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test_10"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/compile.cpp"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"compile_fail"</span><span class="p">,</span> <span class="p">{</span><span class="n">build_should_fail</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_11"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/compile.cpp"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"compile_pass"</span><span class="p">,</span> <span class="p">{</span><span class="n">build_should_pass</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>This is usually used in scenarios with <code class="highlighter-rouge">static_assert</code> in some test code, for example:</p>

<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">foo</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">printf</span><span class="p">(</span><span class="s">"int!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">printf</span><span class="p">(</span><span class="s">"float!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">static_assert</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="s">"unsupported type"</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">foo</span><span class="p">(</span><span class="s">"BAD"</span><span class="p">);</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="configure-additional-code-compilation">Configure additional code compilation</h4>

<p>When configuring test cases, we can also configure additional code that needs to be compiled for each test, as well as some macro definitions to implement inline testing.</p>

<p>xmake will compile an independent executable program for each test to run it, but this will not affect the compilation results of the target in the production environment.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test_13"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_1.cpp"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_1"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_1.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_1"</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_14"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_2.cpp"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_2"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_2.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_2"</span><span class="p">})</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test_15"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">set_default</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/test_1.cpp"</span><span class="p">)</span>
     <span class="n">add_tests</span><span class="p">(</span><span class="s2">"stub_n"</span><span class="p">,</span> <span class="p">{</span><span class="n">files</span> <span class="o">=</span> <span class="s2">"tests/stub_n*.cpp"</span><span class="p">,</span> <span class="n">defines</span> <span class="o">=</span> <span class="s2">"STUB_N"</span><span class="p">})</span>
</code></pre>
</div>

<p>Taking doctest as an example, we can externally unit test without modifying any main.cpp:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.debug"</span><span class="p">,</span> <span class="s2">"mode.release"</span><span class="p">)</span>

<span class="n">add_requires</span><span class="p">(</span><span class="s2">"doctest"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"doctest"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">testfile</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"tests/*.cpp"</span><span class="p">))</span> <span class="k">do</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">testfile</span><span class="p">),</span> <span class="p">{</span>
             <span class="n">files</span> <span class="o">=</span> <span class="n">testfile</span><span class="p">,</span>
             <span class="n">remove_files</span> <span class="o">=</span> <span class="s2">"src/main.cpp"</span><span class="p">,</span>
             <span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">,</span>
             <span class="n">packages</span> <span class="o">=</span> <span class="s2">"doctest"</span><span class="p">,</span>
             <span class="n">defines</span> <span class="o">=</span> <span class="s2">"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN"</span><span class="p">})</span>
     <span class="k">end</span>
</code></pre>
</div>

<p>Defining DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN will introduce additional main entry function, so we need to configure remove_files to remove the existing main.cpp file.</p>

<p>The running effect is as follows:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>ruki-2:doctest ruki<span class="nv">$ </span>xmake <span class="nb">test
</span>running tests...
<span class="o">[</span>50%]: doctest/test_1 ........................ failed 0.009s
<span class="o">[</span>100%]: doctest/test_2 ........................ passed 0.009s

<span class="gp">50% </span>tests passed, 1 tests failed out of 2, spent 0.019s
ruki-2:doctest ruki<span class="nv">$ </span>xmake <span class="nb">test</span> -v
running tests...
<span class="o">[</span>50%]: doctest/test_1....................... failed 0.026s
<span class="o">[</span>doctest] doctest version is <span class="s2">"2.4.11"</span>
<span class="o">[</span>doctest] run with <span class="s2">"--help"</span> <span class="k">for </span>options
<span class="o">==================================================</span> <span class="o">=============================</span>
tests/test_1.cpp:7:
TEST CASE: testing the factorial <span class="k">function

</span>tests/test_1.cpp:8: ERROR: CHECK<span class="o">(</span> factorial<span class="o">(</span>1<span class="o">)</span> <span class="o">==</span> 10 <span class="o">)</span> is NOT correct!
   values: CHECK<span class="o">(</span> 1 <span class="o">==</span> 10 <span class="o">)</span>

<span class="o">==================================================</span> <span class="o">=============================</span>
<span class="o">[</span>doctest] <span class="nb">test </span>cases: 1 | 0 passed | 1 failed | 0 skipped
<span class="o">[</span>doctest] assertions: 4 | 3 passed | 1 failed |
<span class="o">[</span>doctest] Status: FAILURE!

run failed, <span class="nb">exit </span>code: 1
<span class="o">[</span>100%]: doctest/test_2 ........................ passed 0.010s

<span class="gp">50% </span>tests passed, 1 tests failed out of 2, spent 0.038s
</code></pre>
</div>

<h4 id="test-dynamic-library">Test dynamic library</h4>

<p>Usually, <code class="highlighter-rouge">add_tests</code> is only used to run tests on executable programs. Running dynamic libraries requires an additional main entry, so we need to configure an additional executable program to load it, for example:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code>
<span class="n">target</span><span class="p">(</span><span class="s2">"doctest_shared"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"shared"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/foo.cpp"</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">testfile</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"tests/*.cpp"</span><span class="p">))</span> <span class="k">do</span>
         <span class="n">add_tests</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">testfile</span><span class="p">),</span> <span class="p">{</span>
             <span class="n">kind</span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
             <span class="n">files</span> <span class="o">=</span> <span class="n">testfile</span><span class="p">,</span>
             <span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">,</span>
             <span class="n">packages</span> <span class="o">=</span> <span class="s2">"doctest"</span><span class="p">,</span>
             <span class="n">defines</span> <span class="o">=</span> <span class="s2">"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN"</span><span class="p">})</span>
     <span class="k">end</span>
</code></pre>
</div>

<p>Each unit test can be changed to a binary executable program through <code class="highlighter-rouge">kind = "binary"</code>, and the main entry function can be introduced through <code class="highlighter-rouge">DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN</code>.</p>

<p>This enables external runnable unit tests in dynamic library targets.</p>

<h3 id="added-type-size-detection">Added type size detection</h3>

<p>In previous versions, we could implement type detection through <code class="highlighter-rouge">check_csnippets</code> and <code class="highlighter-rouge">output = true</code>.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">check_csnippets</span><span class="p">(</span><span class="s2">"INT_SIZE"</span><span class="p">,</span> <span class="s1">'printf("%d", sizeof(int)); return 0;'</span><span class="p">,</span> <span class="p">{</span><span class="n">output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>

<p>But this way is to extract the type size information by trying to run the test code, and then getting the running output results.</p>

<p>This does not apply to cross-compilation.</p>

<p>In version 2.8.5, we added the <code class="highlighter-rouge">check_sizeof</code> auxiliary interface, which can extract type size information by directly parsing the binary file of the test program.</p>

<p>Since there is no need to run tests, this method not only supports cross-compilation, but also greatly improves detection efficiency and is simpler to use.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">includes</span><span class="p">(</span><span class="s2">"@builtin/check"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"static"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"*.cpp"</span><span class="p">)</span>
     <span class="n">check_sizeof</span><span class="p">(</span><span class="s2">"LONG_SIZE"</span><span class="p">,</span> <span class="s2">"long"</span><span class="p">)</span>
     <span class="n">check_sizeof</span><span class="p">(</span><span class="s2">"STRING_SIZE"</span><span class="p">,</span> <span class="s2">"std::string"</span><span class="p">,</span> <span class="p">{</span><span class="n">includes</span> <span class="o">=</span> <span class="s2">"string"</span><span class="p">})</span>
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f -c
checking <span class="k">for </span>LONG_SIZE ... 8
checking <span class="k">for </span>STRING_SIZE ... 24
</code></pre>
</div>

<p>Alternatively, I can also check in the script domain via <code class="highlighter-rouge">target:check_sizeof</code>.</p>

<h3 id="added-apple-xros-platform">Added Apple XROS platform</h3>

<p>Apple has added build support for visionOS devices in Xcode15, so we also support it as soon as possible. You only need to execute:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f -p applexros
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>This will complete the construction of the visionOS/XROS platform.</p>

<h3 id="support-code-merging">Support code merging</h3>

<p>Finally, we also provide a small tool module that can be used to quickly merge all c/c++ and header file source codes in a specified target into a single source file.</p>

<p>A single source code file similar to sqlite3.c will be generated. Users can decide whether to use this function according to their actual needs.</p>

<p>When merging, Xmake will expand all internal includes header files and generate DAG, which will be introduced through topological sorting.</p>

<p>By default it will handle the merging of all targets, for example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>We can also specify the targets required for the merge:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate tbox
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>You can also specify a custom unique ID macro definition when merging each source file to handle symbol conflicts.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate -u MY_UNIQUEU_ID
build/tbox.c generated!
build/tbox.h generated!
</code></pre>
</div>

<p>If there are symbols with the same name in multiple source files, you can determine whether the <code class="highlighter-rouge">MY_UNIQUEU_ID</code> macro is defined. If it is defined, it means it is in a single file, and you can handle the symbols with the same name in the source code yourself.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#ifdef MY_UNIQUEU_ID
</span>     <span class="c1">//do something
</span><span class="cp">#endif
</span></code></pre>
</div>

<p>We can also specify the output location:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake l cli.amalgamate -o /xxx
/xxx/tbox.c generated!
/xxx/tbox.h generated!
</code></pre>
</div>

<h3 id="added-windowsmanifestuac-policy">Added windows.manifest.uac policy</h3>

<p>Through this strategy, we can quickly and easily set up and enable Windows UAC.</p>

<p>It supports the following levels:</p>

<ul>
  <li>invoker: asInvoker</li>
  <li>admin: requireAdministrator</li>
  <li>highest: highestAvailable</li>
</ul>

<p>For example:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"windows.manifest.uac"</span><span class="p">,</span> <span class="s2">"admin"</span><span class="p">)</span>
</code></pre>
</div>

<p>It is equivalent to setting</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="n">is_plat</span><span class="p">(</span><span class="s2">"windows"</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">add_ldflags</span><span class="p">(</span><span class="s2">"/manifest:embed"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"/manifestuac:level='requireAdministrator' uiAccess='false'"</span><span class="p">},</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="kc">false</span><span class="p">})</span>
<span class="k">end</span>
</code></pre>
</div>

<p>But it is more convenient and concise, and there is no need to judge the platform, other platforms are automatically ignored.</p>

<p>We can also set the uiAccess of Windows UAC through the <code class="highlighter-rouge">windows.manifest.uac.ui</code> policy. If it is not set, the default is false.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_policy</span><span class="p">(</span><span class="s2">"windows.manifest.uac.ui"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="changelog">Changelog</h2>

<h3 id="new-features">New features</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/1452">#1452</a>: Improve link mechanism and order</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/1438">#1438</a>: Support code amalgamation</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3381">#3381</a>: Add <code class="highlighter-rouge">xmake test</code> support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/4276">#4276</a>: Support custom scope api</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/4286">#4286</a>: Add Apple XROS support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/4345">#4345</a>: Support check sizeof</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/4369">#4369</a>: Add windows.manifest.uac policy</li>
</ul>

<h3 id="changes">Changes</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/4284">#4284</a>: Improve builtin includes</li>
</ul>

<h3 id="bugs-fixed">Bugs fixed</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/4256">#4256</a>: Fix intellisense for vsxmake/c++modules</li>
</ul>

        </article>
        <hr>

        <!-- wwads -->
        
        <div class="wwads-cn wwads-horizontal" data-id="243" style="max-width:100%"></div>
        

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
            
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2023/11/05/xmake-update-v2.8.5/">Xmake v2.8.5 发布，支持链接排序和单元测试
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2023/12/15/xmake-update-v2.8.6/">Xmake v2.8.6 released, New Packaging Plugin: XPack
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2023/09/26/xmake-update-v2.8.3/">Xmake v2.8.3 Released, Improve Wasm and Support Xmake Source Debugging
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2023/08/22/xmake-update-v2.8.2/">Xmake v2.8.2 Released, Official package repository count over 1k
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2023/07/11/xmake-update-v2.8.1/">Xmake v2.8.1 Released, Lots of Detailed Feature Improvements
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2023/04/04/xmake-update-v2.7.8/">Xmake v2.7.8 released, Improve package virtual environment and build speed
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2023/09/26/xmake-update-v2.8.3/">Xmake v2.8.3 Released, Improve Wasm and Support Xmake Source Debugging</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        
        
        <p><strong>Next Post</strong> <a href="/2023/12/15/xmake-update-v2.8.6/">Xmake v2.8.6 released, New Packaging Plugin: XPack</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
