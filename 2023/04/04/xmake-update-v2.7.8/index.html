<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.7.8 released, Improve package virtual environment and build speed</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build utility based on Lua.It is very lightweight and has no dependencies because it has a built-in Lua runtime.It uses...">

    
    <meta name="keywords" content="xmake,lua,C/C++,package,performance,mingw64,wasm,tboox" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2023/04/04/xmake-update-v2.7.8/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.7.8 released, Improve package virtual environment and build speed</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2023-04-04
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a-->
        <a href="/tag/#xmake" title="Tag: xmake" rel="tag">xmake</a>&nbsp;
    
        <!--a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a-->
        <a href="/tag/#lua" title="Tag: lua" rel="tag">lua</a>&nbsp;
    
        <!--a href="/tag/#C%2FC%2B%2B" title="Tag: C/C++" rel="tag">C/C++</a-->
        <a href="/tag/#C/C++" title="Tag: C/C++" rel="tag">C/C++</a>&nbsp;
    
        <!--a href="/tag/#package" title="Tag: package" rel="tag">package</a-->
        <a href="/tag/#package" title="Tag: package" rel="tag">package</a>&nbsp;
    
        <!--a href="/tag/#performance" title="Tag: performance" rel="tag">performance</a-->
        <a href="/tag/#performance" title="Tag: performance" rel="tag">performance</a>&nbsp;
    
        <!--a href="/tag/#mingw64" title="Tag: mingw64" rel="tag">mingw64</a-->
        <a href="/tag/#mingw64" title="Tag: mingw64" rel="tag">mingw64</a>&nbsp;
    
        <!--a href="/tag/#wasm" title="Tag: wasm" rel="tag">wasm</a-->
        <a href="/tag/#wasm" title="Tag: wasm" rel="tag">wasm</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build utility based on Lua.</p>

<p>It is very lightweight and has no dependencies because it has a built-in Lua runtime.</p>

<p>It uses xmake.lua to maintain project builds and its configuration syntax is very simple and readable.</p>

<p>We can use it to build project directly like Make/Ninja, or generate project files like CMake/Meson, and it also has a built-in package management system to help users solve the integrated use of C/C++ dependent libraries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>Although not very precise, we can still understand Xmake in the following way:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ≈ Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<p><img src="https://github.com/xmake-io/xmake-docs/raw/master/assets/img/index/package.gif" width="650px" /></p>

<h2 id="introduction-of-new-features">Introduction of new features</h2>

<h3 id="quickly-switch-temporary-virtual-environments">Quickly switch temporary virtual environments</h3>

<p>Xmake has long supported the virtual environment management of packages, and can switch between different package environments through configuration files.</p>

<p>We can customize some package configurations by adding the xmake.lua file in the current directory, and then enter a specific package virtual environment.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib 1.2.11"</span><span class="p">)</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"python 3.x"</span><span class="p">,</span> <span class="s2">"luajit"</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xrepo</span><span class="kv"> env shell
</span>&gt; python --version
&gt; luajit --version
</code></pre>
</div>

<p>You can also switch environments by importing custom environment configuration files:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xrepo</span><span class="kv"> env --add /tmp/base.lua
</span><span class="w">$ </span><span class="nc">xrepo</span><span class="kv"> env -b base shell
</span></code></pre>
</div>

<p>In the new version, we have made further improvements, allowing Xrepo to temporarily specify the list of environment packages that need to be bound directly on the command line to achieve fast switching without any configuration.</p>

<p>And it supports specifying multiple package environments at the same time.</p>

<p>For example, we want to enter an environment with python 3.0, luajit and cmake, just execute:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xrepo</span><span class="kv"> env -b "python 3.x,luajit,cmake" shell
</span>[python, luajit, cmake] $ python --version
Python 3.10.6
[python, luajit, cmake] $ cmake --version
cmake version 3.25.3
</code></pre>
</div>

<p>Xmake will automatically install the relevant dependencies, and then open a new shell environment. There is also a prompt prompt on the left side of the terminal in the new environment.</p>

<p>If we want to exit the current environment, we only need to execute</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code>[python, luajit, cmake] $ xrepo env quit
$
</code></pre>
</div>

<h3 id="improve-code-feature-detection">Improve code feature detection</h3>

<p>A series of detection interfaces such as has_cfuncs/check_cxxsnippets have been provided in option, and there are corresponding auxiliary APIs to help detection.</p>

<p>For related documents, please refer to: <a href="https://xmake.io/#/zh-cn/manual/helper_interfaces">helper detection interface</a>.</p>

<p>However, the current detection interface provided by option is only for the global platform tool chain, and it is impossible to perform targeted detection according to each specific target configuration.</p>

<p>Because the target itself may also have dependent packages, different tool chains, compilation macros and other differences, the detection results will also have some differences.</p>

<p>Therefore, if users want more flexible and fine-grained detection of the compilation characteristics of each target target, they can use the target target instance interface provided by the new version.</p>

<ul>
  <li>target: has_cfuncs</li>
  <li>target: has_cxxfuncs</li>
  <li>target:has_ctypes</li>
  <li>target:has_cxxtypes</li>
  <li>target: has_cincludes</li>
  <li>target:has_cxxincludes</li>
  <li>target:has_cflags</li>
  <li>target:has_cxxflags</li>
  <li>target:has_features</li>
  <li>target: check_csnippets</li>
  <li>target: check_cxxsnippets</li>
</ul>

<p>Here, only for some of the more commonly used interfaces, a little introduction to the usage.</p>

<h4 id="targethas_cfuncs">target:has_cfuncs</h4>

<ul>
  <li>Check whether the target compilation configuration can obtain the given C function</li>
</ul>

<p>This should be used in <code class="highlighter-rouge">on_config</code>, for example, it can be used to determine whether the current target can obtain some function interfaces of the zlib dependent package, and then automatically define <code class="highlighter-rouge">HAVE_INFLATE</code>:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
     <span class="n">add_packages</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">target</span><span class="p">:</span><span class="n">has_cfuncs</span><span class="p">(</span><span class="s2">"inflate"</span><span class="p">,</span> <span class="p">{</span><span class="n">includes</span> <span class="o">=</span> <span class="s2">"zlib.h"</span><span class="p">})</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAVE_INFLATE"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>Although option also provides similar detection functions, the detection of option uses the global platform tool chain, which cannot be accompanied by some compilation configurations related to target.
It is also impossible to set different compilation toolchains according to the target to adapt the detection, and it is impossible to detect some interfaces in the package.</p>

<p>If we only want a coarse-grained detection function interface, and the target does not additionally set different tool chains, then the detection function provided by option is sufficient.</p>

<p>If you want more fine-grained control over detection, you can use the detection features provided by the target instance interface.</p>

<h4 id="targethas_cxxfuncs">target:has_cxxfuncs</h4>

<ul>
  <li>Check whether the target compilation configuration can obtain the given C++ function</li>
</ul>

<p>The usage is similar to <a href="#targethas_cfuncs">target:has_cfuncs</a>, except that it is mainly used to detect C++ functions.</p>

<p>However, while detecting functions, we can also additionally configure std languages to assist detection.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>target:has_cxxfuncs("foo", {includes = "foo.h", configs = {languages = "cxx17"}})
</code></pre>
</div>

<h4 id="targethas_ctypes">target:has_ctypes</h4>

<ul>
  <li>Check whether the target compilation configuration can obtain the given C type</li>
</ul>

<p>This should be used in <code class="highlighter-rouge">on_config</code> like this:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
     <span class="n">add_packages</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">target</span><span class="p">:</span><span class="n">has_ctypes</span><span class="p">(</span><span class="s2">"z_stream"</span><span class="p">,</span> <span class="p">{</span><span class="n">includes</span> <span class="o">=</span> <span class="s2">"zlib.h"</span><span class="p">})</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAVE_ZSTEAM_T"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="targethas_cflags">target:has_cflags</h4>

<ul>
  <li>Check whether the target compilation configuration can obtain the given C compilation flags</li>
</ul>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">target</span><span class="p">:</span><span class="n">has_cxxflags</span><span class="p">(</span><span class="s2">"-fPIC"</span><span class="p">)</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAS_PIC"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="targethas_cincludes">target:has_cincludes</h4>

<ul>
  <li>Check whether the target compilation configuration can obtain the given C header file</li>
</ul>

<p>This should be used in <code class="highlighter-rouge">on_config</code>, for example, it can be used to determine whether the current target can obtain the zlib.h header file of the zlib dependency package, and then automatically define <code class="highlighter-rouge">HAVE_INFLATE</code>:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.c"</span><span class="p">)</span>
     <span class="n">add_packages</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">target</span><span class="p">:</span><span class="n">has_cincludes</span><span class="p">(</span><span class="s2">"zlib.h"</span><span class="p">)</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAVE_ZLIB_H"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="targetcheck_cxxsnippets">target:check_cxxsnippets</h4>

<ul>
  <li>Detect if a given piece of C++ code can be compiled and linked</li>
</ul>

<p>This should be used in <code class="highlighter-rouge">on_config</code> like this:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"libtins"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="n">add_packages</span><span class="p">(</span><span class="s2">"libtins"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="kd">local</span> <span class="n">has_snippet</span> <span class="o">=</span> <span class="n">target</span><span class="p">:</span><span class="n">check_cxxsnippets</span><span class="p">({</span><span class="n">test</span> <span class="o">=</span> <span class="s">[[
             #include &lt;string&gt;
             using namespace Tins;
             void test() {
                 std::string name = NetworkInterface::default_interface().name();
                 printf("%s\n", name.c_str());
             }
         ]]</span><span class="p">},</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">},</span> <span class="n">includes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"tins/tins.h"</span><span class="p">}}))</span>
         <span class="k">if</span> <span class="n">has_snippet</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAS_XXX"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>By default, it only checks whether the compilation link is passed. If you want to try the runtime check, you can set <code class="highlighter-rouge">tryrun = true</code>.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="kd">local</span> <span class="n">has_int_4</span> <span class="o">=</span> <span class="n">target</span><span class="p">:</span><span class="n">check_cxxsnippets</span><span class="p">({</span><span class="n">test</span> <span class="o">=</span> <span class="s">[[
             return (sizeof(int) == 4)? 0 : -1;
         ]]</span><span class="p">},</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">},</span> <span class="n">tryrun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}))</span>
         <span class="k">if</span> <span class="n">has_int_4</span> <span class="k">then</span>
             <span class="n">target</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">"defines"</span><span class="p">,</span> <span class="s2">"HAS_INT4"</span><span class="p">)</span>
         <span class="k">end</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<p>We can also continue to capture the running output of the detection by setting <code class="highlighter-rouge">output = true</code>, and add a custom <code class="highlighter-rouge">main</code> entry to achieve a complete test code, not just a code snippet.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">target</span><span class="p">(</span><span class="s2">"test"</span><span class="p">)</span>
     <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="n">on_config</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
         <span class="kd">local</span> <span class="n">int_size</span> <span class="o">=</span> <span class="n">target</span><span class="p">:</span><span class="n">check_cxxsnippets</span><span class="p">({</span><span class="n">test</span> <span class="o">=</span> <span class="s">[[
             #include &lt;stdio.h&gt;
             int main(int argc, char** argv) {
                 printf("%d", sizeof(int)); return 0;
                 return 0;
             }
         ]]</span><span class="p">},</span> <span class="p">{</span><span class="n">configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">languages</span> <span class="o">=</span> <span class="s2">"c++11"</span><span class="p">},</span> <span class="n">tryrun</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span><span class="n">output</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}))</span>
     <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="targethas_features">target:has_features</h4>

<ul>
  <li>Detect if specified C/C++ compilation feature</li>
</ul>

<p>It is faster than using <code class="highlighter-rouge">check_cxxsnippets</code>, because it only performs preprocessing once to check all compiler features, instead of calling the compiler every time to try to compile.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>target("test")
     set_kind("binary")
     add_files("src/*.cpp")
     on_config(function(target)
         if target:has_features("c_static_assert") then
             target:add("defines", "HAS_STATIC_ASSERT")
         end
         if target:has_features("cxx_constexpr") then
             target:add("defines", "HAS_CXX_CONSTEXPR")
         end
     end)
</code></pre>
</div>

<h3 id="optimize-compilation-performance">Optimize compilation performance</h3>

<p>The build cache acceleration of Xmake is similar to ccache, which uses the preprocessor to calculate the hash and cache the compiled object files to achieve acceleration. It has a very obvious speed-up effect on linux/mac.</p>

<p>And because the preprocessor of msvc is very slow, it may also be that the starting process is heavier than that under linux/mac. After the build cache is enabled, the overall compilation efficiency of using msvc on windows is much slower.</p>

<p>Trying to use a third-party ccache to test and compare, the same problem, so I temporarily disabled the build cache for msvc by default, so that the overall build speed returned to normal levels.</p>

<h3 id="clang-tidy-autofix">clang-tidy autofix</h3>

<p>In the last version, we added support for clang-tidy, and you can check the code through <code class="highlighter-rouge">xmake check clang.tidy</code>.
In this version, we continue to improve it and add the <code class="highlighter-rouge">--fix</code> parameter, which allows clang-tidy to automatically fix the detected problem code.</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --fix
</span><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --fix_errors
</span><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --fix_notes
</span></code></pre>
</div>

<h3 id="swigjava-module-build-support">Swig/Java module build support</h3>

<p>Additionally, other users have helped contribute build support for Swig/Java modules.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>add_rules("mode. release", "mode. debug")

target("example")
     set_kind('shared')
     --set moduletype to java
     add_rules("swig.c", {moduletype = "java"})
     -- use swigflags to provider package name and output path of java files
     add_files("src/example.i", {swigflags = {
         "-package",
         "com. example",
         "-outdir",
         "build/java/com/example/"
     }})
     add_files("src/example.c")
     before_build(function()
         -- ensure output path exists before running swig
         os.mkdir("build/java/com/example/")
     end)
</code></pre>
</div>

<p>For a complete example, see: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/swig/java_c">Swig/Java Example</a></p>

<h2 id="changelog">Changelog</h2>

<h3 id="new-features">New features</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/3518">#3518</a>: Profile compile and link performance</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3522">#3522</a>: Add has_cflags, has_xxx for target</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3537">#3537</a>: Add –fix for clang.tidy checker</li>
</ul>

<h3 id="changes">Changes</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/3433">#3433</a>: Improve to build Qt project on msys2/mingw64 and wasm</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3419">#3419</a>: Support fish shell envirnoment</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3455">#3455</a>: Dlang incremental build support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3498">#3498</a>: Improve to bind package virtual envirnoments</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3504">#3504</a>: Add swig java support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3508">#3508</a>: Improve trybuild/cmake to support for switching toolchain</li>
  <li>disable build cache for msvc, because msvc’s preprocessor is too slow.</li>
</ul>

<h3 id="bugs-fixed">Bugs fixed</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/3436">#3436</a>: Fix complete and menuconf</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3463">#3463</a>: Fix c++modules cache issue</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3545">#3545</a>: Fix parsedeps for armcc</li>
</ul>


        </article>
        <hr>

        <!-- wwads -->
        
        <div class="wwads-cn wwads-horizontal" data-id="243" style="max-width:100%"></div>
        

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2023/04/04/xmake-update-v2.7.8/">Xmake v2.7.8 发布，改进包虚拟环境和构建速度
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
        
            
            
            
            
        
            
        
            
            
            
            
        
            
        
            
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2022/11/08/xmake-update-v2.7.3/">Xmake v2.7.3 Released, Package Components and C++ Modules Incremental Build Support
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2022/10/09/xmake-update-v2.7.2/">Xmake v2.7.2 released, build third-party libraries more intelligently
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
            
        
            
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2022/08/25/xmake-update-v2.7.1/">Xmake v2.7.1 Released, Better C++ Modules Support
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2023/02/23/xmake-update-v2.7.7/">Xmake v2.7.7 released, Support Haiku, Improve API check and C++ Modules</a></p>
        
    </div>

    <div class="nex">

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        

        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
