<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.7.6 Released, Add Verilog and C++ Module Distribution Support</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build utility based on Lua.It is very lightweight and has no dependencies because it has a built-in Lua runtime.It uses...">

    
    <meta name="keywords" content="tbox,xmake,gbox,cross-platform,c,lua,build,makefile,make,compile,linux,programing" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2023/01/22/xmake-update-v2.7.6/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/404.html/">
                            
                        
                            <i class="fa fa-heart"></i>捐助
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.7.6 Released, Add Verilog and C++ Module Distribution Support</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2023-01-22
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build utility based on Lua.</p>

<p>It is very lightweight and has no dependencies because it has a built-in Lua runtime.</p>

<p>It uses xmake.lua to maintain project builds and its configuration syntax is very simple and readable.</p>

<p>We can use it to build project directly like Make/Ninja, or generate project files like CMake/Meson, and it also has a built-in package management system to help users solve the integrated use of C/C++ dependent libraries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>Although not very precise, we can still understand Xmake in the following way:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ≈ Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<p><img src="https://github.com/xmake-io/xmake-docs/raw/master/assets/img/index/package.gif" width="650px" /></p>

<h2 id="introduction-of-new-features">Introduction of new features</h2>

<h3 id="support-verilog-program">Support Verilog Program</h3>

<h4 id="iverilog-simulator">iVerilog Simulator</h4>

<p>Through <code class="highlighter-rouge">add_requires("iverilog")</code> configuration, we can automatically pull the iverilog toolchain package, and then use <code class="highlighter-rouge">set_toolchains("@iverilog")</code> to automatically bind the toolchain to compile the project.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"iverilog"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
     <span class="n">add_rules</span><span class="p">(</span><span class="s2">"iverilog. binary"</span><span class="p">)</span>
     <span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@iverilog"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.v"</span><span class="p">)</span>
</code></pre>
</div>

<h5 id="set-abstract-configuration">Set abstract configuration</h5>

<pre><code class="language-Lua">add_requires("iverilog")
target("hello")
     add_rules("iverilog. binary")
     set_toolchains("@iverilog")
     add_files("src/*.v")
     add_defines("TEST")
     add_includedirs("inc")
     set_languages("v1800-2009")
</code></pre>

<p>We can use <code class="highlighter-rouge">set_languages("v1800-2009")</code> to set the language standard for switching Verilog.</p>

<p>Currently supported values and mappings are as follows:</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="s2">"v1364-1995"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g1995"</span>
<span class="p">[</span><span class="s2">"v1364-2001"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g2001"</span>
<span class="p">[</span><span class="s2">"v1364-2005"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g2005"</span>
<span class="p">[</span><span class="s2">"v1800-2005"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g2005-sv"</span>
<span class="p">[</span><span class="s2">"v1800-2009"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g2009"</span>
<span class="p">[</span><span class="s2">"v1800-2012"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"-g2012"</span>
</code></pre>
</div>

<h5 id="set-custom-flags">Set custom flags</h5>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"iverilog"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
     <span class="n">add_rules</span><span class="p">(</span><span class="s2">"iverilog. binary"</span><span class="p">)</span>
     <span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@iverilog"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.v"</span><span class="p">)</span>
     <span class="n">add_values</span><span class="p">(</span><span class="s2">"iverilogs.flags"</span><span class="p">,</span> <span class="s2">"-DTEST"</span><span class="p">)</span>
</code></pre>
</div>

<h5 id="build-the-project">Build the project</h5>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv">
</span>check iverilog... iverilog
check vvp... vvp
[50%]: linking.iverilog hello.vvp
[100%]: build ok!
</code></pre>
</div>

<h5 id="run-the-program">Run the program</h5>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> run
</span>hello world!
LXT2 INFO: dumpfile hello.vcd opened, ready for output.
src/main.v:6: $finish called at 0 (1s)
</code></pre>
</div>

<p>More complete examples: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/embed/iverilog">iVerilog Examples</a></p>

<h4 id="verilator-simulator">Verilator Simulator</h4>

<p>Through <code class="highlighter-rouge">add_requires("verilator")</code> configuration, we can automatically pull the verilator toolchain package, and then use <code class="highlighter-rouge">set_toolchains("@verilator")</code> to automatically bind to the toolchain to compile the project.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"verilator"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">)</span>
     <span class="n">add_rules</span><span class="p">(</span><span class="s2">"verilator. binary"</span><span class="p">)</span>
     <span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@verilator"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.v"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
</code></pre>
</div>

<p>verilator project, we need an additional <code class="highlighter-rouge">sim_main.cpp</code> file to participate in the compilation, as the entry code of the program.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include "hello.h"
#include "verilated.h" (Simplified Chinese)
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">VerilatedContext</span><span class="o">*</span> <span class="n">contextp</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VerilatedContext</span><span class="p">;</span>
     <span class="n">contextp</span><span class="o">-&gt;</span><span class="n">commandArgs</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
     <span class="n">hello</span><span class="o">*</span> <span class="n">top</span> <span class="o">=</span> <span class="n">new</span> <span class="n">hello</span><span class="p">{</span><span class="n">contextp</span><span class="p">};</span>
     <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">contextp</span><span class="o">-&gt;</span><span class="n">gotFinish</span><span class="p">())</span> <span class="p">{</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">();</span> <span class="p">}</span>
     <span class="n">remove</span> <span class="n">top</span><span class="p">.</span>
     <span class="n">Remove</span> <span class="n">contextp</span><span class="p">.</span>
     <span class="n">returns</span> <span class="mi">0</span><span class="p">.</span>
<span class="p">}</span>
</code></pre>
</div>

<h5 id="set-abstract-configuration-1">Set abstract configuration</h5>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"verilator"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">)</span>
     <span class="n">add_rules</span><span class="p">(</span><span class="s2">"verilator. binary"</span><span class="p">)</span>
     <span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@verilator"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.v"</span><span class="p">)</span>
     <span class="n">add_defines</span><span class="p">(</span><span class="s2">"TEST"</span><span class="p">)</span>
     <span class="n">add_includedirs</span><span class="p">(</span><span class="s2">"inc"</span><span class="p">)</span>
     <span class="n">set_languages</span><span class="p">(</span><span class="s2">"v1800-2009"</span><span class="p">)</span>
</code></pre>
</div>

<p>We can use <code class="highlighter-rouge">set_languages("v1800-2009")</code> to set the language standard for switching Verilog.</p>

<p>Currently supported values and mappings are as follows.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="c1">--Verilog</span>
<span class="p">[</span><span class="s2">"v1364-1995"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1364-1995ext+v"</span><span class="p">.</span>
<span class="p">[</span><span class="s2">"v1364-2001"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1364-2001ext+v"</span><span class="p">.</span>
<span class="p">[</span><span class="s2">"v1364-2005"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1364-2005ext+v"</span><span class="p">.</span>
<span class="c1">--system-Verilog</span>
<span class="p">[</span><span class="s2">"v1800-2005"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1800-2005ext+v"</span><span class="p">.</span>
<span class="p">[</span><span class="s2">"v1800-2009"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1800-2009ext+v"</span><span class="p">.</span>
<span class="p">[</span><span class="s2">"v1800-2012"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1800-2012ext+v"</span><span class="p">,</span>
<span class="p">[</span><span class="s2">"v1800-2017"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"+1800-2017ext+v"</span><span class="p">.</span>
</code></pre>
</div>

<h5 id="set-custom-flags-1">Set custom flags</h5>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_requires</span><span class="p">(</span><span class="s2">"verilator"</span><span class="p">)</span>
<span class="n">target</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">)</span>
     <span class="n">add_rules</span><span class="p">(</span><span class="s2">"verilator. binary"</span><span class="p">)</span>
     <span class="n">set_toolchains</span><span class="p">(</span><span class="s2">"@verilator"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.v"</span><span class="p">)</span>
     <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
     <span class="n">add_values</span><span class="p">(</span><span class="s2">"verilator.flags"</span><span class="p">,</span> <span class="s2">"--trace"</span><span class="p">,</span> <span class="s2">"--timing"</span><span class="p">)</span>
</code></pre>
</div>

<h5 id="build-the-project-1">Build the project</h5>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv">
</span>[ 0%]: compiling.verilog src/main.v
[ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__Slow.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0__Slow.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello.cpp
[ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated_threads.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello__Syms.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h07139e86__0.cpp
[15%]: cache compiling.release src/sim_main.cpp
[ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0.cpp
[84%]: linking. release hello
[100%]: build ok!
</code></pre>
</div>

<h5 id="run-the-program-1">Run the program</h5>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> run
</span>ruki-2:hello ruki$ xmake run
hello world!
- src/main.v:4:Verilog $finish
</code></pre>
</div>

<p>A more complete example: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/embed/verilator">Verilator</a></p>

<h3 id="support-for-c-module-distribution">Support for C++ Module distribution</h3>

<p>Many thanks to <a href="https://github.com/Arthapz">Arthapz</a> for continuing to help improve xmake’s support for C++ Modules in this new release.</p>

<p>We can now distribute C++ Modules as packages for quick integration and reuse in other projects.</p>

<p>This is a prototype implementation based on the draft design for module distribution in <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2473r1.pdf">p2473r1</a>.</p>

<h4 id="creating-a-c-modules-package-for-distribution">Creating a C++ Modules package for distribution</h4>

<p>We start by maintaining a build of the modules using xmake.lua and telling xmake which module files to install for external distribution by specifying ``{install = true}`’’.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.release"</span><span class="p">,</span> <span class="s2">"mode.debug"</span><span class="p">)</span>
<span class="n">set_languages</span><span class="p">(</span><span class="s2">"c++20"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"static"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"*.cpp"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"*.mpp"</span><span class="p">,</span> <span class="p">{</span> <span class="n">install</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
</code></pre>
</div>

<p>We then make it into a package that we can commit to the <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a> repository, or of course directly into a local package, or a private repository package.</p>

<p>Here, for testing purposes, we just make it a local package via <code class="highlighter-rouge">set_sourcedir</code>.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
    <span class="n">set_sourcedir</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">scriptdir</span><span class="p">(),</span> <span class="s2">"src"</span><span class="p">))</span>
    <span class="n">on_install</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
        <span class="n">import</span><span class="p">(</span><span class="s2">"package.tools.xmake"</span><span class="p">).</span><span class="n">install</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">end</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="integrating-the-c-modules-package">Integrating the C++ Modules package</h4>

<p>We then quickly integrate the C++ Modules package for use via the package integration interface with <code class="highlighter-rouge">add_requires("foo")</code>.</p>

<p>Since the modules packages for foo are defined in a private repository, we introduce our own package repository via <code class="highlighter-rouge">add_repositories("my-repo my-repo")</code>.</p>

<p>If the package has already been committed to the official xmake-repo repository, there is no need to configure it additionally.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">add_rules</span><span class="p">(</span><span class="s2">"mode.release"</span><span class="p">,</span> <span class="s2">"mode.debug"</span><span class="p">)</span>
<span class="n">set_languages</span><span class="p">(</span><span class="s2">"c++20"</span><span class="p">)</span>

<span class="n">add_repositories</span><span class="p">(</span><span class="s2">"my-repo my-repo"</span><span class="p">)</span>
<span class="n">add_requires</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">)</span>

<span class="n">target</span><span class="p">(</span><span class="s2">"packages"</span><span class="p">)</span>
    <span class="n">set_kind</span><span class="p">(</span><span class="s2">"binary"</span><span class="p">)</span>
    <span class="n">add_files</span><span class="p">(</span><span class="s2">"src/*.cpp"</span><span class="p">)</span>
    <span class="n">add_packages</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">)</span>
    <span class="n">set_policy</span><span class="p">(</span><span class="s2">"build.c++.modules"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>
</div>

<p>Once the packages are integrated, we can run the ``xmake`’’ command to download, compile and integrate the C++ Modules package for use with one click.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake
checking <span class="k">for </span>platform ... linux
checking <span class="k">for </span>architecture ... x86_64
note: install or modify <span class="o">(</span>m<span class="o">)</span> these packages <span class="o">(</span>pass -y to skip confirm<span class="o">)</span>?
<span class="k">in </span>my-repo:
  -&gt; foo latest
  -&gt; bar latest
please input: y <span class="o">(</span>y/n/m<span class="o">)</span>

  <span class="o">=</span>&gt; install bar latest ... ok
  <span class="o">=</span>&gt; install foo latest ... ok
<span class="o">[</span> 0%]: generating.module.deps src/main.cpp
<span class="o">[</span> 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/b/bar/latest/ 4e0143c97b65425b855ad5fd03038b6a/modules/bar/bar.mpp
<span class="o">[</span> 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/f/foo/latest/ 4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp
<span class="o">[</span> 14%]: compiling.module.release bar
<span class="o">[</span> 14%]: compiling.module.release foo
<span class="o">[</span> 57%]: compiling.release src/main.cpp
<span class="o">[</span> 71%]: linking.release packages
<span class="o">[</span> 100%]: build ok!
<span class="sb">```</span><span class="s1">''</span>

Note: After each package is installed, a meta-info file <span class="k">for </span>the maintenance module is stored <span class="k">in </span>the package path, this is a format specification agreed <span class="k">in</span> <span class="sb">``</span>p2473r1.pdf<span class="sb">``</span>, it may not be the final standard, but this does not affect our ability to use the distribution of the module now.

<span class="sb">```</span>bash
<span class="gp">$ </span>cat . /build/.packages/f/f/foo/latest/4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp.meta-info
<span class="o">{</span><span class="s2">"_VENDOR_extension"</span>:<span class="o">{</span><span class="s2">"xmake"</span>:<span class="o">{</span><span class="s2">"name"</span>: <span class="s2">"foo"</span>, <span class="s2">"file"</span>: <span class="s2">"foo.mpp"</span><span class="o">}}</span>, <span class="s2">"definitions"</span>:<span class="o">{}</span>, <span class="s2">"include_paths"</span>:<span class="o">{}}</span>
</code></pre>
</div>

<p>The full example project is available at: <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/c%2B%2B/modules/packages">C++ Modules package distribution example project</a></p>

<h3 id="support-for-c23-std-modules">Support for C++23 Std Modules</h3>

<p><a href="https://github.com/Arthapz">Arthapz</a> has also helped to improve support for C++23 Std Modules.</p>

<p>It is currently supported by three compilers in progress.</p>

<h4 id="msvc">Msvc</h4>

<p>The latest Visual Studio 17.5 preview already supports it, and the non-standard ifc std modules will be deprecated.</p>

<p>For the standard C++23 std modules, this is how we introduced them.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">import</span> <span class="n">std</span><span class="p">;</span>
</code></pre>
</div>

<p>Whereas for ifc std modules, we need to write it like this.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import std.core;
</code></pre>
</div>

<p>This is not a C++23 standard, it is only provided by msvc, it is not compatible with other compilers and will be deprecated in new versions of msvc.
Therefore the new version of Xmake will only support C++23 std modules and not the deprecated ifc std modules.</p>

<h4 id="clang">Clang</h4>

<p>It seems that the latest clang does not yet fully support C++23 std modules either, and is still in draft patch status, <a href="https://reviews.llvm.org/D135507">#D135507</a>.</p>

<p>However, Xmake does support it, so if you want to try it out, you can merge in the patch and test it with xmake.</p>

<p>There is also experimental support for non-standard std modules in lower versions of clang.</p>

<p>It is still possible to experiment with xmake to build std modules in lower versions of clang, even though it is probably still a toy (and will encounter many problems).</p>

<p>For a discussion see: <a href="https://github.com/xmake-io/xmake/pull/3255">#3255</a></p>

<h4 id="gcc">Gcc</h4>

<p>It is not currently supported.</p>

<h3 id="xrepo-auto-completion-support">Xrepo auto-completion support</h3>

<p>Previously, we only supported the incomplete xmake command. In this new version, we also support the incomplete <code class="highlighter-rouge">xrepo install</code> command, which
This will automatically search the <a href="https://github.com/xmake-io/xmake-repo">xmake-repo</a> repository for packages to incomplete our install command.</p>

<p>Many thanks to @glcraft for this contribution.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xrepo install libp
libpaper libpfm libpng libpqxx libpthread-stubs
libpcap libplist libpq libpsl
</code></pre>
</div>

<h2 id="changelog">Changelog</h2>

<h3 id="new-features">New features</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/pull/3228">#3228</a>: Add support of importing modules from packages</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3257">#3257</a>: Add support for iverilog and verilator</li>
  <li>Support for xp and vc6.0</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3214">#3214</a>: Completion on xrepo install packages</li>
</ul>

<h3 id="changes">Changes</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/pull/3225">#3255</a>: Improve clang libc++ module support</li>
  <li>Support for compiling xmake using mingw</li>
  <li>Improve compatibility issues with xmake running on win xp</li>
  <li>Add pure lua json implementation instead of lua-cjson if the external dependencies are enabled</li>
</ul>

<h3 id="bugs-fixed">Bugs fixed</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/issues/3229">#3229</a>: Fix find rc.exe for vs2015</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3271">#3271</a>: Fix macro defines with spaces</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3273">#3273</a>: Fix nim link error</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3286">#3286</a>: Fix compile_commands for clangd</li>
</ul>


        </article>
        <hr>

        <!-- wwads -->
        
        <div class="wwads-cn wwads-horizontal" data-id="243" style="max-width:100%"></div>
        

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2023/01/22/xmake-update-v2.7.6/">Xmake v2.7.6 发布，新增 Verilog 和 C++ Modules 分发支持
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
            
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2022/11/08/xmake-update-v2.7.3/">Xmake v2.7.3 Released, Package Components and C++ Modules Incremental Build Support</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        
        
        <p><strong>Next Post</strong> <a href="/2023/02/23/xmake-update-v2.7.7/">Xmake v2.7.7 released, Support Haiku, Improve API check and C++ Modules</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
