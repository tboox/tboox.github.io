<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Xmake v2.7.7 released, Support Haiku, Improve API check and C++ Modules</title>
    <meta name="description" content="Xmake is a lightweight cross-platform build utility based on Lua.It is very lightweight and has no dependencies because it has a built-in Lua runtime.It uses...">

    
    <meta name="keywords" content="tbox,xmake,gbox,cross-platform,c,lua,build,makefile,make,compile,linux,programing" />

    <!-- qq oauth -->
    <meta property="qc:admins" content="5211601217706727767255" />

    <!--icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/nice-highres.png" />
	<link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57x57-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="/static/img/retinahd_icon.png" />
	<meta name="msapplication-TileImage" content="/static/img/retinahd_icon.png" />

    <link rel="stylesheet" href=" /css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://tboox.org/2023/02/23/xmake-update-v2.7.7/">
    <link rel="alternate" type="application/rss+xml" title="TBOOX Open Source Project" href="https://tboox.org/feed.xml ">
    <link rel="alternate" hreflang="en" href="https://tboox.org/" />
    <link rel="alternate" hreflang="zh-Hans" href="https://tboox.org/cn/" />




    <script type="text/javascript">
    function isPC(){
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    </script>

<!-- wwads -->

    <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script>


<!-- baidu ads -->



    <!-- baidu ads -->

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">TBOOX</a>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/cn?lang=0">
                    
                        <i class="fa fa-home"></i>中文
                    </a>
                </li>

                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/project/">
                            
                        
                            <i class="fa fa-bookmark"></i>Projects
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/archive/">
                            
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/category/">
                            
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/tag/">
                            
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/docs/">
                            
                        
                            <i class="fa fa-book"></i>Documents
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="https://xmake.io/#/about/contact" target="_blank" >
                            
                        
                            <i class="fa fa-forumbee"></i>Community
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/donation/">
                            
                        
                            <i class="fa fa-heart"></i>Donate
                        </a>
                    </li>
                    
                    
                    
                
                    
                     
                    
                
                    
                     
                     
                    <li>

                        
                            
                            <a href="/about/">
                            
                        
                            <i class="fa fa-user"></i>About
                        </a>
                    </li>
                    
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                     
                     
                    
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>



        <div class="page clearfix" post>
    <div class="left">
        <h1>Xmake v2.7.7 released, Support Haiku, Improve API check and C++ Modules</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2023-02-23
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#xmake" title="Category: xmake" rel="category">xmake</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p><a href="https://github.com/xmake-io/xmake">Xmake</a> is a lightweight cross-platform build utility based on Lua.</p>

<p>It is very lightweight and has no dependencies because it has a built-in Lua runtime.</p>

<p>It uses xmake.lua to maintain project builds and its configuration syntax is very simple and readable.</p>

<p>We can use it to build project directly like Make/Ninja, or generate project files like CMake/Meson, and it also has a built-in package management system to help users solve the integrated use of C/C++ dependent libraries.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake = Build backend + Project Generator + Package Manager + [Remote|Distributed] Build + Cache
</code></pre>
</div>

<p>Although not very precise, we can still understand Xmake in the following way:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Xmake ≈ Make/Ninja + CMake/Meson + Vcpkg/Conan + distcc + ccache/sccache
</code></pre>
</div>

<ul>
  <li><a href="https://github.com/xmake-io/xmake">Github</a></li>
  <li><a href="https://xmake.io/">Document</a></li>
</ul>

<p><img src="https://github.com/xmake-io/xmake-docs/raw/master/assets/img/index/package.gif" width="650px" /></p>

<h2 id="introduction-of-new-features">Introduction of new features</h2>

<h3 id="haiku-support">Haiku support</h3>

<p>Xmake is now fully operational on <a href="https://www.haiku-os.org/">Haiku systems</a> and we have added a haiku compilation platform to Xmake for compiling code on Haiku systems.</p>

<p>The result is as follows:</p>

<p><img src="/static/img/xmake/haiku.jpeg" width="650px" /></p>

<h3 id="improve-c20-modules-support">Improve C++20 Modules support</h3>

<p>The latest build of clang-17 has made a number of improvements to C++20 Modules, so we have targeted them in Xmake to make them better and to fix some std modules related issues.</p>

<p>A full project example of C++ Modules can be found at <a href="https://github.com/xmake-io/xmake/tree/master/tests/projects/c%2B%2B/modules">C++ Modules Examples</a>.</p>

<p>There are also a number of actual C++ Modules projects that have been built using Xmake, e.g.</p>

<ul>
  <li><a href="https://github.com/alibaba/async_simple">async_simple</a></li>
  <li><a href="https://github.com/TapzCrew/StormKit">StormKit</a></li>
</ul>

<h3 id="check-api-configuration">Check API configuration</h3>

<p>Previous versions of xmake.lua were weak at detecting the validity of pass-throughs to the configuration API, and only tested a few APIs such as <code class="highlighter-rouge">add_includedirs</code>, <code class="highlighter-rouge">add_files</code> and so on.</p>

<p>In the new version, we have added an <code class="highlighter-rouge">xmake check</code> plugin for checking APIs and code to better check the user’s configuration and to avoid the problem of incorrect configuration values due to unfamiliarity with Xmake.</p>

<p>In addition to manually running the <code class="highlighter-rouge">xmake check</code> command to trigger the check, Xmake also automatically triggers some routine checks at various stages of compilation, compilation failure, etc.
Not all users are aware of the existence of the <code class="highlighter-rouge">xmake check</code> command.</p>

<h4 id="check-all-api-values-in-xmakelua-by-default">Check all api values in xmake.lua by default</h4>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">set_lanuages</span><span class="p">(</span><span class="s2">"c91"</span><span class="p">)</span> <span class="c1">-- typo</span>
</code></pre>
</div>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check
</span>./xmake.lua:15: warning: unknown language value 'c91', it may be 'c90'
0 notes, 1 warnings, 0 errors
</code></pre>
</div>

<p>we can also run a given group</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check api
</span><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check api.target
</span></code></pre>
</div>

<h4 id="verbose-output">Verbose output</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check -v
</span>./xmake.lua:15: warning: unknown language value 'cxx91', it may be 'cxx98'
./src/tbox/xmake.lua:43: note: unknown package value 'mbedtls'
./src/tbox/xmake.lua:43: note: unknown package value 'polarssl'
./src/tbox/xmake.lua:43: note: unknown package value 'openssl'
./src/tbox/xmake.lua:43: note: unknown package value 'pcre2'
./src/tbox/xmake.lua:43: note: unknown package value 'pcre'
./src/tbox/xmake.lua:43: note: unknown package value 'zlib'
./src/tbox/xmake.lua:43: note: unknown package value 'mysql'
./src/tbox/xmake.lua:43: note: unknown package value 'sqlite3'
8 notes, 1 warnings, 0 errors
</code></pre>
</div>

<h4 id="check-the-given-api">Check the given api</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check api.target.languages
</span>./xmake.lua:15: warning: unknown language value 'cxx91', it may be 'cxx98'
0 notes, 1 warnings, 0 errors
</code></pre>
</div>

<h4 id="check-compiler-flags">Check compiler flags</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check
</span>./xmake.lua:10: warning: clang: unknown c compiler flag '-Ox'
0 notes, 1 warnings, 0 errors
</code></pre>
</div>

<h4 id="check-includedirs">Check includedirs</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check
</span>./xmake.lua:11: warning: includedir 'xxx' not found
0 notes, 1 warnings, 0 errors
</code></pre>
</div>

<h3 id="check-project-code-clang-tidy">Check project code (clang-tidy)</h3>

<h4 id="list-clang-tidy-checks">List clang-tidy checks</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --list
</span>Enabled checks:
    clang-analyzer-apiModeling.StdCLibraryFunctions
    clang-analyzer-apiModeling.TrustNonnull
    clang-analyzer-apiModeling.google.GTest
    clang-analyzer-apiModeling.llvm.CastValue
    clang-analyzer-apiModeling.llvm.ReturnValue
    ...
</code></pre>
</div>

<h4 id="check-source-code-in-targets">Check source code in targets</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy
</span>1 error generated.
Error while processing /private/tmp/test2/src/main.cpp.
/tmp/test2/src/main.cpp:1:10: error: 'iostr' file not found [clang-diagnostic-error]
#include &lt;iostr&gt;
         ^~~~~~~
Found compiler error(s).
error: execv(/usr/local/opt/llvm/bin/clang-tidy -p compile_commands.json /private/tmp/test2/src
/main.cpp) failed(1)
</code></pre>
</div>

<h4 id="check-code-with-the-given-checks">Check code with the given checks</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --checks="*"
</span>6 warnings and 1 error generated.
Error while processing /private/tmp/test2/src/main.cpp.
/tmp/test2/src/main.cpp:1:10: error: 'iostr' file not found [clang-diagnostic-error]
#include &lt;iostr&gt;
         ^~~~~~~
/tmp/test2/src/main.cpp:3:1: warning: do not use namespace using-directives; use using-declarat
ions instead [google-build-using-namespace]
using namespace std;
^
/tmp/test2/src/main.cpp:3:17: warning: declaration must be declared within the '__llvm_libc' na
mespace [llvmlibc-implementation-in-namespace]
using namespace std;
                ^
/tmp/test2/src/main.cpp:5:5: warning: declaration must be declared within the '__llvm_libc' nam
espace [llvmlibc-implementation-in-namespace]
int main(int argc, char **argv) {
    ^
/tmp/test2/src/main.cpp:5:5: warning: use a trailing return type for this function [modernize-u
se-trailing-return-type]
int main(int argc, char **argv) {
~~~ ^
auto                            -&gt; int
/tmp/test2/src/main.cpp:5:14: warning: parameter 'argc' is unused [misc-unused-parameters]
int main(int argc, char **argv) {
             ^~~~
              /*argc*/
/tmp/test2/src/main.cpp:5:27: warning: parameter 'argv' is unused [misc-unused-parameters]
int main(int argc, char **argv) {
                          ^~~~
                           /*argv*/
Found compiler error(s).
error: execv(/usr/local/opt/llvm/bin/clang-tidy --checks=* -p compile_commands.json /private/tm
p/test2/src/main.cpp) failed(1)
</code></pre>
</div>

<h4 id="check-code-with-the-given-target-name">Check code with the given target name</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy [targetname]
</span></code></pre>
</div>

<h4 id="check-code-with-the-given-source-files">Check code with the given source files</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy -f src/main.c
</span><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy -f 'src/*.c:src/**.cpp'
</span></code></pre>
</div>

<h4 id="set-the-given-clang-tidy-config-file">Set the given .clang-tidy config file</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --configfile=/tmp/.clang-tidy
</span></code></pre>
</div>

<h4 id="create-a-new-clang-tidy-config-file">Create a new .clang-tidy config file</h4>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">xmake</span><span class="kv"> check clang.tidy --checks="*" --create
</span><span class="w">$ </span><span class="nc">cat</span><span class="kv"> .clang-tidy
</span>---
Checks:          'clang-diagnostic-*,clang-analyzer-*,*'
WarningsAsErrors: ''
HeaderFilterRegex: ''
AnalyzeTemporaryDtors: false
FormatStyle:     none
User:            ruki
CheckOptions:
  - key:             readability-suspicious-call-argument.PrefixSimilarAbove
    value:           '30'
  - key:             cppcoreguidelines-no-malloc.Reallocations
    value:           '::realloc'

</code></pre>
</div>

<h3 id="improve-target-configuration-source-analysis">Improve target configuration source analysis</h3>

<p>We have improved the presentation of target information in the <code class="highlighter-rouge">xmake show -t target</code> command by adding a new configuration source analysis and streamlining some of the relatively redundant information.</p>

<p>We can use it to better troubleshoot where some of the flags we configure actually come from.</p>

<p>The display looks like this.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake show -t tbox
The information of target<span class="o">(</span>tbox<span class="o">)</span>:
    at: /Users/ruki/projects/personal/tbox/src/tbox/xmake.lua
    kind: static
    targetfile: build/macosx/x86_64/release/libtbox.a
    rules:
      -&gt; mode.release -&gt; ./xmake.lua:26
      -&gt; mode.debug -&gt; ./xmake.lua:26
      -&gt; utils.install.cmake_importfiles -&gt; ./src/tbox/xmake.lua:15
      -&gt; utils.install.pkgconfig_importfiles -&gt; ./src/tbox/xmake.lua:16
    options:
      -&gt; object -&gt; ./src/tbox/xmake.lua:53
      -&gt; charset -&gt; ./src/tbox/xmake.lua:53
      -&gt; database -&gt; ./src/tbox/xmake.lua:53
    packages:
      -&gt; mysql -&gt; ./src/tbox/xmake.lua:43
      -&gt; sqlite3 -&gt; ./src/tbox/xmake.lua:43
    links:
      -&gt; pthread -&gt; option<span class="o">(</span>__keyword_thread_local<span class="o">)</span> -&gt; @programdir/includes/check_csnippets.lua:100
    syslinks:
      -&gt; pthread -&gt; ./xmake.lua:71
      -&gt; dl -&gt; ./xmake.lua:71
      -&gt; m -&gt; ./xmake.lua:71
      -&gt; c -&gt; ./xmake.lua:71
    defines:
      -&gt; __tb_small__ -&gt; ./xmake.lua:42
      -&gt; <span class="nv">__tb_prefix__</span><span class="o">=</span><span class="s2">"tbox"</span> -&gt; ./src/tbox/xmake.lua:19
      -&gt; <span class="nv">_GNU_SOURCE</span><span class="o">=</span>1 -&gt; option<span class="o">(</span>__systemv_semget<span class="o">)</span> -&gt; @programdir/includes/check_cfuncs.lua:104
    cxflags:
      -&gt; -Wno-error<span class="o">=</span>deprecated-declarations -&gt; ./xmake.lua:22
      -&gt; -fno-strict-aliasing -&gt; ./xmake.lua:22
      -&gt; -Wno-error<span class="o">=</span>expansion-to-defined -&gt; ./xmake.lua:22
      -&gt; -fno-stack-protector -&gt; ./xmake.lua:51
    frameworks:
      -&gt; CoreFoundation -&gt; ./src/tbox/xmake.lua:38
      -&gt; CoreServices -&gt; ./src/tbox/xmake.lua:38
    mxflags:
      -&gt; -Wno-error<span class="o">=</span>deprecated-declarations -&gt; ./xmake.lua:23
      -&gt; -fno-strict-aliasing -&gt; ./xmake.lua:23
      -&gt; -Wno-error<span class="o">=</span>expansion-to-defined -&gt; ./xmake.lua:23
    includedirs:
      -&gt; src -&gt; ./src/tbox/xmake.lua:26
      -&gt; build/macosx/x86_64/release -&gt; ./src/tbox/xmake.lua:27
    headerfiles:
      -&gt; src/<span class="o">(</span>tbox/<span class="k">**</span>.h<span class="o">)</span>|<span class="k">**</span>/impl/<span class="k">**</span>.h -&gt; ./src/tbox/xmake.lua:30
      -&gt; src/<span class="o">(</span>tbox/prefix/<span class="k">**</span>/prefix.S<span class="o">)</span> -&gt; ./src/tbox/xmake.lua:31
      -&gt; build/macosx/x86_64/release/tbox.config.h -&gt; ./src/tbox/xmake.lua:34
    files:
      -&gt; src/tbox/<span class="k">*</span>.c -&gt; ./src/tbox/xmake.lua:56
      -&gt; src/tbox/hash/bkdr.c -&gt; ./src/tbox/xmake.lua:57
      -&gt; src/tbox/hash/fnv32.c -&gt; ./src/tbox/xmake.lua:57
    compiler <span class="o">(</span>cc<span class="o">)</span>: /usr/bin/xcrun -sdk macosx clang
      -&gt; -Qunused-arguments -target x86_64-apple-macos12.6 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX13.0.sdk
    linker <span class="o">(</span>ar<span class="o">)</span>: /usr/bin/xcrun -sdk macosx ar
      -&gt; -cr
    compflags <span class="o">(</span>cc<span class="o">)</span>:
      -&gt; -Qunused-arguments -target x86_64-apple-macos12.6 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX13.0.sdk -Wall -Werror -Oz -std<span class="o">=</span>c99 -Isrc -Ibuild/macosx/x86_64/release -D__tb_small__ -D__tb_prefix__<span class="o">=</span><span class="se">\"</span>tbox<span class="se">\"</span> -D_GNU_SOURCE<span class="o">=</span>1 -framework CoreFoundation -framework CoreServices -Wno-error<span class="o">=</span>deprecated-declarations -fno-strict-aliasing -Wno-error<span class="o">=</span>expansion-to-defined -fno-stack-protector
    linkflags <span class="o">(</span>ar<span class="o">)</span>:
      -&gt; -cr
</code></pre>
</div>

<h3 id="improve-package-download-configuration">Improve package download configuration</h3>

<p>If there are packages whose url downloads require specific http headers to be set to authenticate them before they can be downloaded, this policy can be specified.</p>

<p>This is often used for the maintenance of private repository packages within some companies.</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"xxx"</span><span class="p">)</span>
    <span class="n">set_policy</span><span class="p">(</span><span class="s2">"package.download.http_headers"</span><span class="p">,</span> <span class="s2">"TEST1: foo"</span><span class="p">,</span> <span class="s2">"TEST2: bar"</span><span class="p">)</span>
</code></pre>
</div>

<p>We can also set the http headers for the specified urls: ```</p>

<div class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">package</span><span class="p">(</span><span class="s2">"zlib"</span><span class="p">)</span>
    <span class="n">add_urls</span><span class="p">(</span><span class="s2">"https://github.com/madler/zlib/archive/$(version).tar.gz"</span><span class="p">,</span> <span class="p">{</span>
        <span class="n">http_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"TEST1: foo"</span><span class="p">,</span> <span class="s2">"TEST2: bar"</span><span class="p">}</span>
    <span class="p">})</span>
</code></pre>
</div>

<h3 id="improve-dlang-toolchain-support">Improve dlang toolchain support</h3>

<p>In previous versions, Xmake only provided a toolchain for dlang, which automatically looked up dmd, ldc2, gdc to adapt to the dlang compiler that was available to compile the project.</p>

<p>However, this approach does not allow the user more flexibility in selecting a specific compiler, and if both dmd and ldc2 are installed, Xmake will always use dmd as the compiler for dlang.</p>

<p>Therefore, in this new version, xmake provides three separate toolchains to select the required dlang compiler.</p>

<p>For example, you can quickly switch to the ldc2 compiler to compile your project by running the following command</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake f --toolchain<span class="o">=</span>ldc
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>In addition to the ldc toolchain, two other toolchains, dmd, and gdc, can be used separately.</p>

<p>And we have also improved the configuration of the dmd/ldc2 build optimisation options to make the production dlang binaries even smaller and faster.</p>

<h3 id="support-for-external-working-directory-configuration">Support for external working directory configuration</h3>

<h4 id="the-default-build-directory-mode">The default build directory mode</h4>

<p>Xmake currently provides a build directory model that is a built-in build directory, which means that if we run the xmake command in the root of the current project, the build directory is automatically generated and .xmake is used to store some configuration cache.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- projectdir (workdir)
  - build (generated)
  - .xmake (generated)
  - src
  - xmake.lua
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>projectdir
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>Of course, we can configure the build directory with <code class="highlighter-rouge">xmake f -o . /build</code> to configure the build directory, but the .xmake directory will still be in the project source directory.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>projectdir
<span class="gp">$ </span>xmake f -o ... /build
</code></pre>
</div>

<p>This may not be to the liking of some users who like their complete code directories to remain intact and clean.</p>

<h4 id="the-new-external-build-directory-mode">The new external build directory mode</h4>

<p>Therefore, with this new version, Xmake offers an alternative way of configuring build directories, namely external directory builds (similar to CMake).</p>

<p>For example, we would like to use a directory structure like the following to build a project, always keeping the source directory clean.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- workdir
  - build (generated)
  - .xmake (generated)
- projectdir
  - projectdir
  - xmake.lua
</code></pre>
</div>

<p>We just need to go into the working directory where we need to store the build/.xmake directory and then use the ``xmake f -P [projectdir]` configuration command to specify the source root directory.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>workdir
<span class="gp">$ </span>xmake f -P ... /projectdir
<span class="gp">$ </span>xmake
</code></pre>
</div>

<p>Once the configuration is complete, the source code root is completely remembered and there is no need to set it up again for any subsequent build commands.</p>

<p>For example, the commands to build, rebuild, run or install are exactly the same as before and the user will not feel any difference.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>xmake
<span class="gp">$ </span>xmake run
<span class="gp">$ </span>xmake --rebuild
<span class="gp">$ </span>xmake clean
<span class="gp">$ </span>xmake install
</code></pre>
</div>

<p>We can also use the <code class="highlighter-rouge">-o/--buildir</code> argument to set the build directory separately to another location, for example to the following structure.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- build (generated)
- workdir
  - .xmake (generated)
- projectdir
  - src
  - xmake.lua
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd </span>workdir
<span class="gp">$ </span>xmake f -P ... /projectdir -o ... /build
</code></pre>
</div>
<h2 id="changelog">Changelog</h2>

<h3 id="new-features">New features</h3>

<ul>
  <li>Add Haiku support</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3326">#3326</a>: Add <code class="highlighter-rouge">xmake check</code> to check project code (clang-tidy) and configuration</li>
  <li><a href="https://github.com/xmake-io/xmake/pull/3332">#3332</a>: add custom http headers when downloading packages</li>
</ul>

<h3 id="changes">Changes</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/pull/3318">#3318</a>: Improve dlang toolchains</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/2591">#2591</a>: Improve target analysis</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3342">#3342</a>: Improve to configure working and build directories</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3373">#3373</a>: Improve std modules support for clang-17</li>
  <li>Improve to strip/optimization for dmd/ldc2</li>
</ul>

<h3 id="bugs-fixed">Bugs fixed</h3>

<ul>
  <li><a href="https://github.com/xmake-io/xmake/pull/3317">#3317</a>: Fix languages for qt project.</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3321">#3321</a>: Fix dependfile when generating configiles</li>
  <li><a href="https://github.com/xmake-io/xmake/issues/3296">#3296</a>: Fix build error on macOS arm64</li>
</ul>

        </article>
        <hr>

        <!-- baidu ads -->
        

        
        
            
        
            
            
                
            
        
            
        
            
            
                
                    
                    <h2 id="chinese">中文</h2>
                    <ul>
                    
                    <li class="relatedPost">
                        <a href="/cn/2023/02/23/xmake-update-v2.7.7/">Xmake v2.7.7 发布，支持 Haiku 平台，改进 API 检测和 C++ Modules 支持
                        
                        </a>
                    </li>
                    
                    
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
        
            
        
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
            
        
            
            
                
            
        
        
            </ul>
        

        
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
        
            
            
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
            
        
            
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
        
        

        <div class="post-recent">
    <div class="pre">

        

        

        
        
        

        

        

        
        
        <p><strong>Prev Post</strong> <a href="/2023/01/22/xmake-update-v2.7.6/">Xmake v2.7.6 Released, Add Verilog and C++ Module Distribution Support</a></p>
        
    </div>

    <div class="nex">

        

        

        
        
        

        

        

        
        
        <p><strong>Next Post</strong> <a href="/2023/04/04/xmake-update-v2.7.8/">Xmake v2.7.8 released, Improve package virtual environment and build speed</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        









    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#chinese">中文</a></li>
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>

            <!-- wwads -->
            
            <div class="side">
            <div class="wwads-cn wwads-vertical" data-id="243" style="max-width:255px;height:250px"></div>
            </div>
            

            <!-- baidu ads -->
            

            <br>
            <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul class="content-ul">
                  <li><a href="http://github.com/waruqi/tbox">tbox</a></li>
                  <li><a href="http://www.xmake.io">xmake</a></li>
                  <li><a href="https://github.com/waruqi">github</a></li>
                </ul>
            </div>

            <!-- google ads -->
            

            <!-- baidu ads -->
            

            <!-- chitika ads -->
            
        </div>
    </div>

    <!-- baidu ads -->
    
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>



    <footer class="site-footer">
    <div class="wrapper">
        <p class="description">
             Copyright (c) 2016-latest tboox.org 
        </p>
        <p class="contact">
            
            <a href="https://github.com/waruqi" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a> 
             
            
            <a href="mailto:waruqi@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a> 
            
            
            <a href="https://twitter.com/waruqi" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
            
            <a href="/feed.xml" title="feed"><i class="fa fa-feed" aria-hidden="true"></i></a> 
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/Gaohaoyang">HyG</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
